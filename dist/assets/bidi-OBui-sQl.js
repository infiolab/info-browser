import{d as Si,_ as Qo,e as Zo,D as Pi,f as A,i as ws,E as M,j as ea,k as ta,l as vs,m as K,n as ee,o as $,q as de,t as R,s as Ii,P as Lt,r as X,J as sa,v as ra,w as ia,A as ki,y as na,z as oa,B as Ti,F as aa,S as ca,H as da,G as ua,I as Ni,K as la,L as ha,M as pa,N as ma,O as ga,Q as fa,V as wa,W as qt,X as va,Y as ya,Z as ba,$ as xa,a0 as Oi,a1 as Di,a2 as Ri,a3 as Fi,a4 as Ca,a5 as Ea,a6 as ue,a7 as $t,a8 as te,a9 as Et,aa as Ai,ab as ye,ac as zt,ad as Sa,ae as Pa,af as Ia,ag as ka,ah as Ta,ai as _t,aj as Na,ak as ys,al as Oa,am as Da,an as be,ao as Ra,ap as Fa,aq as le,ar as Aa,as as Ma,at as Ba,au as ja,av as Ua,aw as La,ax as qa,ay as Mi,az as $a,aA as Ht,aB as za,aC as Kt,aD as Wt,aE as Bi,aF as _a,aG as Ha,__tla as Ka}from"../background.js";let ji,bs,xs,xe,Cs,he,Vt,Es,pe,Ss,Ps,Te,Gt,Is,Xt,Jt,Yt,Ui,Qt,ks,Zt,es,Wa=Promise.all([(()=>{try{return Ka}catch{}})()]).then(async()=>{var As={},Ne={},me={};function Ji(n){return{all:n=n||new Map,on:function(t,a){var r=n.get(t);r?r.push(a):n.set(t,[a])},off:function(t,a){var r=n.get(t);r&&(a?r.splice(r.indexOf(a)>>>0,1):n.set(t,[]))},emit:function(t,a){var r=n.get(t);r&&r.slice().map(function(d){d(a)}),(r=n.get("*"))&&r.slice().map(function(d){d(t,a)})}}}const Yi=Object.freeze(Object.defineProperty({__proto__:null,default:Ji},Symbol.toStringTag,{value:"Module"})),Qi=Si(Yi);var Ms;function Oe(){if(Ms)return me;Ms=1;var n=me&&me.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(me,"__esModule",{value:!0}),me.EventEmitter=void 0;const t=n(Qi);let a=class{#e=(0,t.default)();on(r,d){return this.#e.on(r,d),this}once(r,d){const o=e=>{d(e),this.off(r,o)};return this.on(r,o)}off(r,d){return this.#e.off(r,d),this}emit(r,d){this.#e.emit(r,d)}removeAllListeners(r){return r?this.#e.all.delete(r):this.#e.all.clear(),this}};return me.EventEmitter=a,me}var De={},Bs;function G(){if(Bs)return De;Bs=1,Object.defineProperty(De,"__esModule",{value:!0}),De.LogType=void 0;var n;return(function(t){t.bidi="bidi",t.cdp="cdp",t.debug="debug",t.debugError="debug:error",t.debugInfo="debug:info",t.debugWarn="debug:warn"})(n||(De.LogType=n={})),De}var Re={},js;function Zi(){if(js)return Re;js=1;var n;Object.defineProperty(Re,"__esModule",{value:!0}),Re.ProcessingQueue=void 0;const t=G();let a=class{static LOGGER_PREFIX=`${t.LogType.debug}:queue`;#e;#t;#s=[];#r=!1;constructor(r,d){this.#t=r,this.#e=d}add(r,d){this.#s.push([r,d]),this.#n()}async#n(){if(!this.#r){for(this.#r=!0;this.#s.length>0;){const r=this.#s.shift();if(!r)continue;const[d,o]=r;this.#e?.(n.LOGGER_PREFIX,"Processing event:",o),await d.then(e=>{if(e.kind==="error"){this.#e?.(t.LogType.debugError,"Event threw before sending:",e.error.message,e.error.stack);return}return this.#t(e.value)}).catch(e=>{this.#e?.(t.LogType.debugError,"Event was not processed:",e?.message)})}this.#r=!1}}};return Re.ProcessingQueue=a,n=a,Re}var Fe={},Z={},Us={},Ls;function en(){return Ls||(Ls=1,Object.defineProperty(Us,"__esModule",{value:!0})),Us}var _={},qs;function $s(){if(qs)return _;qs=1,Object.defineProperty(_,"__esModule",{value:!0}),_.EVENT_NAMES=_.Bluetooth=_.Network=_.Input=_.BrowsingContext=_.Log=_.Script=_.BiDiModule=void 0;var n;(function(s){s.Bluetooth="bluetooth",s.Browser="browser",s.BrowsingContext="browsingContext",s.Cdp="goog:cdp",s.Input="input",s.Log="log",s.Network="network",s.Script="script",s.Session="session"})(n||(_.BiDiModule=n={}));var t;(function(s){(function(i){i.Message="script.message",i.RealmCreated="script.realmCreated",i.RealmDestroyed="script.realmDestroyed"})(s.EventNames||(s.EventNames={}))})(t||(_.Script=t={}));var a;(function(s){(function(i){i.LogEntryAdded="log.entryAdded"})(s.EventNames||(s.EventNames={}))})(a||(_.Log=a={}));var r;(function(s){(function(i){i.ContextCreated="browsingContext.contextCreated",i.ContextDestroyed="browsingContext.contextDestroyed",i.DomContentLoaded="browsingContext.domContentLoaded",i.DownloadEnd="browsingContext.downloadEnd",i.DownloadWillBegin="browsingContext.downloadWillBegin",i.FragmentNavigated="browsingContext.fragmentNavigated",i.HistoryUpdated="browsingContext.historyUpdated",i.Load="browsingContext.load",i.NavigationAborted="browsingContext.navigationAborted",i.NavigationCommitted="browsingContext.navigationCommitted",i.NavigationFailed="browsingContext.navigationFailed",i.NavigationStarted="browsingContext.navigationStarted",i.UserPromptClosed="browsingContext.userPromptClosed",i.UserPromptOpened="browsingContext.userPromptOpened"})(s.EventNames||(s.EventNames={}))})(r||(_.BrowsingContext=r={}));var d;(function(s){(function(i){i.FileDialogOpened="input.fileDialogOpened"})(s.EventNames||(s.EventNames={}))})(d||(_.Input=d={}));var o;(function(s){(function(i){i.AuthRequired="network.authRequired",i.BeforeRequestSent="network.beforeRequestSent",i.FetchError="network.fetchError",i.ResponseCompleted="network.responseCompleted",i.ResponseStarted="network.responseStarted"})(s.EventNames||(s.EventNames={}))})(o||(_.Network=o={}));var e;return(function(s){(function(i){i.RequestDevicePromptUpdated="bluetooth.requestDevicePromptUpdated",i.GattConnectionAttempted="bluetooth.gattConnectionAttempted",i.CharacteristicEventGenerated="bluetooth.characteristicEventGenerated",i.DescriptorEventGenerated="bluetooth.descriptorEventGenerated"})(s.EventNames||(s.EventNames={}))})(e||(_.Bluetooth=e={})),_.EVENT_NAMES=new Set([...Object.values(n),...Object.values(e.EventNames),...Object.values(r.EventNames),...Object.values(d.EventNames),...Object.values(a.EventNames),...Object.values(o.EventNames),...Object.values(t.EventNames)]),_}var zs={},_s;function tn(){return _s||(_s=1,Object.defineProperty(zs,"__esModule",{value:!0})),zs}var O={},Hs;function It(){if(Hs)return O;Hs=1,Object.defineProperty(O,"__esModule",{value:!0}),O.UnavailableNetworkDataException=O.NoSuchNetworkDataException=O.NoSuchNetworkCollectorException=O.NoSuchWebExtensionException=O.InvalidWebExtensionException=O.UnderspecifiedStoragePartitionException=O.UnableToSetFileInputException=O.UnableToSetCookieException=O.NoSuchStoragePartitionException=O.UnsupportedOperationException=O.UnableToCloseBrowserException=O.UnableToCaptureScreenException=O.UnknownErrorException=O.UnknownCommandException=O.SessionNotCreatedException=O.NoSuchUserContextException=O.NoSuchScriptException=O.NoSuchRequestException=O.NoSuchNodeException=O.NoSuchInterceptException=O.NoSuchHistoryEntryException=O.NoSuchHandleException=O.NoSuchFrameException=O.NoSuchElementException=O.NoSuchAlertException=O.MoveTargetOutOfBoundsException=O.InvalidSessionIdException=O.InvalidSelectorException=O.InvalidArgumentException=O.Exception=void 0;class n extends Error{error;message;stacktrace;constructor(I,N,q){super(),this.error=I,this.message=N,this.stacktrace=q}toErrorResponse(I){return{type:"error",id:I,error:this.error,message:this.message,stacktrace:this.stacktrace}}}O.Exception=n;class t extends n{constructor(I,N){super("invalid argument",I,N)}}O.InvalidArgumentException=t;class a extends n{constructor(I,N){super("invalid selector",I,N)}}O.InvalidSelectorException=a;class r extends n{constructor(I,N){super("invalid session id",I,N)}}O.InvalidSessionIdException=r;class d extends n{constructor(I,N){super("move target out of bounds",I,N)}}O.MoveTargetOutOfBoundsException=d;class o extends n{constructor(I,N){super("no such alert",I,N)}}O.NoSuchAlertException=o;class e extends n{constructor(I,N){super("no such element",I,N)}}O.NoSuchElementException=e;class s extends n{constructor(I,N){super("no such frame",I,N)}}O.NoSuchFrameException=s;class i extends n{constructor(I,N){super("no such handle",I,N)}}O.NoSuchHandleException=i;class c extends n{constructor(I,N){super("no such history entry",I,N)}}O.NoSuchHistoryEntryException=c;class l extends n{constructor(I,N){super("no such intercept",I,N)}}O.NoSuchInterceptException=l;class u extends n{constructor(I,N){super("no such node",I,N)}}O.NoSuchNodeException=u;class h extends n{constructor(I,N){super("no such request",I,N)}}O.NoSuchRequestException=h;class f extends n{constructor(I,N){super("no such script",I,N)}}O.NoSuchScriptException=f;class y extends n{constructor(I,N){super("no such user context",I,N)}}O.NoSuchUserContextException=y;class g extends n{constructor(I,N){super("session not created",I,N)}}O.SessionNotCreatedException=g;class w extends n{constructor(I,N){super("unknown command",I,N)}}O.UnknownCommandException=w;class m extends n{constructor(I,N=new Error().stack){super("unknown error",I,N)}}O.UnknownErrorException=m;class p extends n{constructor(I,N){super("unable to capture screen",I,N)}}O.UnableToCaptureScreenException=p;class b extends n{constructor(I,N){super("unable to close browser",I,N)}}O.UnableToCloseBrowserException=b;class E extends n{constructor(I,N){super("unsupported operation",I,N)}}O.UnsupportedOperationException=E;class k extends n{constructor(I,N){super("no such storage partition",I,N)}}O.NoSuchStoragePartitionException=k;class C extends n{constructor(I,N){super("unable to set cookie",I,N)}}O.UnableToSetCookieException=C;class S extends n{constructor(I,N){super("unable to set file input",I,N)}}O.UnableToSetFileInputException=S;class P extends n{constructor(I,N){super("underspecified storage partition",I,N)}}O.UnderspecifiedStoragePartitionException=P;class T extends n{constructor(I,N){super("invalid web extension",I,N)}}O.InvalidWebExtensionException=T;class D extends n{constructor(I,N){super("no such web extension",I,N)}}O.NoSuchWebExtensionException=D;class F extends n{constructor(I,N){super("no such network collector",I,N)}}O.NoSuchNetworkCollectorException=F;class B extends n{constructor(I,N){super("no such network data",I,N)}}O.NoSuchNetworkDataException=B;class x extends n{constructor(I,N){super("unavailable network data",I,N)}}return O.UnavailableNetworkDataException=x,O}var Ks={},Ws;function sn(){return Ws||(Ws=1,Object.defineProperty(Ks,"__esModule",{value:!0})),Ks}var Vs={},Gs;function rn(){return Gs||(Gs=1,Object.defineProperty(Vs,"__esModule",{value:!0})),Vs}var Xs;function j(){return Xs||(Xs=1,(function(n){var t=Z&&Z.__createBinding||(Object.create?(function(o,e,s,i){i===void 0&&(i=s);var c=Object.getOwnPropertyDescriptor(e,s);(!c||("get"in c?!e.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(o,i,c)}):(function(o,e,s,i){i===void 0&&(i=s),o[i]=e[s]})),a=Z&&Z.__setModuleDefault||(Object.create?(function(o,e){Object.defineProperty(o,"default",{enumerable:!0,value:e})}):function(o,e){o.default=e}),r=Z&&Z.__importStar||(function(){var o=function(e){return o=Object.getOwnPropertyNames||function(s){var i=[];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(i[i.length]=c);return i},o(e)};return function(e){if(e&&e.__esModule)return e;var s={};if(e!=null)for(var i=o(e),c=0;c<i.length;c++)i[c]!=="default"&&t(s,e,i[c]);return a(s,e),s}})(),d=Z&&Z.__exportStar||function(o,e){for(var s in o)s!=="default"&&!Object.prototype.hasOwnProperty.call(e,s)&&t(e,o,s)};Object.defineProperty(n,"__esModule",{value:!0}),n.ChromiumBidi=n.Cdp=void 0,n.Cdp=r(en()),n.ChromiumBidi=r($s()),d(tn(),n),d(It(),n),d(sn(),n),d(rn(),n)})(Z)),Z}var Ae={},Js;function nn(){if(Js)return Ae;Js=1,Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.BidiNoOpParser=void 0;let n=class{parseDisableSimulationParameters(t){return t}parseHandleRequestDevicePromptParams(t){return t}parseSimulateAdapterParameters(t){return t}parseSimulateAdvertisementParameters(t){return t}parseSimulateCharacteristicParameters(t){return t}parseSimulateCharacteristicResponseParameters(t){return t}parseSimulateDescriptorParameters(t){return t}parseSimulateDescriptorResponseParameters(t){return t}parseSimulateGattConnectionResponseParameters(t){return t}parseSimulateGattDisconnectionParameters(t){return t}parseSimulatePreconnectedPeripheralParameters(t){return t}parseSimulateServiceParameters(t){return t}parseCreateUserContextParameters(t){return t}parseRemoveUserContextParameters(t){return t}parseSetClientWindowStateParameters(t){return t}parseActivateParams(t){return t}parseCaptureScreenshotParams(t){return t}parseCloseParams(t){return t}parseCreateParams(t){return t}parseGetTreeParams(t){return t}parseHandleUserPromptParams(t){return t}parseLocateNodesParams(t){return t}parseNavigateParams(t){return t}parsePrintParams(t){return t}parseReloadParams(t){return t}parseSetViewportParams(t){return t}parseTraverseHistoryParams(t){return t}parseGetSessionParams(t){return t}parseResolveRealmParams(t){return t}parseSendCommandParams(t){return t}parseSetForcedColorsModeThemeOverrideParams(t){return t}parseSetGeolocationOverrideParams(t){return t}parseSetLocaleOverrideParams(t){return t}parseSetScreenOrientationOverrideParams(t){return t}parseSetScriptingEnabledParams(t){return t}parseSetTimezoneOverrideParams(t){return t}parseAddPreloadScriptParams(t){return t}parseCallFunctionParams(t){return t}parseDisownParams(t){return t}parseEvaluateParams(t){return t}parseGetRealmsParams(t){return t}parseRemovePreloadScriptParams(t){return t}parsePerformActionsParams(t){return t}parseReleaseActionsParams(t){return t}parseSetFilesParams(t){return t}parseAddDataCollectorParams(t){return t}parseAddInterceptParams(t){return t}parseContinueRequestParams(t){return t}parseContinueResponseParams(t){return t}parseContinueWithAuthParams(t){return t}parseDisownDataParams(t){return t}parseFailRequestParams(t){return t}parseGetDataParams(t){return t}parseProvideResponseParams(t){return t}parseRemoveDataCollectorParams(t){return t}parseRemoveInterceptParams(t){return t}parseSetCacheBehaviorParams(t){return t}parseSetExtraHeadersParams(t){return t}parseSetPermissionsParams(t){return t}parseSubscribeParams(t){return t}parseUnsubscribeParams(t){return t}parseDeleteCookiesParams(t){return t}parseGetCookiesParams(t){return t}parseSetCookieParams(t){return t}parseInstallParams(t){return t}parseUninstallParams(t){return t}};return Ae.BidiNoOpParser=n,Ae}var Ce={},Ys;function on(){if(Ys)return Ce;Ys=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.BrowserProcessor=void 0,Ce.getProxyStr=a;const n=j();let t=class{#e;#t;#s;#r;constructor(r,d,o,e){this.#e=r,this.#t=d,this.#s=o,this.#r=e}close(){return setTimeout(()=>this.#e.sendCommand("Browser.close"),0),{}}async createUserContext(r){const d=r;if(d.acceptInsecureCerts!==void 0){const s=this.#s.getGlobalConfig();if(d.acceptInsecureCerts===!1&&s.acceptInsecureCerts===!0)throw new n.UnknownErrorException(`Cannot set user context's "acceptInsecureCerts" to false, when a capability "acceptInsecureCerts" is set to true`)}const o={};if(d.proxy){const s=a(d.proxy);s&&(o.proxyServer=s),d.proxy.noProxy&&(o.proxyBypassList=d.proxy.noProxy.join(","))}else{r["goog:proxyServer"]!==void 0&&(o.proxyServer=r["goog:proxyServer"]);const s=r["goog:proxyBypassList"]??void 0;s&&(o.proxyBypassList=s.join(","))}const e=await this.#e.sendCommand("Target.createBrowserContext",o);return this.#s.updateUserContextConfig(e.browserContextId,{acceptInsecureCerts:r.acceptInsecureCerts,userPromptHandler:r.unhandledPromptBehavior}),{userContext:e.browserContextId}}async removeUserContext(r){const d=r.userContext;if(d==="default")throw new n.InvalidArgumentException("`default` user context cannot be removed");try{await this.#e.sendCommand("Target.disposeBrowserContext",{browserContextId:d})}catch(o){throw o.message.startsWith("Failed to find context with id")?new n.NoSuchUserContextException(o.message):o}return{}}async getUserContexts(){return{userContexts:await this.#r.getUserContexts()}}async#n(r){const d=await this.#e.sendCommand("Browser.getWindowForTarget",{targetId:r});return{active:!1,clientWindow:`${d.windowId}`,state:d.bounds.windowState??"normal",height:d.bounds.height??0,width:d.bounds.width??0,x:d.bounds.left??0,y:d.bounds.top??0}}async getClientWindows(){const r=this.#t.getTopLevelContexts().map(s=>s.cdpTarget.id),d=await Promise.all(r.map(async s=>await this.#n(s))),o=new Set,e=new Array;for(const s of d)o.has(s.clientWindow)||(o.add(s.clientWindow),e.push(s));return{clientWindows:e}}};Ce.BrowserProcessor=t;function a(r){if(!(r.proxyType==="direct"||r.proxyType==="system")){if(r.proxyType==="pac")throw new n.UnsupportedOperationException("PAC proxy configuration is not supported per user context");if(r.proxyType==="autodetect")throw new n.UnsupportedOperationException("Autodetect proxy is not supported per user context");if(r.proxyType==="manual"){const d=[];if(r.httpProxy!==void 0&&d.push(`http=${r.httpProxy}`),r.sslProxy!==void 0&&d.push(`https=${r.sslProxy}`),r.socksProxy!==void 0||r.socksVersion!==void 0){if(r.socksProxy===void 0)throw new n.InvalidArgumentException("'socksVersion' cannot be set without 'socksProxy'");if(r.socksVersion===void 0||typeof r.socksVersion!="number"||!Number.isInteger(r.socksVersion)||r.socksVersion<0||r.socksVersion>255)throw new n.InvalidArgumentException("'socksVersion' must be between 0 and 255");d.push(`socks=socks${r.socksVersion}://${r.socksProxy}`)}return d.length===0?void 0:d.join(";")}throw new n.UnknownErrorException("Unknown proxy type")}}return Ce}var Me={},Qs;function an(){if(Qs)return Me;Qs=1,Object.defineProperty(Me,"__esModule",{value:!0}),Me.CdpProcessor=void 0;const n=j();let t=class{#e;#t;#s;#r;constructor(a,r,d,o){this.#e=a,this.#t=r,this.#s=d,this.#r=o}getSession(a){const r=a.context,d=this.#e.getContext(r).cdpTarget.cdpSessionId;return d===void 0?{}:{session:d}}resolveRealm(a){const r=a.realm,d=this.#t.getRealm({realmId:r});if(d===void 0)throw new n.UnknownErrorException(`Could not find realm ${a.realm}`);return{executionContextId:d.executionContextId}}async sendCommand(a){return{result:await(a.session?this.#s.getCdpClient(a.session):this.#r).sendCommand(a.method,a.params),session:a.session}}};return Me.CdpProcessor=t,Me}var Be={},Zs;function cn(){if(Zs)return Be;Zs=1,Object.defineProperty(Be,"__esModule",{value:!0}),Be.BrowsingContextProcessor=void 0;const n=j();let t=class{#e;#t;#s;#r;#n;constructor(a,r,d,o,e){this.#s=o,this.#n=d,this.#e=a,this.#t=r,this.#r=e,this.#r.addSubscribeHook(n.ChromiumBidi.BrowsingContext.EventNames.ContextCreated,this.#a.bind(this))}getTree(a){return{contexts:(a.root===void 0?this.#t.getTopLevelContexts():[this.#t.getContext(a.root)]).map(r=>r.serializeToBidiValue(a.maxDepth??Number.MAX_VALUE))}}async create(a){let r,d="default";if(a.referenceContext!==void 0){if(r=this.#t.getContext(a.referenceContext),!r.isTopLevelContext())throw new n.InvalidArgumentException("referenceContext should be a top-level context");d=r.userContext}a.userContext!==void 0&&(d=a.userContext);const o=this.#t.getAllContexts().filter(c=>c.userContext===d);let e=!1;switch(a.type){case"tab":e=!1;break;case"window":e=!0;break}o.length||(e=!0);let s;try{s=await this.#e.sendCommand("Target.createTarget",{url:"about:blank",newWindow:e,browserContextId:d==="default"?void 0:d,background:a.background===!0})}catch(c){throw c.message.startsWith("Failed to find browser context with id")||c.message==="browserContextId"?new n.NoSuchUserContextException(`The context ${d} was not found`):c}const i=await this.#t.waitForContext(s.targetId);return await i.lifecycleLoaded(),{context:i.id}}navigate(a){return this.#t.getContext(a.context).navigate(a.url,a.wait??"none")}reload(a){return this.#t.getContext(a.context).reload(a.ignoreCache??!1,a.wait??"none")}async activate(a){const r=this.#t.getContext(a.context);if(!r.isTopLevelContext())throw new n.InvalidArgumentException("Activation is only supported on the top-level context");return await r.activate(),{}}async captureScreenshot(a){return await this.#t.getContext(a.context).captureScreenshot(a)}async print(a){return await this.#t.getContext(a.context).print(a)}async setViewport(a){const r={};a.devicePixelRatio!==void 0&&(r.devicePixelRatio=a.devicePixelRatio),a.viewport!==void 0&&(r.viewport=a.viewport);const d=await this.#i(a.context,a.userContexts);for(const o of a.userContexts??[])this.#s.updateUserContextConfig(o,r);return a.context!==void 0&&this.#s.updateBrowsingContextConfig(a.context,r),await Promise.all(d.map(o=>o.setViewport(a.viewport,a.devicePixelRatio))),{}}async#i(a,r){if(a===void 0&&r===void 0)throw new n.InvalidArgumentException("Either userContexts or context must be provided");if(a!==void 0&&r!==void 0)throw new n.InvalidArgumentException("userContexts and context are mutually exclusive");if(a!==void 0){const o=this.#t.getContext(a);if(!o.isTopLevelContext())throw new n.InvalidArgumentException("Emulating viewport is only supported on the top-level context");return[o]}await this.#n.verifyUserContextIdList(r);const d=[];for(const o of r){const e=this.#t.getTopLevelContexts().filter(s=>s.userContext===o);d.push(...e)}return[...new Set(d).values()]}async traverseHistory(a){const r=this.#t.getContext(a.context);if(!r)throw new n.InvalidArgumentException(`No browsing context with id ${a.context}`);if(!r.isTopLevelContext())throw new n.InvalidArgumentException("Traversing history is only supported on the top-level context");return await r.traverseHistory(a.delta),{}}async handleUserPrompt(a){const r=this.#t.getContext(a.context);try{await r.handleUserPrompt(a.accept,a.userText)}catch(d){throw d.message?.includes("No dialog is showing")?new n.NoSuchAlertException("No dialog is showing"):d}return{}}async close(a){const r=this.#t.getContext(a.context);if(!r.isTopLevelContext())throw new n.InvalidArgumentException(`Non top-level browsing context ${r.id} cannot be closed.`);const d=r.cdpTarget.parentCdpClient;try{const o=new Promise(e=>{const s=i=>{i.targetId===a.context&&(d.off("Target.detachedFromTarget",s),e())};d.on("Target.detachedFromTarget",s)});try{a.promptUnload?await r.close():await d.sendCommand("Target.closeTarget",{targetId:a.context})}catch(e){if(!d.isCloseError(e))throw e}await o}catch(o){if(!(o.code===-32e3&&o.message==="Not attached to an active page"))throw o}return{}}async locateNodes(a){return await this.#t.getContext(a.context).locateNodes(a)}#a(a){return[this.#t.getContext(a),...this.#t.getContext(a).allChildren].forEach(r=>{this.#r.registerEvent({type:"event",method:n.ChromiumBidi.BrowsingContext.EventNames.ContextCreated,params:r.serializeToBidiValue()},r.id)}),Promise.resolve()}};return Be.BrowsingContextProcessor=t,Be}var ne={},er;function dn(){if(er)return ne;er=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.EmulationProcessor=void 0,ne.isValidLocale=a,ne.isValidTimezone=r,ne.isTimeZoneOffsetString=d;const n=It();let t=class{#e;#t;#s;constructor(o,e,s){this.#e=e,this.#t=o,this.#s=s}async setGeolocationOverride(o){if("coordinates"in o&&"error"in o)throw new n.InvalidArgumentException("Coordinates and error cannot be set at the same time");let e=null;if("coordinates"in o){if((o.coordinates?.altitude??null)===null&&(o.coordinates?.altitudeAccuracy??null)!==null)throw new n.InvalidArgumentException("Geolocation altitudeAccuracy can be set only with altitude");e=o.coordinates}else if("error"in o){if(o.error.type!=="positionUnavailable")throw new n.InvalidArgumentException(`Unknown geolocation error ${o.error.type}`);e=o.error}else throw new n.InvalidArgumentException("Coordinates or error should be set");const s=await this.#r(o.contexts,o.userContexts);for(const i of o.contexts??[])this.#s.updateBrowsingContextConfig(i,{geolocation:e});for(const i of o.userContexts??[])this.#s.updateUserContextConfig(i,{geolocation:e});return await Promise.all(s.map(async i=>await i.setGeolocationOverride(e))),{}}async setLocaleOverride(o){const e=o.locale??null;if(e!==null&&!a(e))throw new n.InvalidArgumentException(`Invalid locale "${e}"`);const s=await this.#r(o.contexts,o.userContexts);for(const i of o.contexts??[])this.#s.updateBrowsingContextConfig(i,{locale:e});for(const i of o.userContexts??[])this.#s.updateUserContextConfig(i,{locale:e});return await Promise.all(s.map(async i=>await i.setLocaleOverride(e))),{}}async setScriptingEnabled(o){const e=o.enabled,s=await this.#r(o.contexts,o.userContexts);for(const i of o.contexts??[])this.#s.updateBrowsingContextConfig(i,{scriptingEnabled:e});for(const i of o.userContexts??[])this.#s.updateUserContextConfig(i,{scriptingEnabled:e});return await Promise.all(s.map(async i=>await i.setScriptingEnabled(e))),{}}async setScreenOrientationOverride(o){const e=await this.#r(o.contexts,o.userContexts);for(const s of o.contexts??[])this.#s.updateBrowsingContextConfig(s,{screenOrientation:o.screenOrientation});for(const s of o.userContexts??[])this.#s.updateUserContextConfig(s,{screenOrientation:o.screenOrientation});return await Promise.all(e.map(async s=>await s.setScreenOrientationOverride(o.screenOrientation))),{}}async#r(o,e){if(o===void 0&&e===void 0)throw new n.InvalidArgumentException("Either user contexts or browsing contexts must be provided");if(o!==void 0&&e!==void 0)throw new n.InvalidArgumentException("User contexts and browsing contexts are mutually exclusive");const s=[];if(o===void 0){if(e.length===0)throw new n.InvalidArgumentException("user context should be provided");await this.#e.verifyUserContextIdList(e);for(const i of e){const c=this.#t.getTopLevelContexts().filter(l=>l.userContext===i);s.push(...c)}}else{if(o.length===0)throw new n.InvalidArgumentException("browsing context should be provided");for(const i of o){const c=this.#t.getContext(i);if(!c.isTopLevelContext())throw new n.InvalidArgumentException("The command is only supported on the top-level context");s.push(c)}}return[...new Set(s).values()]}async setTimezoneOverride(o){let e=o.timezone??null;if(e!==null&&!r(e))throw new n.InvalidArgumentException(`Invalid timezone "${e}"`);e!==null&&d(e)&&(e=`GMT${e}`);const s=await this.#r(o.contexts,o.userContexts);for(const i of o.contexts??[])this.#s.updateBrowsingContextConfig(i,{timezone:e});for(const i of o.userContexts??[])this.#s.updateUserContextConfig(i,{timezone:e});return await Promise.all(s.map(async i=>await i.setTimezoneOverride(e))),{}}};ne.EmulationProcessor=t;function a(o){try{return new Intl.Locale(o),!0}catch(e){if(e instanceof RangeError)return!1;throw e}}function r(o){try{return Intl.DateTimeFormat(void 0,{timeZone:o}),!0}catch(e){if(e instanceof RangeError)return!1;throw e}}function d(o){return/^[+-](?:2[0-3]|[01]\d)(?::[0-5]\d)?$/.test(o)}return ne}var je={},kt={},tr;function ge(){if(tr)return kt;tr=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.assert=n;function n(t,a){if(!t)throw new Error(a??"Internal assertion failed.")}return kt}var Ue={},Le={},sr;function un(){if(sr)return Le;sr=1,Object.defineProperty(Le,"__esModule",{value:!0}),Le.isSingleComplexGrapheme=n,Le.isSingleGrapheme=t;function n(a){return t(a)&&a.length>1}function t(a){return[...new Intl.Segmenter("en",{granularity:"grapheme"}).segment(a)].length===1}return Le}var J={},rr;function ir(){if(rr)return J;rr=1,Object.defineProperty(J,"__esModule",{value:!0}),J.WheelSource=J.PointerSource=J.KeySource=J.NoneSource=void 0;class n{type="none"}J.NoneSource=n;class t{type="key";pressed=new Set;#e=0;get modifiers(){return this.#e}get alt(){return(this.#e&1)===1}set alt(o){this.#t(o,1)}get ctrl(){return(this.#e&2)===2}set ctrl(o){this.#t(o,2)}get meta(){return(this.#e&4)===4}set meta(o){this.#t(o,4)}get shift(){return(this.#e&8)===8}set shift(o){this.#t(o,8)}#t(o,e){o?this.#e|=e:this.#e&=~e}}J.KeySource=t;class a{type="pointer";subtype;pointerId;pressed=new Set;x=0;y=0;radiusX;radiusY;force;constructor(o,e){this.pointerId=o,this.subtype=e}get buttons(){let o=0;for(const e of this.pressed)switch(e){case 0:o|=1;break;case 1:o|=4;break;case 2:o|=2;break;case 3:o|=8;break;case 4:o|=16;break}return o}static ClickContext=class ts{static#t=500;static#s=2;count=0;#r;#n;#i;constructor(e,s,i){this.#r=e,this.#n=s,this.#i=i}compare(e){return e.#i-this.#i>ts.#t||Math.abs(e.#r-this.#r)>ts.#s||Math.abs(e.#n-this.#n)>ts.#s}};#e=new Map;setClickCount(o,e){let s=this.#e.get(o);return(!s||s.compare(e))&&(s=e),++s.count,this.#e.set(o,s),s.count}getClickCount(o){return this.#e.get(o)?.count??0}resetClickCount(){this.#e=new Map}}J.PointerSource=a;class r{type="wheel"}return J.WheelSource=r,J}var Ee={},nr;function ln(){if(nr)return Ee;nr=1,Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.getNormalizedKey=n,Ee.getKeyCode=t,Ee.getKeyLocation=a;function n(r){switch(r){case"\uE000":return"Unidentified";case"\uE001":return"Cancel";case"\uE002":return"Help";case"\uE003":return"Backspace";case"\uE004":return"Tab";case"\uE005":return"Clear";case"\uE006":case"\uE007":return"Enter";case"\uE008":return"Shift";case"\uE009":return"Control";case"\uE00A":return"Alt";case"\uE00B":return"Pause";case"\uE00C":return"Escape";case"\uE00D":return" ";case"\uE00E":return"PageUp";case"\uE00F":return"PageDown";case"\uE010":return"End";case"\uE011":return"Home";case"\uE012":return"ArrowLeft";case"\uE013":return"ArrowUp";case"\uE014":return"ArrowRight";case"\uE015":return"ArrowDown";case"\uE016":return"Insert";case"\uE017":return"Delete";case"\uE018":return";";case"\uE019":return"=";case"\uE01A":return"0";case"\uE01B":return"1";case"\uE01C":return"2";case"\uE01D":return"3";case"\uE01E":return"4";case"\uE01F":return"5";case"\uE020":return"6";case"\uE021":return"7";case"\uE022":return"8";case"\uE023":return"9";case"\uE024":return"*";case"\uE025":return"+";case"\uE026":return",";case"\uE027":return"-";case"\uE028":return".";case"\uE029":return"/";case"\uE031":return"F1";case"\uE032":return"F2";case"\uE033":return"F3";case"\uE034":return"F4";case"\uE035":return"F5";case"\uE036":return"F6";case"\uE037":return"F7";case"\uE038":return"F8";case"\uE039":return"F9";case"\uE03A":return"F10";case"\uE03B":return"F11";case"\uE03C":return"F12";case"\uE03D":return"Meta";case"\uE040":return"ZenkakuHankaku";case"\uE050":return"Shift";case"\uE051":return"Control";case"\uE052":return"Alt";case"\uE053":return"Meta";case"\uE054":return"PageUp";case"\uE055":return"PageDown";case"\uE056":return"End";case"\uE057":return"Home";case"\uE058":return"ArrowLeft";case"\uE059":return"ArrowUp";case"\uE05A":return"ArrowRight";case"\uE05B":return"ArrowDown";case"\uE05C":return"Insert";case"\uE05D":return"Delete";default:return r}}function t(r){switch(r){case"`":case"~":return"Backquote";case"\\":case"|":return"Backslash";case"\uE003":return"Backspace";case"[":case"{":return"BracketLeft";case"]":case"}":return"BracketRight";case",":case"<":return"Comma";case"0":case")":return"Digit0";case"1":case"!":return"Digit1";case"2":case"@":return"Digit2";case"3":case"#":return"Digit3";case"4":case"$":return"Digit4";case"5":case"%":return"Digit5";case"6":case"^":return"Digit6";case"7":case"&":return"Digit7";case"8":case"*":return"Digit8";case"9":case"(":return"Digit9";case"=":case"+":return"Equal";case">":return"IntlBackslash";case"a":case"A":return"KeyA";case"b":case"B":return"KeyB";case"c":case"C":return"KeyC";case"d":case"D":return"KeyD";case"e":case"E":return"KeyE";case"f":case"F":return"KeyF";case"g":case"G":return"KeyG";case"h":case"H":return"KeyH";case"i":case"I":return"KeyI";case"j":case"J":return"KeyJ";case"k":case"K":return"KeyK";case"l":case"L":return"KeyL";case"m":case"M":return"KeyM";case"n":case"N":return"KeyN";case"o":case"O":return"KeyO";case"p":case"P":return"KeyP";case"q":case"Q":return"KeyQ";case"r":case"R":return"KeyR";case"s":case"S":return"KeyS";case"t":case"T":return"KeyT";case"u":case"U":return"KeyU";case"v":case"V":return"KeyV";case"w":case"W":return"KeyW";case"x":case"X":return"KeyX";case"y":case"Y":return"KeyY";case"z":case"Z":return"KeyZ";case"-":case"_":return"Minus";case".":return"Period";case"'":case'"':return"Quote";case";":case":":return"Semicolon";case"/":case"?":return"Slash";case"\uE00A":return"AltLeft";case"\uE052":return"AltRight";case"\uE009":return"ControlLeft";case"\uE051":return"ControlRight";case"\uE006":return"Enter";case"\uE00B":return"Pause";case"\uE03D":return"MetaLeft";case"\uE053":return"MetaRight";case"\uE008":return"ShiftLeft";case"\uE050":return"ShiftRight";case" ":case"\uE00D":return"Space";case"\uE004":return"Tab";case"\uE017":return"Delete";case"\uE010":return"End";case"\uE002":return"Help";case"\uE011":return"Home";case"\uE016":return"Insert";case"\uE00F":return"PageDown";case"\uE00E":return"PageUp";case"\uE015":return"ArrowDown";case"\uE012":return"ArrowLeft";case"\uE014":return"ArrowRight";case"\uE013":return"ArrowUp";case"\uE00C":return"Escape";case"\uE031":return"F1";case"\uE032":return"F2";case"\uE033":return"F3";case"\uE034":return"F4";case"\uE035":return"F5";case"\uE036":return"F6";case"\uE037":return"F7";case"\uE038":return"F8";case"\uE039":return"F9";case"\uE03A":return"F10";case"\uE03B":return"F11";case"\uE03C":return"F12";case"\uE019":return"NumpadEqual";case"\uE01A":case"\uE05C":return"Numpad0";case"\uE01B":case"\uE056":return"Numpad1";case"\uE01C":case"\uE05B":return"Numpad2";case"\uE01D":case"\uE055":return"Numpad3";case"\uE01E":case"\uE058":return"Numpad4";case"\uE01F":return"Numpad5";case"\uE020":case"\uE05A":return"Numpad6";case"\uE021":case"\uE057":return"Numpad7";case"\uE022":case"\uE059":return"Numpad8";case"\uE023":case"\uE054":return"Numpad9";case"\uE025":return"NumpadAdd";case"\uE026":return"NumpadComma";case"\uE028":case"\uE05D":return"NumpadDecimal";case"\uE029":return"NumpadDivide";case"\uE007":return"NumpadEnter";case"\uE024":return"NumpadMultiply";case"\uE027":return"NumpadSubtract";default:return}}function a(r){switch(r){case"\uE007":case"\uE008":case"\uE009":case"\uE00A":case"\uE03D":return 1;case"\uE019":case"\uE01A":case"\uE01B":case"\uE01C":case"\uE01D":case"\uE01E":case"\uE01F":case"\uE020":case"\uE021":case"\uE022":case"\uE023":case"\uE024":case"\uE025":case"\uE026":case"\uE027":case"\uE028":case"\uE029":case"\uE054":case"\uE055":case"\uE056":case"\uE057":case"\uE058":case"\uE059":case"\uE05A":case"\uE05B":case"\uE05C":case"\uE05D":return 3;case"\uE050":case"\uE051":case"\uE052":case"\uE053":return 2;default:return 0}}return Ee}var Tt={},or;function hn(){return or||(or=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.KeyToKeyCode=void 0,Tt.KeyToKeyCode={0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,Abort:3,Help:6,Backspace:8,Tab:9,Numpad5:12,NumpadEnter:13,Enter:13,"\\r":13,"\\n":13,ShiftLeft:16,ShiftRight:16,ControlLeft:17,ControlRight:17,AltLeft:18,AltRight:18,Pause:19,CapsLock:20,Escape:27,Convert:28,NonConvert:29,Space:32,Numpad9:33,PageUp:33,Numpad3:34,PageDown:34,End:35,Numpad1:35,Home:36,Numpad7:36,ArrowLeft:37,Numpad4:37,Numpad8:38,ArrowUp:38,ArrowRight:39,Numpad6:39,Numpad2:40,ArrowDown:40,Select:41,Open:43,PrintScreen:44,Insert:45,Numpad0:45,Delete:46,NumpadDecimal:46,Digit0:48,Digit1:49,Digit2:50,Digit3:51,Digit4:52,Digit5:53,Digit6:54,Digit7:55,Digit8:56,Digit9:57,KeyA:65,KeyB:66,KeyC:67,KeyD:68,KeyE:69,KeyF:70,KeyG:71,KeyH:72,KeyI:73,KeyJ:74,KeyK:75,KeyL:76,KeyM:77,KeyN:78,KeyO:79,KeyP:80,KeyQ:81,KeyR:82,KeyS:83,KeyT:84,KeyU:85,KeyV:86,KeyW:87,KeyX:88,KeyY:89,KeyZ:90,MetaLeft:91,MetaRight:92,ContextMenu:93,NumpadMultiply:106,NumpadAdd:107,NumpadSubtract:109,NumpadDivide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,F16:127,F17:128,F18:129,F19:130,F20:131,F21:132,F22:133,F23:134,F24:135,NumLock:144,ScrollLock:145,AudioVolumeMute:173,AudioVolumeDown:174,AudioVolumeUp:175,MediaTrackNext:176,MediaTrackPrevious:177,MediaStop:178,MediaPlayPause:179,Semicolon:186,Equal:187,NumpadEqual:187,Comma:188,Minus:189,Period:190,Slash:191,Backquote:192,BracketLeft:219,Backslash:220,BracketRight:221,Quote:222,AltGraph:225,Props:247,Cancel:3,Clear:12,Shift:16,Control:17,Alt:18,Accept:30,ModeChange:31," ":32,Print:42,Execute:43,"\\u0000":46,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,Meta:91,"*":106,"+":107,"-":109,"/":111,";":186,"=":187,",":188,".":190,"`":192,"[":219,"\\\\":220,"]":221,"'":222,Attn:246,CrSel:247,ExSel:248,EraseEof:249,Play:250,ZoomOut:251,")":48,"!":49,"@":50,"#":51,$:52,"%":53,"^":54,"&":55,"(":57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,":":186,"<":188,_:189,">":190,"?":191,"~":192,"{":219,"|":220,"}":221,'"':222,Camera:44,EndCall:95,VolumeDown:182,VolumeUp:183}),Tt}var ar;function pn(){if(ar)return Ue;ar=1,Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.ActionDispatcher=void 0;const n=j(),t=ge(),a=un(),r=ir(),d=ln(),o=hn(),e=(g=>{const w=g.getClientRects()[0],m=Math.max(0,Math.min(w.x,w.x+w.width)),p=Math.min(window.innerWidth,Math.max(w.x,w.x+w.width)),b=Math.max(0,Math.min(w.y,w.y+w.height)),E=Math.min(window.innerHeight,Math.max(w.y,w.y+w.height));return[m+(p-m>>1),b+(E-b>>1)]}).toString(),s=(()=>navigator.platform.toLowerCase().includes("mac")).toString();async function i(g,w){const m=await(await g.getOrCreateHiddenSandbox()).callFunction(e,!1,{type:"undefined"},[w]);if(m.type==="exception")throw new n.NoSuchElementException(`Origin element ${w.sharedId} was not found`);(0,t.assert)(m.result.type==="array"),(0,t.assert)(m.result.value?.[0]?.type==="number"),(0,t.assert)(m.result.value?.[1]?.type==="number");const{result:{value:[{value:p},{value:b}]}}=m;return{x:p,y:b}}let c=class{static isMacOS=async g=>{const w=await(await g.getOrCreateHiddenSandbox()).callFunction(s,!1);return(0,t.assert)(w.type!=="exception"),(0,t.assert)(w.result.type==="boolean"),w.result.value};#e;#t=0;#s=0;#r;#n;#i;constructor(g,w,m,p){this.#e=w,this.#r=g,this.#n=m,this.#i=p}get#a(){return this.#e.getContext(this.#n)}async dispatchActions(g){await this.#r.queue.run(async()=>{for(const w of g)await this.dispatchTickActions(w)})}async dispatchTickActions(g){this.#t=performance.now(),this.#s=0;for(const{action:m}of g)"duration"in m&&m.duration!==void 0&&(this.#s=Math.max(this.#s,m.duration));const w=[new Promise(m=>setTimeout(m,this.#s))];for(const m of g)w.push(this.#d(m));await Promise.all(w)}async#d({id:g,action:w}){const m=this.#r.get(g),p=this.#r.getGlobalKeyState();switch(w.type){case"keyDown":{await this.#m(m,w),this.#r.cancelList.push({id:g,action:{...w,type:"keyUp"}});break}case"keyUp":{await this.#f(m,w);break}case"pause":break;case"pointerDown":{await this.#o(m,p,w),this.#r.cancelList.push({id:g,action:{...w,type:"pointerUp"}});break}case"pointerMove":{await this.#l(m,p,w);break}case"pointerUp":{await this.#u(m,p,w);break}case"scroll":{await this.#c(m,p,w);break}}}async#o(g,w,m){const{button:p}=m;if(g.pressed.has(p))return;g.pressed.add(p);const{x:b,y:E,subtype:k}=g,{width:C,height:S,pressure:P,twist:T,tangentialPressure:D}=m,{tiltX:F,tiltY:B}=f(m),{modifiers:x}=w,{radiusX:v,radiusY:I}=y(C??1,S??1);switch(k){case"mouse":case"pen":await this.#a.cdpTarget.cdpClient.sendCommand("Input.dispatchMouseEvent",{type:"mousePressed",x:b,y:E,modifiers:x,button:h(p),buttons:g.buttons,clickCount:g.setClickCount(p,new r.PointerSource.ClickContext(b,E,performance.now())),pointerType:k,tangentialPressure:D,tiltX:F,tiltY:B,twist:T,force:P});break;case"touch":await this.#a.cdpTarget.cdpClient.sendCommand("Input.dispatchTouchEvent",{type:"touchStart",touchPoints:[{x:b,y:E,radiusX:v,radiusY:I,tangentialPressure:D,tiltX:F,tiltY:B,twist:T,force:P,id:g.pointerId}],modifiers:x});break}g.radiusX=v,g.radiusY=I,g.force=P}#u(g,w,m){const{button:p}=m;if(!g.pressed.has(p))return;g.pressed.delete(p);const{x:b,y:E,force:k,radiusX:C,radiusY:S,subtype:P}=g,{modifiers:T}=w;switch(P){case"mouse":case"pen":return this.#a.cdpTarget.cdpClient.sendCommand("Input.dispatchMouseEvent",{type:"mouseReleased",x:b,y:E,modifiers:T,button:h(p),buttons:g.buttons,clickCount:g.getClickCount(p),pointerType:P});case"touch":return this.#a.cdpTarget.cdpClient.sendCommand("Input.dispatchTouchEvent",{type:"touchEnd",touchPoints:[{x:b,y:E,id:g.pointerId,force:k,radiusX:C,radiusY:S}],modifiers:T})}}async#l(g,w,m){const{x:p,y:b,subtype:E}=g,{width:k,height:C,pressure:S,twist:P,tangentialPressure:T,x:D,y:F,origin:B="viewport",duration:x=this.#s}=m,{tiltX:v,tiltY:I}=f(m),{radiusX:N,radiusY:q}=y(k??1,C??1),{targetX:H,targetY:Y}=await this.#p(B,D,F,p,b);if(H<0||Y<0)throw new n.MoveTargetOutOfBoundsException(`Cannot move beyond viewport (x: ${H}, y: ${Y})`);let V;do{const Q=x>0?(performance.now()-this.#t)/x:1;V=Q>=1;let ie,ve;if(V?(ie=H,ve=Y):(ie=Math.round(Q*(H-p)+p),ve=Math.round(Q*(Y-b)+b)),g.x!==ie||g.y!==ve){const{modifiers:fs}=w;switch(E){case"mouse":await this.#a.cdpTarget.cdpClient.sendCommand("Input.dispatchMouseEvent",{type:"mouseMoved",x:ie,y:ve,modifiers:fs,clickCount:0,button:h(g.pressed.values().next().value??5),buttons:g.buttons,pointerType:E,tangentialPressure:T,tiltX:v,tiltY:I,twist:P,force:S});break;case"pen":g.pressed.size!==0&&await this.#a.cdpTarget.cdpClient.sendCommand("Input.dispatchMouseEvent",{type:"mouseMoved",x:ie,y:ve,modifiers:fs,clickCount:0,button:h(g.pressed.values().next().value??5),buttons:g.buttons,pointerType:E,tangentialPressure:T,tiltX:v,tiltY:I,twist:P,force:S??.5});break;case"touch":g.pressed.size!==0&&await this.#a.cdpTarget.cdpClient.sendCommand("Input.dispatchTouchEvent",{type:"touchMove",touchPoints:[{x:ie,y:ve,radiusX:N,radiusY:q,tangentialPressure:T,tiltX:v,tiltY:I,twist:P,force:S,id:g.pointerId}],modifiers:fs});break}g.x=ie,g.y=ve,g.radiusX=N,g.radiusY=q,g.force=S}}while(!V)}async#h(){if(this.#a.id===this.#a.cdpTarget.id)return{x:0,y:0};const{backendNodeId:g}=await this.#a.cdpTarget.cdpClient.sendCommand("DOM.getFrameOwner",{frameId:this.#a.id}),{model:w}=await this.#a.cdpTarget.cdpClient.sendCommand("DOM.getBoxModel",{backendNodeId:g});return{x:w.content[0],y:w.content[1]}}async#p(g,w,m,p,b){let E,k;const C=await this.#h();switch(g){case"viewport":E=w+C.x,k=m+C.y;break;case"pointer":E=p+w+C.x,k=b+m+C.y;break;default:{const{x:S,y:P}=await i(this.#a,g.element);E=S+w+C.x,k=P+m+C.y;break}}return{targetX:E,targetY:k}}async#c(g,w,m){const{deltaX:p,deltaY:b,x:E,y:k,origin:C="viewport",duration:S=this.#s}=m;if(C==="pointer")throw new n.InvalidArgumentException('"pointer" origin is invalid for scrolling.');const{targetX:P,targetY:T}=await this.#p(C,E,k,0,0);if(P<0||T<0)throw new n.MoveTargetOutOfBoundsException(`Cannot move beyond viewport (x: ${P}, y: ${T})`);let D=0,F=0,B;do{const x=S>0?(performance.now()-this.#t)/S:1;B=x>=1;let v,I;if(B?(v=p-D,I=b-F):(v=Math.round(x*p-D),I=Math.round(x*b-F)),v!==0||I!==0){const{modifiers:N}=w;await this.#a.cdpTarget.cdpClient.sendCommand("Input.dispatchMouseEvent",{type:"mouseWheel",deltaX:v,deltaY:I,x:P,y:T,modifiers:N}),D+=v,F+=I}}while(!B)}async#m(g,w){const m=w.value;if(!(0,a.isSingleGrapheme)(m))throw new n.InvalidArgumentException(`Invalid key value: ${m}`);const p=(0,a.isSingleComplexGrapheme)(m),b=(0,d.getNormalizedKey)(m),E=g.pressed.has(b),k=(0,d.getKeyCode)(m),C=(0,d.getKeyLocation)(m);switch(b){case"Alt":g.alt=!0;break;case"Shift":g.shift=!0;break;case"Control":g.ctrl=!0;break;case"Meta":g.meta=!0;break}g.pressed.add(b);const{modifiers:S}=g,P=l(b,g,p),T=u(k??"",g)??P;let D;if(this.#i&&g.meta)switch(k){case"KeyA":D="SelectAll";break;case"KeyC":D="Copy";break;case"KeyV":D=g.shift?"PasteAndMatchStyle":"Paste";break;case"KeyX":D="Cut";break;case"KeyZ":D=g.shift?"Redo":"Undo";break}const F=[this.#a.cdpTarget.cdpClient.sendCommand("Input.dispatchKeyEvent",{type:T?"keyDown":"rawKeyDown",windowsVirtualKeyCode:o.KeyToKeyCode[b],key:b,code:k,text:T,unmodifiedText:P,autoRepeat:E,isSystemKey:g.alt||void 0,location:C<3?C:void 0,isKeypad:C===3,modifiers:S,commands:D?[D]:void 0})];b==="Escape"&&!g.alt&&(this.#i&&!g.ctrl&&!g.meta||!this.#i)&&F.push(this.#a.cdpTarget.cdpClient.sendCommand("Input.cancelDragging")),await Promise.all(F)}#f(g,w){const m=w.value;if(!(0,a.isSingleGrapheme)(m))throw new n.InvalidArgumentException(`Invalid key value: ${m}`);const p=(0,a.isSingleComplexGrapheme)(m),b=(0,d.getNormalizedKey)(m);if(!g.pressed.has(b))return;const E=(0,d.getKeyCode)(m),k=(0,d.getKeyLocation)(m);switch(b){case"Alt":g.alt=!1;break;case"Shift":g.shift=!1;break;case"Control":g.ctrl=!1;break;case"Meta":g.meta=!1;break}g.pressed.delete(b);const{modifiers:C}=g,S=l(b,g,p),P=u(E??"",g)??S;return this.#a.cdpTarget.cdpClient.sendCommand("Input.dispatchKeyEvent",{type:"keyUp",windowsVirtualKeyCode:o.KeyToKeyCode[b],key:b,code:E,text:P,unmodifiedText:S,location:k<3?k:void 0,isSystemKey:g.alt||void 0,isKeypad:k===3,modifiers:C})}};Ue.ActionDispatcher=c;const l=(g,w,m)=>m?g:g==="Enter"?"\r":[...g].length===1?w.shift?g.toLocaleUpperCase("en-US"):g:void 0,u=(g,w)=>{if(w.ctrl){switch(g){case"Digit2":if(w.shift)return"\0";break;case"KeyA":return"";case"KeyB":return"";case"KeyC":return"";case"KeyD":return"";case"KeyE":return"";case"KeyF":return"";case"KeyG":return"\x07";case"KeyH":return"\b";case"KeyI":return"	";case"KeyJ":return`
`;case"KeyK":return"\v";case"KeyL":return"\f";case"KeyM":return"\r";case"KeyN":return"";case"KeyO":return"";case"KeyP":return"";case"KeyQ":return"";case"KeyR":return"";case"KeyS":return"";case"KeyT":return"";case"KeyU":return"";case"KeyV":return"";case"KeyW":return"";case"KeyX":return"";case"KeyY":return"";case"KeyZ":return"";case"BracketLeft":return"\x1B";case"Backslash":return"";case"BracketRight":return"";case"Digit6":if(w.shift)return"";break;case"Minus":return""}return""}if(w.alt)return""};function h(g){switch(g){case 0:return"left";case 1:return"middle";case 2:return"right";case 3:return"back";case 4:return"forward";default:return"none"}}function f(g){const w=g.altitudeAngle??Math.PI/2,m=g.azimuthAngle??0;let p=0,b=0;if(w===0&&((m===0||m===2*Math.PI)&&(p=Math.PI/2),m===Math.PI/2&&(b=Math.PI/2),m===Math.PI&&(p=-Math.PI/2),m===3*Math.PI/2&&(b=-Math.PI/2),m>0&&m<Math.PI/2&&(p=Math.PI/2,b=Math.PI/2),m>Math.PI/2&&m<Math.PI&&(p=-Math.PI/2,b=Math.PI/2),m>Math.PI&&m<3*Math.PI/2&&(p=-Math.PI/2,b=-Math.PI/2),m>3*Math.PI/2&&m<2*Math.PI&&(p=Math.PI/2,b=-Math.PI/2)),w!==0){const k=Math.tan(w);p=Math.atan(Math.cos(m)/k),b=Math.atan(Math.sin(m)/k)}const E=180/Math.PI;return{tiltX:Math.round(p*E),tiltY:Math.round(b*E)}}function y(g,w){return{radiusX:g?g/2:.5,radiusY:w?w/2:.5}}return Ue}var qe={},$e={},ze={},cr;function mn(){if(cr)return ze;cr=1,Object.defineProperty(ze,"__esModule",{value:!0}),ze.Mutex=void 0;let n=class{#e=!1;#t=[];acquire(){const t={resolved:!1};return this.#e?new Promise(a=>{this.#t.push(()=>a(this.#s.bind(this,t)))}):(this.#e=!0,Promise.resolve(this.#s.bind(this,t)))}#s(t){if(t.resolved)throw new Error("Cannot release more than once.");t.resolved=!0;const a=this.#t.shift();if(!a){this.#e=!1;return}a()}async run(t){const a=await this.acquire();try{return await t()}finally{a()}}};return ze.Mutex=n,ze}var dr;function gn(){if(dr)return $e;dr=1,Object.defineProperty($e,"__esModule",{value:!0}),$e.InputState=void 0;const n=j(),t=mn(),a=ir();let r=class{cancelList=[];#e=new Map;#t=new t.Mutex;getOrCreate(d,o,e){let s=this.#e.get(d);if(!s){switch(o){case"none":s=new a.NoneSource;break;case"key":s=new a.KeySource;break;case"pointer":{let i=e==="mouse"?0:2;const c=new Set;for(const[,l]of this.#e)l.type==="pointer"&&c.add(l.pointerId);for(;c.has(i);)++i;s=new a.PointerSource(i,e);break}case"wheel":s=new a.WheelSource;break;default:throw new n.InvalidArgumentException(`Expected "none", "key", "pointer", or "wheel". Found unknown source type ${o}.`)}return this.#e.set(d,s),s}if(s.type!==o)throw new n.InvalidArgumentException(`Input source type of ${d} is ${s.type}, but received ${o}.`);return s}get(d){const o=this.#e.get(d);if(!o)throw new n.UnknownErrorException("Internal error.");return o}getGlobalKeyState(){const d=new a.KeySource;for(const[,o]of this.#e)if(o.type==="key"){for(const e of o.pressed)d.pressed.add(e);d.alt||=o.alt,d.ctrl||=o.ctrl,d.meta||=o.meta,d.shift||=o.shift}return d}get queue(){return this.#t}};return $e.InputState=r,$e}var ur;function fn(){if(ur)return qe;ur=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.InputStateManager=void 0;const n=ge(),t=gn();let a=class extends WeakMap{get(r){return(0,n.assert)(r.isTopLevelContext()),this.has(r)||this.set(r,new t.InputState),super.get(r)}};return qe.InputStateManager=a,qe}var lr;function wn(){if(lr)return je;lr=1,Object.defineProperty(je,"__esModule",{value:!0}),je.InputProcessor=void 0;const n=j(),t=ge(),a=pn(),r=fn();let d=class{#e;#t=new r.InputStateManager;constructor(o){this.#e=o}async performActions(o){const e=this.#e.getContext(o.context),s=this.#t.get(e.top),i=this.#s(o,s);return await new a.ActionDispatcher(s,this.#e,o.context,await a.ActionDispatcher.isMacOS(e).catch(()=>!1)).dispatchActions(i),{}}async releaseActions(o){const e=this.#e.getContext(o.context),s=e.top,i=this.#t.get(s);return await new a.ActionDispatcher(i,this.#e,o.context,await a.ActionDispatcher.isMacOS(e).catch(()=>!1)).dispatchTickActions(i.cancelList.reverse()),this.#t.delete(s),{}}async setFiles(o){const e=await this.#e.getContext(o.context).getOrCreateHiddenSandbox();let s;try{s=await e.callFunction(String(function(l){if(!(this instanceof HTMLInputElement))return this instanceof Element?1:0;if(this.type!=="file")return 2;if(this.disabled)return 3;if(l>1&&!this.multiple)return 4}),!1,o.element,[{type:"number",value:o.files.length}])}catch{throw new n.NoSuchNodeException(`Could not find element ${o.element.sharedId}`)}if((0,t.assert)(s.type==="success"),s.result.type==="number")switch(s.result.value){case 0:throw new n.NoSuchElementException(`Could not find element ${o.element.sharedId}`);case 1:throw new n.UnableToSetFileInputException(`Element ${o.element.sharedId} is not a input`);case 2:throw new n.UnableToSetFileInputException(`Input element ${o.element.sharedId} is not a file type`);case 3:throw new n.UnableToSetFileInputException(`Input element ${o.element.sharedId} is disabled`);case 4:throw new n.UnableToSetFileInputException("Cannot set multiple files on a non-multiple input element")}if(o.files.length===0)return await e.callFunction(String(function(){if(this.files?.length===0){this.dispatchEvent(new Event("cancel",{bubbles:!0}));return}this.files=new DataTransfer().files,this.dispatchEvent(new Event("input",{bubbles:!0,composed:!0})),this.dispatchEvent(new Event("change",{bubbles:!0}))}),!1,o.element),{};const i=[];for(let l=0;l<o.files.length;++l){const u=await e.callFunction(String(function(y){return this.files?.item(y)}),!1,o.element,[{type:"number",value:0}],"root");if((0,t.assert)(u.type==="success"),u.result.type!=="object")break;const{handle:h}=u.result;(0,t.assert)(h!==void 0);const{path:f}=await e.cdpClient.sendCommand("DOM.getFileInfo",{objectId:h});i.push(f),e.disown(h).catch(void 0)}i.sort();const c=[...o.files].sort();if(i.length!==o.files.length||c.some((l,u)=>i[u]!==l)){const{objectId:l}=await e.deserializeForCdp(o.element);(0,t.assert)(l!==void 0),await e.cdpClient.sendCommand("DOM.setFileInputFiles",{files:o.files,objectId:l})}else await e.callFunction(String(function(){this.dispatchEvent(new Event("cancel",{bubbles:!0}))}),!1,o.element);return{}}#s(o,e){const s=[];for(const i of o.actions){switch(i.type){case"pointer":{i.parameters??={pointerType:"mouse"},i.parameters.pointerType??="mouse";const l=e.getOrCreate(i.id,"pointer",i.parameters.pointerType);if(l.subtype!==i.parameters.pointerType)throw new n.InvalidArgumentException(`Expected input source ${i.id} to be ${l.subtype}; got ${i.parameters.pointerType}.`);l.resetClickCount();break}default:e.getOrCreate(i.id,i.type)}const c=i.actions.map(l=>({id:i.id,action:l}));for(let l=0;l<c.length;l++)s.length===l&&s.push([]),s[l].push(c[l])}return s}};return je.InputProcessor=d,je}var Se={},z={},Nt={},hr;function vn(){if(hr)return Nt;hr=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.base64ToString=n;function n(t){return"atob"in globalThis?globalThis.atob(t):Buffer.from(t,"base64").toString("ascii")}return Nt}var pr;function Ot(){if(pr)return z;pr=1,Object.defineProperty(z,"__esModule",{value:!0}),z.computeHeadersSize=a,z.stringToBase64=r,z.bidiNetworkHeadersFromCdpNetworkHeaders=o,z.bidiNetworkHeadersFromCdpNetworkHeadersEntries=e,z.cdpNetworkHeadersFromBidiNetworkHeaders=s,z.bidiNetworkHeadersFromCdpFetchHeaders=i,z.cdpFetchHeadersFromBidiNetworkHeaders=c,z.networkHeaderFromCookieHeaders=l,z.cdpAuthChallengeResponseFromBidiAuthContinueWithAuthAction=u,z.cdpToBiDiCookie=h,z.deserializeByteValue=f,z.bidiToCdpCookie=y,z.sameSiteBiDiToCdp=w,z.isSpecialScheme=m,z.matchUrlPattern=b,z.bidiBodySizeFromCdpPostDataEntries=E,z.getTiming=k;const n=It(),t=vn();function a(C){const S=C.reduce((P,T)=>`${P}${T.name}: ${T.value.value}\r
`,"");return new TextEncoder().encode(S).length}function r(C){return d(new TextEncoder().encode(C))}function d(C){const S=[];for(let T=0;T<C.length;T+=65534){const D=C.subarray(T,T+65534);S.push(String.fromCodePoint.apply(null,D))}const P=S.join("");return btoa(P)}function o(C){return C?Object.entries(C).map(([S,P])=>({name:S,value:{type:"string",value:P}})):[]}function e(C){return C?C.map(({name:S,value:P})=>({name:S,value:{type:"string",value:P}})):[]}function s(C){if(C!==void 0)return C.reduce((S,P)=>(S[P.name]=P.value.value,S),{})}function i(C){return C?C.map(({name:S,value:P})=>({name:S,value:{type:"string",value:P}})):[]}function c(C){if(C!==void 0)return C.map(({name:S,value:P})=>({name:S,value:P.value}))}function l(C){return C===void 0?void 0:{name:"Cookie",value:{type:"string",value:C.reduce((S,P,T)=>{T>0&&(S+=";");const D=P.value.type==="base64"?btoa(P.value.value):P.value.value;return S+=`${P.name}=${D}`,S},"")}}}function u(C){switch(C){case"default":return"Default";case"cancel":return"CancelAuth";case"provideCredentials":return"ProvideCredentials"}}function h(C){const S={name:C.name,value:{type:"string",value:C.value},domain:C.domain,path:C.path,size:C.size,httpOnly:C.httpOnly,secure:C.secure,sameSite:C.sameSite===void 0?"none":g(C.sameSite),...C.expires>=0?{expiry:C.expires}:void 0};return S["goog:session"]=C.session,S["goog:priority"]=C.priority,S["goog:sameParty"]=C.sameParty,S["goog:sourceScheme"]=C.sourceScheme,S["goog:sourcePort"]=C.sourcePort,C.partitionKey!==void 0&&(S["goog:partitionKey"]=C.partitionKey),C.partitionKeyOpaque!==void 0&&(S["goog:partitionKeyOpaque"]=C.partitionKeyOpaque),S}function f(C){return C.type==="base64"?(0,t.base64ToString)(C.value):C.value}function y(C,S){const P=f(C.cookie.value),T={name:C.cookie.name,value:P,domain:C.cookie.domain,path:C.cookie.path??"/",secure:C.cookie.secure??!1,httpOnly:C.cookie.httpOnly??!1,...S.sourceOrigin!==void 0&&{partitionKey:{hasCrossSiteAncestor:!1,topLevelSite:S.sourceOrigin}},...C.cookie.expiry!==void 0&&{expires:C.cookie.expiry},...C.cookie.sameSite!==void 0&&{sameSite:w(C.cookie.sameSite)}};return C.cookie["goog:url"]!==void 0&&(T.url=C.cookie["goog:url"]),C.cookie["goog:priority"]!==void 0&&(T.priority=C.cookie["goog:priority"]),C.cookie["goog:sameParty"]!==void 0&&(T.sameParty=C.cookie["goog:sameParty"]),C.cookie["goog:sourceScheme"]!==void 0&&(T.sourceScheme=C.cookie["goog:sourceScheme"]),C.cookie["goog:sourcePort"]!==void 0&&(T.sourcePort=C.cookie["goog:sourcePort"]),T}function g(C){switch(C){case"Strict":return"strict";case"None":return"none";case"Lax":return"lax";default:return"lax"}}function w(C){switch(C){case"none":return"None";case"strict":return"Strict";case"default":case"lax":return"Lax"}throw new n.InvalidArgumentException(`Unknown 'sameSite' value ${C}`)}function m(C){return["ftp","file","http","https","ws","wss"].includes(C.replace(/:$/,""))}function p(C){return C.protocol.replace(/:$/,"")}function b(C,S){const P=new URL(S);return!(C.protocol!==void 0&&C.protocol!==p(P)||C.hostname!==void 0&&C.hostname!==P.hostname||C.port!==void 0&&C.port!==P.port||C.pathname!==void 0&&C.pathname!==P.pathname||C.search!==void 0&&C.search!==P.search)}function E(C){let S=0;for(const P of C)S+=atob(P.bytes??"").length;return S}function k(C,S=0){return!C||C<=0||C+S<=0?0:C+S}return z}var mr;function gr(){if(mr)return Se;mr=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.NetworkProcessor=void 0,Se.parseBiDiHeaders=d;const n=j(),t=Ot();let a=class se{#e;#t;#s;#r;constructor(e,s,i,c){this.#s=i,this.#e=e,this.#t=s,this.#r=c}async addIntercept(e){this.#e.verifyTopLevelContextsList(e.contexts);const s=e.urlPatterns??[],i=se.parseUrlPatterns(s),c=this.#t.addIntercept({urlPatterns:i,phases:e.phases,contexts:e.contexts});return await this.#n(),{intercept:c}}async continueRequest(e){if(e.url!==void 0&&se.parseUrlString(e.url),e.method!==void 0&&!se.isMethodValid(e.method))throw new n.InvalidArgumentException(`Method '${e.method}' is invalid.`);e.headers&&se.validateHeaders(e.headers);const s=this.#a(e.request,["beforeRequestSent"]);try{await s.continueRequest(e)}catch(i){throw se.wrapInterceptionError(i)}return{}}async continueResponse(e){e.headers&&se.validateHeaders(e.headers);const s=this.#a(e.request,["authRequired","responseStarted"]);try{await s.continueResponse(e)}catch(i){throw se.wrapInterceptionError(i)}return{}}async continueWithAuth(e){const s=e.request;return await this.#a(s,["authRequired"]).continueWithAuth(e),{}}async failRequest({request:e}){const s=this.#i(e);if(s.interceptPhase==="authRequired")throw new n.InvalidArgumentException(`Request '${e}' in 'authRequired' phase cannot be failed`);if(!s.interceptPhase)throw new n.NoSuchRequestException(`No blocked request found for network id '${e}'`);return await s.failRequest("Failed"),{}}async provideResponse(e){e.headers&&se.validateHeaders(e.headers);const s=this.#a(e.request,["beforeRequestSent","responseStarted","authRequired"]);try{await s.provideResponse(e)}catch(i){throw se.wrapInterceptionError(i)}return{}}async#n(){await Promise.all(this.#e.getAllContexts().map(e=>e.cdpTarget.toggleNetwork()))}async removeIntercept(e){return this.#t.removeIntercept(e.intercept),await this.#n(),{}}async setCacheBehavior(e){const s=this.#e.verifyTopLevelContextsList(e.contexts);if(s.size===0)return this.#t.defaultCacheBehavior=e.cacheBehavior,await Promise.all(this.#e.getAllContexts().map(c=>c.cdpTarget.toggleSetCacheDisabled())),{};const i=e.cacheBehavior==="bypass";return await Promise.all([...s.values()].map(c=>c.cdpTarget.toggleSetCacheDisabled(i))),{}}#i(e){const s=this.#t.getRequestById(e);if(!s)throw new n.NoSuchRequestException(`Network request with ID '${e}' doesn't exist`);return s}#a(e,s){const i=this.#i(e);if(!i.interceptPhase)throw new n.NoSuchRequestException(`No blocked request found for network id '${e}'`);if(i.interceptPhase&&!s.includes(i.interceptPhase))throw new n.InvalidArgumentException(`Blocked request for network id '${e}' is in '${i.interceptPhase}' phase`);return i}static validateHeaders(e){for(const s of e){let i;if(s.value.type==="string"?i=s.value.value:i=atob(s.value.value),i!==i.trim()||i.includes(`
`)||i.includes("\0"))throw new n.InvalidArgumentException(`Header value '${i}' is not acceptable value`)}}static isMethodValid(e){return/^[!#$%&'*+\-.^_`|~a-zA-Z\d]+$/.test(e)}static parseUrlString(e){try{return new URL(e)}catch(s){throw new n.InvalidArgumentException(`Invalid URL '${e}': ${s}`)}}static parseUrlPatterns(e){return e.map(s=>{let i="",c=!0,l=!0,u=!0,h=!0,f=!0;switch(s.type){case"string":{i=r(s.pattern);break}case"pattern":{if(s.protocol===void 0)c=!1,i+="http";else{if(s.protocol==="")throw new n.InvalidArgumentException("URL pattern must specify a protocol");if(s.protocol=r(s.protocol),!s.protocol.match(/^[a-zA-Z+-.]+$/))throw new n.InvalidArgumentException("Forbidden characters");i+=s.protocol}const g=i.toLocaleLowerCase();if(i+=":",(0,t.isSpecialScheme)(g)&&(i+="//"),s.hostname===void 0)g!=="file"&&(i+="placeholder"),l=!1;else{if(s.hostname==="")throw new n.InvalidArgumentException("URL pattern must specify a hostname");if(s.protocol==="file")throw new n.InvalidArgumentException("URL pattern protocol cannot be 'file'");s.hostname=r(s.hostname);let w=!1;for(const m of s.hostname){if(m==="/"||m==="?"||m==="#")throw new n.InvalidArgumentException("'/', '?', '#' are forbidden in hostname");if(!w&&m===":")throw new n.InvalidArgumentException("':' is only allowed inside brackets in hostname");m==="["&&(w=!0),m==="]"&&(w=!1)}i+=s.hostname}if(s.port===void 0)u=!1;else{if(s.port==="")throw new n.InvalidArgumentException("URL pattern must specify a port");if(s.port=r(s.port),i+=":",!s.port.match(/^\d+$/))throw new n.InvalidArgumentException("Forbidden characters");i+=s.port}if(s.pathname===void 0)h=!1;else{if(s.pathname=r(s.pathname),s.pathname[0]!=="/"&&(i+="/"),s.pathname.includes("#")||s.pathname.includes("?"))throw new n.InvalidArgumentException("Forbidden characters");i+=s.pathname}if(s.search===void 0)f=!1;else{if(s.search=r(s.search),s.search[0]!=="?"&&(i+="?"),s.search.includes("#"))throw new n.InvalidArgumentException("Forbidden characters");i+=s.search}break}}const y=g=>{const w={"ftp:":21,"file:":null,"http:":80,"https:":443,"ws:":80,"wss:":443};if((0,t.isSpecialScheme)(g.protocol)&&w[g.protocol]!==null&&(!g.port||String(w[g.protocol])===g.port))return"";if(g.port)return g.port};try{const g=new URL(i);return{protocol:c?g.protocol.replace(/:$/,""):void 0,hostname:l?g.hostname:void 0,port:u?y(g):void 0,pathname:h&&g.pathname?g.pathname:void 0,search:f?g.search:void 0}}catch(g){throw new n.InvalidArgumentException(`${g.message} '${i}'`)}})}static wrapInterceptionError(e){return e?.message.includes("Invalid header")||e?.message.includes("Unsafe header")?new n.InvalidArgumentException(e.message):e}async addDataCollector(e){if(e.userContexts!==void 0&&e.contexts!==void 0)throw new n.InvalidArgumentException("'contexts' and 'userContexts' are mutually exclusive");if(e.userContexts!==void 0&&await this.#s.verifyUserContextIdList(e.userContexts),e.contexts!==void 0){for(const i of e.contexts)if(!this.#e.getContext(i).isTopLevelContext())throw new n.InvalidArgumentException("Data collectors are available only on top-level browsing contexts")}const s=this.#t.addDataCollector(e);return await this.#n(),{collector:s}}async getData(e){return await this.#t.getCollectedData(e)}async removeDataCollector(e){return this.#t.removeDataCollector(e),await this.#n(),{}}disownData(e){return this.#t.disownData(e),{}}async setExtraHeaders(e){if(e.userContexts!==void 0&&e.contexts!==void 0)throw new n.InvalidArgumentException("contexts and userContexts are mutually exclusive");const s=d(e.headers),i=new Set;return e.userContexts===void 0&&e.contexts===void 0&&(this.#r.updateGlobalConfig({extraHeaders:s}),this.#e.getAllContexts().forEach(c=>i.add(c.cdpTarget))),e.userContexts!==void 0&&(await this.#s.verifyUserContextIdList(e.userContexts),e.userContexts.forEach(c=>{this.#r.updateUserContextConfig(c,{extraHeaders:s}),this.#e.getAllContexts().filter(l=>l.userContext===c).forEach(l=>i.add(l.cdpTarget))})),e.contexts!==void 0&&(this.#e.verifyTopLevelContextsList(e.contexts),e.contexts.forEach(c=>{this.#r.updateBrowsingContextConfig(c,{extraHeaders:s}),i.add(this.#e.getContext(c).cdpTarget),this.#e.getContext(c).allChildren.forEach(l=>i.add(l.cdpTarget))})),await Promise.all(Array.from(i).map(c=>c.setExtraHeaders(s))),{}}};Se.NetworkProcessor=a;function r(o){const e=new Set(["(",")","*","{","}"]);let s="",i=!1;for(const c of o){if(!i){if(e.has(c))throw new n.InvalidArgumentException("Forbidden characters");if(c==="\\"){i=!0;continue}}s+=c,i=!1}return s}function d(o){const e={};for(const s of o)if(s.value.type==="string")e[s.name]===void 0?e[s.name]=s.value.value:e[s.name]=`${e[s.name]}, ${s.value.value}`;else throw new n.UnsupportedOperationException("Only string headers values are supported");return e}return Se}var _e={},fr;function yn(){if(fr)return _e;fr=1,Object.defineProperty(_e,"__esModule",{value:!0}),_e.PermissionsProcessor=void 0;const n=j();let t=class{#e;constructor(a){this.#e=a}async setPermissions(a){try{const r=a["goog:userContext"]||a.userContext;await this.#e.sendCommand("Browser.setPermission",{origin:a.origin,browserContextId:r&&r!=="default"?r:void 0,permission:{name:a.descriptor.name},setting:a.state})}catch(r){if(r.message==="Permission can't be granted to opaque origins.")return{};throw new n.InvalidArgumentException(r.message)}return{}}};return _e.PermissionsProcessor=t,_e}var He={},Ke={},Dt={};const bn=Si(Qo);var wr;function fe(){if(wr)return Dt;wr=1,Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.uuidv4=t;function n(a){return a.reduce((r,d)=>r+d.toString(16).padStart(2,"0"),"")}function t(){if("crypto"in globalThis&&"randomUUID"in globalThis.crypto)return globalThis.crypto.randomUUID();const a=new Uint8Array(16);return"crypto"in globalThis&&"getRandomValues"in globalThis.crypto?globalThis.crypto.getRandomValues(a):bn.webcrypto.getRandomValues(a),a[6]=a[6]&15|64,a[8]=a[8]&63|128,[n(a.subarray(0,4)),n(a.subarray(4,6)),n(a.subarray(6,8)),n(a.subarray(8,10)),n(a.subarray(10,16))].join("-")}return Dt}var We={},vr;function yr(){if(vr)return We;vr=1,Object.defineProperty(We,"__esModule",{value:!0}),We.ChannelProxy=void 0;const n=j(),t=G(),a=fe();let r=class ss{#e;#t=(0,a.uuidv4)();#s;constructor(o,e){this.#e=o,this.#s=e}async init(o,e){const s=await ss.#n(o),i=await ss.#i(o,s);return this.#a(o,s,e),i}async startListenerFromWindow(o,e){try{const s=await this.#d(o);this.#a(o,s,e)}catch(s){this.#s?.(t.LogType.debugError,s)}}static#r(){return`(${String(()=>{const o=[];let e=null;return{async getMessage(){return await(o.length>0?Promise.resolve():new Promise(s=>{e=s})),o.shift()},sendMessage(s){o.push(s),e!==null&&(e(),e=null)}}})})()`}static async#n(o){const e=await o.cdpClient.sendCommand("Runtime.evaluate",{expression:this.#r(),contextId:o.executionContextId,serializationOptions:{serialization:"idOnly"}});if(e.exceptionDetails||e.result.objectId===void 0)throw new Error("Cannot create channel");return e.result.objectId}static async#i(o,e){return(await o.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(s=>s.sendMessage),arguments:[{objectId:e}],executionContextId:o.executionContextId,serializationOptions:{serialization:"idOnly"}})).result.objectId}async#a(o,e,s){for(;;)try{const i=await o.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(async c=>await c.getMessage()),arguments:[{objectId:e}],awaitPromise:!0,executionContextId:o.executionContextId,serializationOptions:{serialization:"deep",maxDepth:this.#e.serializationOptions?.maxObjectDepth??void 0}});if(i.exceptionDetails)throw new Error("Runtime.callFunctionOn in ChannelProxy",{cause:i.exceptionDetails});for(const c of o.associatedBrowsingContexts)s.registerEvent({type:"event",method:n.ChromiumBidi.Script.EventNames.Message,params:{channel:this.#e.channel,data:o.cdpToBidiValue(i,this.#e.ownership??"none"),source:o.source}},c.id)}catch(i){this.#s?.(t.LogType.debugError,i);break}}async#d(o){const e=await o.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(s=>{const i=window;if(i[s]===void 0)return new Promise(l=>i[s]=l);const c=i[s];return delete i[s],c}),arguments:[{value:this.#t}],executionContextId:o.executionContextId,awaitPromise:!0,serializationOptions:{serialization:"idOnly"}});if(e.exceptionDetails!==void 0||e.result.objectId===void 0)throw new Error(`ChannelHandle not found in window["${this.#t}"]`);return e.result.objectId}getEvalInWindowStr(){const o=String((s,i)=>{const c=window;return c[s]===void 0?c[s]=i:(c[s](i),delete c[s]),i.sendMessage}),e=ss.#r();return`(${o})('${this.#t}',${e})`}};return We.ChannelProxy=r,We}var br;function xn(){if(br)return Ke;br=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.PreloadScript=void 0;const n=fe(),t=yr();let a=class{#e=(0,n.uuidv4)();#t=[];#s;#r=new Set;#n;#i;#a;#d;get id(){return this.#e}get targetIds(){return this.#r}constructor(r,d){this.#n=r.arguments?.map(o=>new t.ChannelProxy(o.value,d))??[],this.#s=r.functionDeclaration,this.#i=r.sandbox,this.#a=r.contexts,this.#d=r.userContexts}get channels(){return this.#n}get contexts(){return this.#a}get userContexts(){return this.#d}#o(){const r=`[${this.channels.map(d=>d.getEvalInWindowStr()).join(", ")}]`;return`(()=>{(${this.#s})(...${r})})()`}async initInTargets(r,d){await Promise.all(Array.from(r).map(o=>this.initInTarget(o,d)))}async initInTarget(r,d){const o=await r.cdpClient.sendCommand("Page.addScriptToEvaluateOnNewDocument",{source:this.#o(),worldName:this.#i,runImmediately:d});this.#t.push({target:r,preloadScriptId:o.identifier}),this.#r.add(r.id)}async remove(){await Promise.all([this.#t.map(async r=>{const d=r.target,o=r.preloadScriptId;return await d.cdpClient.sendCommand("Page.removeScriptToEvaluateOnNewDocument",{identifier:o})})])}dispose(r){this.#t=this.#t.filter(d=>d.target?.id!==r),this.#r.delete(r)}};return Ke.PreloadScript=a,Ke}var xr;function Cn(){if(xr)return He;xr=1,Object.defineProperty(He,"__esModule",{value:!0}),He.ScriptProcessor=void 0;const n=j(),t=xn();let a=class{#e;#t;#s;#r;#n;#i;constructor(r,d,o,e,s,i){this.#t=d,this.#s=o,this.#r=e,this.#n=s,this.#i=i,this.#e=r,this.#e.addSubscribeHook(n.ChromiumBidi.Script.EventNames.RealmCreated,this.#a.bind(this))}#a(r){const d=this.#t.getContext(r),o=[d,...this.#t.getContext(r).allChildren],e=new Set;for(const s of o){const i=this.#s.findRealms({browsingContextId:s.id});for(const c of i)e.add(c)}for(const s of e)this.#e.registerEvent({type:"event",method:n.ChromiumBidi.Script.EventNames.RealmCreated,params:s.realmInfo},d.id);return Promise.resolve()}async addPreloadScript(r){if(r.userContexts?.length&&r.contexts?.length)throw new n.InvalidArgumentException("Both userContexts and contexts cannot be specified.");const d=await this.#n.verifyUserContextIdList(r.userContexts??[]),o=this.#t.verifyTopLevelContextsList(r.contexts),e=new t.PreloadScript(r,this.#i);this.#r.add(e);let s=[];d.size?s=this.#t.getTopLevelContexts().filter(c=>d.has(c.userContext)):o.size?s=[...o.values()]:s=this.#t.getTopLevelContexts();const i=new Set(s.map(c=>c.cdpTarget));return await e.initInTargets(i,!1),{script:e.id}}async removePreloadScript(r){const{script:d}=r;return await this.#r.getPreloadScript(d).remove(),this.#r.remove(d),{}}async callFunction(r){return await(await this.#d(r.target)).callFunction(r.functionDeclaration,r.awaitPromise,r.this,r.arguments,r.resultOwnership,r.serializationOptions,r.userActivation)}async evaluate(r){return await(await this.#d(r.target)).evaluate(r.expression,r.awaitPromise,r.resultOwnership,r.serializationOptions,r.userActivation)}async disown(r){const d=await this.#d(r.target);return await Promise.all(r.handles.map(async o=>await d.disown(o))),{}}getRealms(r){return r.context!==void 0&&this.#t.getContext(r.context),{realms:this.#s.findRealms({browsingContextId:r.context,type:r.type,isHidden:!1}).map(d=>d.realmInfo)}}async#d(r){return"context"in r?await this.#t.getContext(r.context).getOrCreateUserSandbox(r.sandbox):this.#s.getRealm({realmId:r.realm,isHidden:!1})}};return He.ScriptProcessor=a,He}var Ve={},Cr;function En(){if(Cr)return Ve;Cr=1,Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.SessionProcessor=void 0;const n=j();let t=class{#e;#t;#s;#r=!1;constructor(a,r,d){this.#e=a,this.#t=r,this.#s=d}status(){return{ready:!1,message:"already connected"}}#n(a){const r=[];for(const o of a.firstMatch??[{}]){const e={...a.alwaysMatch};for(const s of Object.keys(o)){if(e[s]!==void 0)throw new n.InvalidArgumentException(`Capability ${s} in firstMatch is already defined in alwaysMatch`);e[s]=o[s]}r.push(e)}const d=r.find(o=>o.browserName==="chrome")??r[0]??{};return d.unhandledPromptBehavior=this.#i(d.unhandledPromptBehavior),d}#i(a){if(a!==void 0){if(typeof a=="object")return a;if(typeof a!="string")throw new n.InvalidArgumentException(`Unexpected 'unhandledPromptBehavior' type: ${typeof a}`);switch(a){case"accept":case"accept and notify":return{default:"accept",beforeUnload:"accept"};case"dismiss":case"dismiss and notify":return{default:"dismiss",beforeUnload:"accept"};case"ignore":return{default:"ignore",beforeUnload:"accept"};default:throw new n.InvalidArgumentException(`Unexpected 'unhandledPromptBehavior' value: ${a}`)}}}async new(a){if(this.#r)throw new Error("Session has been already created.");this.#r=!0;const r=this.#n(a.capabilities);await this.#s(r);const d=await this.#t.sendCommand("Browser.getVersion");return{sessionId:"unknown",capabilities:{...r,acceptInsecureCerts:r.acceptInsecureCerts??!1,browserName:d.product,browserVersion:d.revision,platformName:"",setWindowRect:!1,webSocketUrl:"",userAgent:d.userAgent}}}async subscribe(a,r=null){return{subscription:await this.#e.subscribe(a.events,a.contexts??[],a.userContexts??[],r)}}async unsubscribe(a,r=null){return"subscriptions"in a?(await this.#e.unsubscribeByIds(a.subscriptions),{}):(await this.#e.unsubscribe(a.events,a.contexts??[],r),{})}};return Ve.SessionProcessor=t,Ve}var Ge={},Er;function Sn(){if(Er)return Ge;Er=1,Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.StorageProcessor=void 0;const n=j(),t=ge(),a=G(),r=gr(),d=Ot();let o=class{#e;#t;#s;constructor(e,s,i){this.#t=s,this.#e=e,this.#s=i}async deleteCookies(e){const s=this.#d(e.partition);let i;try{i=await this.#e.sendCommand("Storage.getCookies",{browserContextId:this.#n(s)})}catch(l){throw this.#r(l)?new n.NoSuchUserContextException(l.message):l}const c=i.cookies.filter(l=>s.sourceOrigin===void 0||l.partitionKey?.topLevelSite===s.sourceOrigin).filter(l=>{const u=(0,d.cdpToBiDiCookie)(l);return this.#o(u,e.filter)}).map(l=>({...l,expires:1}));return await this.#e.sendCommand("Storage.setCookies",{cookies:c,browserContextId:this.#n(s)}),{partitionKey:s}}async getCookies(e){const s=this.#d(e.partition);let i;try{i=await this.#e.sendCommand("Storage.getCookies",{browserContextId:this.#n(s)})}catch(c){throw this.#r(c)?new n.NoSuchUserContextException(c.message):c}return{cookies:i.cookies.filter(c=>s.sourceOrigin===void 0||c.partitionKey?.topLevelSite===s.sourceOrigin).map(c=>(0,d.cdpToBiDiCookie)(c)).filter(c=>this.#o(c,e.filter)),partitionKey:s}}async setCookie(e){const s=this.#d(e.partition),i=(0,d.bidiToCdpCookie)(e,s);try{await this.#e.sendCommand("Storage.setCookies",{cookies:[i],browserContextId:this.#n(s)})}catch(c){throw this.#r(c)?new n.NoSuchUserContextException(c.message):(this.#s?.(a.LogType.debugError,c),new n.UnableToSetCookieException(c.toString()))}return{partitionKey:s}}#r(e){return e.message?.startsWith("Failed to find browser context for id")}#n(e){return e.userContext==="default"?void 0:e.userContext}#i(e){const s=e.context;return{userContext:this.#t.getContext(s).userContext}}#a(e){const s=new Map;let i=e.sourceOrigin;if(i!==void 0){const c=r.NetworkProcessor.parseUrlString(i);c.origin==="null"?i=c.origin:i=`${c.protocol}//${c.hostname}`}for(const[c,l]of Object.entries(e))c!==void 0&&l!==void 0&&!["type","sourceOrigin","userContext"].includes(c)&&s.set(c,l);return s.size>0&&this.#s?.(a.LogType.debugInfo,`Unsupported partition keys: ${JSON.stringify(Object.fromEntries(s))}`),{userContext:e.userContext??"default",...i===void 0?{}:{sourceOrigin:i}}}#d(e){return e===void 0?{userContext:"default"}:e.type==="context"?this.#i(e):((0,t.assert)(e.type==="storageKey","Unknown partition type"),this.#a(e))}#o(e,s){return s===void 0?!0:(s.domain===void 0||s.domain===e.domain)&&(s.name===void 0||s.name===e.name)&&(s.value===void 0||(0,d.deserializeByteValue)(s.value)===(0,d.deserializeByteValue)(e.value))&&(s.path===void 0||s.path===e.path)&&(s.size===void 0||s.size===e.size)&&(s.httpOnly===void 0||s.httpOnly===e.httpOnly)&&(s.secure===void 0||s.secure===e.secure)&&(s.sameSite===void 0||s.sameSite===e.sameSite)&&(s.expiry===void 0||s.expiry===e.expiry)}};return Ge.StorageProcessor=o,Ge}var Xe={},Sr;function Pn(){if(Sr)return Xe;Sr=1,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.WebExtensionProcessor=void 0;const n=j();let t=class{#e;constructor(a){this.#e=a}async install(a){switch(a.extensionData.type){case"archivePath":case"base64":throw new n.UnsupportedOperationException("Archived and Base64 extensions are not supported")}try{return{extension:(await this.#e.sendCommand("Extensions.loadUnpacked",{path:a.extensionData.path})).id}}catch(r){throw r.message.startsWith("invalid web extension")?new n.InvalidWebExtensionException(r.message):r}}async uninstall(a){try{return await this.#e.sendCommand("Extensions.uninstall",{id:a.extension}),{}}catch(r){throw r.message==="Uninstall failed. Reason: could not find extension."?new n.NoSuchWebExtensionException("no such web extension"):r}}};return Xe.WebExtensionProcessor=t,Xe}var Je={},Pr;function rs(){if(Pr)return Je;Pr=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.OutgoingMessage=void 0;let n=class Ts{#e;#t;constructor(a,r=null){this.#e=a,this.#t=r}static createFromPromise(a,r){return a.then(d=>d.kind==="success"?{kind:"success",value:new Ts(d.value,r)}:d)}static createResolved(a,r=null){return Promise.resolve({kind:"success",value:new Ts(a,r)})}get message(){return this.#e}get googChannel(){return this.#t}};return Je.OutgoingMessage=n,Je}var Ir;function In(){if(Ir)return Fe;Ir=1,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.CommandProcessor=void 0;const n=j(),t=Oe(),a=G(),r=nn(),d=on(),o=an(),e=cn(),s=dn(),i=wn(),c=gr(),l=yn(),u=Cn(),h=En(),f=Sn(),y=Pn(),g=rs();let w=class extends t.EventEmitter{#e;#t;#s;#r;#n;#i;#a;#d;#o;#u;#l;#h;#p;#c;#m;constructor(m,p,b,E,k,C,S,P,T,D,F=new r.BidiNoOpParser,B,x){super(),this.#t=p,this.#c=F,this.#m=x,this.#e=T,this.#s=new d.BrowserProcessor(p,E,P,D),this.#r=new e.BrowsingContextProcessor(p,E,D,P,b),this.#n=new o.CdpProcessor(E,k,m,p),this.#i=new s.EmulationProcessor(E,D,P),this.#a=new i.InputProcessor(E),this.#d=new c.NetworkProcessor(E,S,D,P),this.#o=new l.PermissionsProcessor(p),this.#u=new u.ScriptProcessor(b,E,k,C,D,x),this.#l=new h.SessionProcessor(b,p,B),this.#h=new f.StorageProcessor(p,E,x),this.#p=new y.WebExtensionProcessor(p)}async#f(m){switch(m.method){case"bluetooth.disableSimulation":return await this.#e.disableSimulation(this.#c.parseDisableSimulationParameters(m.params));case"bluetooth.handleRequestDevicePrompt":return await this.#e.handleRequestDevicePrompt(this.#c.parseHandleRequestDevicePromptParams(m.params));case"bluetooth.simulateAdapter":return await this.#e.simulateAdapter(this.#c.parseSimulateAdapterParameters(m.params));case"bluetooth.simulateAdvertisement":return await this.#e.simulateAdvertisement(this.#c.parseSimulateAdvertisementParameters(m.params));case"bluetooth.simulateCharacteristic":return await this.#e.simulateCharacteristic(this.#c.parseSimulateCharacteristicParameters(m.params));case"bluetooth.simulateCharacteristicResponse":return await this.#e.simulateCharacteristicResponse(this.#c.parseSimulateCharacteristicResponseParameters(m.params));case"bluetooth.simulateDescriptor":return await this.#e.simulateDescriptor(this.#c.parseSimulateDescriptorParameters(m.params));case"bluetooth.simulateDescriptorResponse":return await this.#e.simulateDescriptorResponse(this.#c.parseSimulateDescriptorResponseParameters(m.params));case"bluetooth.simulateGattConnectionResponse":return await this.#e.simulateGattConnectionResponse(this.#c.parseSimulateGattConnectionResponseParameters(m.params));case"bluetooth.simulateGattDisconnection":return await this.#e.simulateGattDisconnection(this.#c.parseSimulateGattDisconnectionParameters(m.params));case"bluetooth.simulatePreconnectedPeripheral":return await this.#e.simulatePreconnectedPeripheral(this.#c.parseSimulatePreconnectedPeripheralParameters(m.params));case"bluetooth.simulateService":return await this.#e.simulateService(this.#c.parseSimulateServiceParameters(m.params));case"browser.close":return this.#s.close();case"browser.createUserContext":return await this.#s.createUserContext(this.#c.parseCreateUserContextParameters(m.params));case"browser.getClientWindows":return await this.#s.getClientWindows();case"browser.getUserContexts":return await this.#s.getUserContexts();case"browser.removeUserContext":return await this.#s.removeUserContext(this.#c.parseRemoveUserContextParameters(m.params));case"browser.setClientWindowState":throw this.#c.parseSetClientWindowStateParameters(m.params),new n.UnknownErrorException(`Method ${m.method} is not implemented.`);case"browsingContext.activate":return await this.#r.activate(this.#c.parseActivateParams(m.params));case"browsingContext.captureScreenshot":return await this.#r.captureScreenshot(this.#c.parseCaptureScreenshotParams(m.params));case"browsingContext.close":return await this.#r.close(this.#c.parseCloseParams(m.params));case"browsingContext.create":return await this.#r.create(this.#c.parseCreateParams(m.params));case"browsingContext.getTree":return this.#r.getTree(this.#c.parseGetTreeParams(m.params));case"browsingContext.handleUserPrompt":return await this.#r.handleUserPrompt(this.#c.parseHandleUserPromptParams(m.params));case"browsingContext.locateNodes":return await this.#r.locateNodes(this.#c.parseLocateNodesParams(m.params));case"browsingContext.navigate":return await this.#r.navigate(this.#c.parseNavigateParams(m.params));case"browsingContext.print":return await this.#r.print(this.#c.parsePrintParams(m.params));case"browsingContext.reload":return await this.#r.reload(this.#c.parseReloadParams(m.params));case"browsingContext.setViewport":return await this.#r.setViewport(this.#c.parseSetViewportParams(m.params));case"browsingContext.traverseHistory":return await this.#r.traverseHistory(this.#c.parseTraverseHistoryParams(m.params));case"goog:cdp.getSession":return this.#n.getSession(this.#c.parseGetSessionParams(m.params));case"goog:cdp.resolveRealm":return this.#n.resolveRealm(this.#c.parseResolveRealmParams(m.params));case"goog:cdp.sendCommand":return await this.#n.sendCommand(this.#c.parseSendCommandParams(m.params));case"emulation.setForcedColorsModeThemeOverride":throw this.#c.parseSetForcedColorsModeThemeOverrideParams(m.params),new n.UnknownErrorException(`Method ${m.method} is not implemented.`);case"emulation.setGeolocationOverride":return await this.#i.setGeolocationOverride(this.#c.parseSetGeolocationOverrideParams(m.params));case"emulation.setLocaleOverride":return await this.#i.setLocaleOverride(this.#c.parseSetLocaleOverrideParams(m.params));case"emulation.setScreenOrientationOverride":return await this.#i.setScreenOrientationOverride(this.#c.parseSetScreenOrientationOverrideParams(m.params));case"emulation.setScriptingEnabled":return await this.#i.setScriptingEnabled(this.#c.parseSetScriptingEnabledParams(m.params));case"emulation.setTimezoneOverride":return await this.#i.setTimezoneOverride(this.#c.parseSetTimezoneOverrideParams(m.params));case"input.performActions":return await this.#a.performActions(this.#c.parsePerformActionsParams(m.params));case"input.releaseActions":return await this.#a.releaseActions(this.#c.parseReleaseActionsParams(m.params));case"input.setFiles":return await this.#a.setFiles(this.#c.parseSetFilesParams(m.params));case"network.addDataCollector":return await this.#d.addDataCollector(this.#c.parseAddDataCollectorParams(m.params));case"network.addIntercept":return await this.#d.addIntercept(this.#c.parseAddInterceptParams(m.params));case"network.continueRequest":return await this.#d.continueRequest(this.#c.parseContinueRequestParams(m.params));case"network.continueResponse":return await this.#d.continueResponse(this.#c.parseContinueResponseParams(m.params));case"network.continueWithAuth":return await this.#d.continueWithAuth(this.#c.parseContinueWithAuthParams(m.params));case"network.disownData":return this.#d.disownData(this.#c.parseDisownDataParams(m.params));case"network.failRequest":return await this.#d.failRequest(this.#c.parseFailRequestParams(m.params));case"network.getData":return await this.#d.getData(this.#c.parseGetDataParams(m.params));case"network.provideResponse":return await this.#d.provideResponse(this.#c.parseProvideResponseParams(m.params));case"network.removeDataCollector":return await this.#d.removeDataCollector(this.#c.parseRemoveDataCollectorParams(m.params));case"network.removeIntercept":return await this.#d.removeIntercept(this.#c.parseRemoveInterceptParams(m.params));case"network.setCacheBehavior":return await this.#d.setCacheBehavior(this.#c.parseSetCacheBehaviorParams(m.params));case"network.setExtraHeaders":return await this.#d.setExtraHeaders(this.#c.parseSetExtraHeadersParams(m.params));case"permissions.setPermission":return await this.#o.setPermissions(this.#c.parseSetPermissionsParams(m.params));case"script.addPreloadScript":return await this.#u.addPreloadScript(this.#c.parseAddPreloadScriptParams(m.params));case"script.callFunction":return await this.#u.callFunction(this.#c.parseCallFunctionParams(this.#g(m.params)));case"script.disown":return await this.#u.disown(this.#c.parseDisownParams(this.#g(m.params)));case"script.evaluate":return await this.#u.evaluate(this.#c.parseEvaluateParams(this.#g(m.params)));case"script.getRealms":return this.#u.getRealms(this.#c.parseGetRealmsParams(m.params));case"script.removePreloadScript":return await this.#u.removePreloadScript(this.#c.parseRemovePreloadScriptParams(m.params));case"session.end":throw new n.UnknownErrorException(`Method ${m.method} is not implemented.`);case"session.new":return await this.#l.new(m.params);case"session.status":return this.#l.status();case"session.subscribe":return await this.#l.subscribe(this.#c.parseSubscribeParams(m.params),m["goog:channel"]);case"session.unsubscribe":return await this.#l.unsubscribe(this.#c.parseUnsubscribeParams(m.params),m["goog:channel"]);case"storage.deleteCookies":return await this.#h.deleteCookies(this.#c.parseDeleteCookiesParams(m.params));case"storage.getCookies":return await this.#h.getCookies(this.#c.parseGetCookiesParams(m.params));case"storage.setCookie":return await this.#h.setCookie(this.#c.parseSetCookieParams(m.params));case"webExtension.install":return await this.#p.install(this.#c.parseInstallParams(m.params));case"webExtension.uninstall":return await this.#p.uninstall(this.#c.parseUninstallParams(m.params))}throw new n.UnknownCommandException(`Unknown command '${m?.method}'.`)}#g(m){return typeof m=="object"&&m&&"target"in m&&typeof m.target=="object"&&m.target&&"context"in m.target&&delete m.target.realm,m}async processCommand(m){try{const p=await this.#f(m),b={type:"success",id:m.id,result:p};this.emit("response",{message:g.OutgoingMessage.createResolved(b,m["goog:channel"]),event:m.method})}catch(p){if(p instanceof n.Exception)this.emit("response",{message:g.OutgoingMessage.createResolved(p.toErrorResponse(m.id),m["goog:channel"]),event:m.method});else{const b=p;this.#m?.(a.LogType.bidi,b);const E=this.#t.isCloseError(p)?new n.NoSuchFrameException("Browsing context is gone"):new n.UnknownErrorException(b.message,b.stack);this.emit("response",{message:g.OutgoingMessage.createResolved(E.toErrorResponse(m.id),m["goog:channel"]),event:m.method})}}}};return Fe.CommandProcessor=w,Fe}var Ye={},kr;function kn(){if(kr)return Ye;kr=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.BluetoothProcessor=void 0;const n=j();class t{id;uuid;constructor(i,c){this.id=i,this.uuid=c}}class a extends t{characteristic;constructor(i,c,l){super(i,c),this.characteristic=l}}class r extends t{descriptors=new Map;service;constructor(i,c,l){super(i,c),this.service=l}}class d extends t{characteristics=new Map;device;constructor(i,c,l){super(i,c),this.device=l}}class o{address;services=new Map;constructor(i){this.address=i}}let e=class{#e;#t;#s=new Map;#r=new Map;#n=new Map;constructor(s,i){this.#e=s,this.#t=i}#i(s){const i=this.#s.get(s);if(!i)throw new n.InvalidArgumentException(`Bluetooth device with address ${s} does not exist`);return i}#a(s,i){const c=s.services.get(i);if(!c)throw new n.InvalidArgumentException(`Service with UUID ${i} on device ${s.address} does not exist`);return c}#d(s,i){const c=s.characteristics.get(i);if(!c)throw new n.InvalidArgumentException(`Characteristic with UUID ${i} does not exist for service ${s.uuid} on device ${s.device.address}`);return c}#o(s,i){const c=s.descriptors.get(i);if(!c)throw new n.InvalidArgumentException(`Descriptor with UUID ${i} does not exist for characteristic ${s.uuid} on service ${s.service.uuid} on device ${s.service.device.address}`);return c}async simulateAdapter(s){if(s.state===void 0)throw new n.InvalidArgumentException('Parameter "state" is required for creating a Bluetooth adapter');const i=this.#t.getContext(s.context);return await i.cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.disable"),this.#s.clear(),this.#r.clear(),this.#n.clear(),await i.cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.enable",{state:s.state,leSupported:s.leSupported??!0}),{}}async disableSimulation(s){return await this.#t.getContext(s.context).cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.disable"),this.#s.clear(),this.#r.clear(),this.#n.clear(),{}}async simulatePreconnectedPeripheral(s){if(this.#s.has(s.address))throw new n.InvalidArgumentException(`Bluetooth device with address ${s.address} already exists`);return await this.#t.getContext(s.context).cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.simulatePreconnectedPeripheral",{address:s.address,name:s.name,knownServiceUuids:s.knownServiceUuids,manufacturerData:s.manufacturerData}),this.#s.set(s.address,new o(s.address)),{}}async simulateAdvertisement(s){return await this.#t.getContext(s.context).cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.simulateAdvertisement",{entry:s.scanEntry}),{}}async simulateCharacteristic(s){const i=this.#i(s.address),c=this.#a(i,s.serviceUuid),l=this.#t.getContext(s.context);switch(s.type){case"add":{if(s.characteristicProperties===void 0)throw new n.InvalidArgumentException('Parameter "characteristicProperties" is required for adding a Bluetooth characteristic');if(c.characteristics.has(s.characteristicUuid))throw new n.InvalidArgumentException(`Characteristic with UUID ${s.characteristicUuid} already exists`);const u=await l.cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.addCharacteristic",{serviceId:c.id,characteristicUuid:s.characteristicUuid,properties:s.characteristicProperties}),h=new r(u.characteristicId,s.characteristicUuid,c);return c.characteristics.set(s.characteristicUuid,h),this.#r.set(h.id,h),{}}case"remove":{if(s.characteristicProperties!==void 0)throw new n.InvalidArgumentException('Parameter "characteristicProperties" should not be provided for removing a Bluetooth characteristic');const u=this.#d(c,s.characteristicUuid);return await l.cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.removeCharacteristic",{characteristicId:u.id}),c.characteristics.delete(s.characteristicUuid),this.#r.delete(u.id),{}}default:throw new n.InvalidArgumentException(`Parameter "type" of ${s.type} is not supported`)}}async simulateCharacteristicResponse(s){const i=this.#t.getContext(s.context),c=this.#i(s.address),l=this.#a(c,s.serviceUuid),u=this.#d(l,s.characteristicUuid);return await i.cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.simulateCharacteristicOperationResponse",{characteristicId:u.id,type:s.type,code:s.code,...s.data&&{data:btoa(String.fromCharCode(...s.data))}}),{}}async simulateDescriptor(s){const i=this.#i(s.address),c=this.#a(i,s.serviceUuid),l=this.#d(c,s.characteristicUuid),u=this.#t.getContext(s.context);switch(s.type){case"add":{if(l.descriptors.has(s.descriptorUuid))throw new n.InvalidArgumentException(`Descriptor with UUID ${s.descriptorUuid} already exists`);const h=await u.cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.addDescriptor",{characteristicId:l.id,descriptorUuid:s.descriptorUuid}),f=new a(h.descriptorId,s.descriptorUuid,l);return l.descriptors.set(s.descriptorUuid,f),this.#n.set(f.id,f),{}}case"remove":{const h=this.#o(l,s.descriptorUuid);return await u.cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.removeDescriptor",{descriptorId:h.id}),l.descriptors.delete(s.descriptorUuid),this.#n.delete(h.id),{}}default:throw new n.InvalidArgumentException(`Parameter "type" of ${s.type} is not supported`)}}async simulateDescriptorResponse(s){const i=this.#t.getContext(s.context),c=this.#i(s.address),l=this.#a(c,s.serviceUuid),u=this.#d(l,s.characteristicUuid),h=this.#o(u,s.descriptorUuid);return await i.cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.simulateDescriptorOperationResponse",{descriptorId:h.id,type:s.type,code:s.code,...s.data&&{data:btoa(String.fromCharCode(...s.data))}}),{}}async simulateGattConnectionResponse(s){return await this.#t.getContext(s.context).cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.simulateGATTOperationResponse",{address:s.address,type:"connection",code:s.code}),{}}async simulateGattDisconnection(s){return await this.#t.getContext(s.context).cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.simulateGATTDisconnection",{address:s.address}),{}}async simulateService(s){const i=this.#i(s.address),c=this.#t.getContext(s.context);switch(s.type){case"add":{if(i.services.has(s.uuid))throw new n.InvalidArgumentException(`Service with UUID ${s.uuid} already exists`);const l=await c.cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.addService",{address:s.address,serviceUuid:s.uuid});return i.services.set(s.uuid,new d(l.serviceId,s.uuid,i)),{}}case"remove":{const l=this.#a(i,s.uuid);return await c.cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.removeService",{serviceId:l.id}),i.services.delete(s.uuid),{}}default:throw new n.InvalidArgumentException(`Parameter "type" of ${s.type} is not supported`)}}onCdpTargetCreated(s){s.cdpClient.on("DeviceAccess.deviceRequestPrompted",i=>{this.#e.registerEvent({type:"event",method:"bluetooth.requestDevicePromptUpdated",params:{context:s.id,prompt:i.id,devices:i.devices}},s.id)}),s.browserCdpClient.on("BluetoothEmulation.gattOperationReceived",async i=>{switch(i.type){case"connection":this.#e.registerEvent({type:"event",method:"bluetooth.gattConnectionAttempted",params:{context:s.id,address:i.address}},s.id);return;case"discovery":await s.browserCdpClient.sendCommand("BluetoothEmulation.simulateGATTOperationResponse",{address:i.address,type:"discovery",code:0})}}),s.browserCdpClient.on("BluetoothEmulation.characteristicOperationReceived",i=>{if(!this.#r.has(i.characteristicId))return;let c;if(i.type==="write"){if(i.writeType==="write-default-deprecated")return;c=i.writeType}else c=i.type;const l=this.#r.get(i.characteristicId);this.#e.registerEvent({type:"event",method:"bluetooth.characteristicEventGenerated",params:{context:s.id,address:l.service.device.address,serviceUuid:l.service.uuid,characteristicUuid:l.uuid,type:c,...i.data&&{data:Array.from(atob(i.data),u=>u.charCodeAt(0))}}},s.id)}),s.browserCdpClient.on("BluetoothEmulation.descriptorOperationReceived",i=>{if(!this.#n.has(i.descriptorId))return;const c=this.#n.get(i.descriptorId);this.#e.registerEvent({type:"event",method:"bluetooth.descriptorEventGenerated",params:{context:s.id,address:c.characteristic.service.device.address,serviceUuid:c.characteristic.service.uuid,characteristicUuid:c.characteristic.uuid,descriptorUuid:c.uuid,type:i.type,...i.data&&{data:Array.from(atob(i.data),l=>l.charCodeAt(0))}}},s.id)})}async handleRequestDevicePrompt(s){const i=this.#t.getContext(s.context);return s.accept?await i.cdpTarget.cdpClient.sendCommand("DeviceAccess.selectPrompt",{id:s.prompt,deviceId:s.device}):await i.cdpTarget.cdpClient.sendCommand("DeviceAccess.cancelPrompt",{id:s.prompt}),{}}};return Ye.BluetoothProcessor=e,Ye}var Qe={},Ze={},Tr;function Tn(){if(Tr)return Ze;Tr=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.ContextConfig=void 0;let n=class Li{acceptInsecureCerts;viewport;devicePixelRatio;extraHeaders;geolocation;locale;prerenderingDisabled;screenOrientation;scriptingEnabled;timezone;userPromptHandler;static merge(...a){const r=new Li;for(const d of a)if(d)for(const o in d){const e=d[o];e!==void 0&&(r[o]=e)}return r}};return Ze.ContextConfig=n,Ze}var Nr;function Nn(){if(Nr)return Qe;Nr=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.ContextConfigStorage=void 0;const n=Tn();let t=class{#e=new n.ContextConfig;#t=new Map;#s=new Map;updateGlobalConfig(a){this.#e=n.ContextConfig.merge(this.#e,a)}updateBrowsingContextConfig(a,r){this.#s.set(a,n.ContextConfig.merge(this.#s.get(a),r))}updateUserContextConfig(a,r){this.#t.set(a,n.ContextConfig.merge(this.#t.get(a),r))}getGlobalConfig(){return this.#e}getActiveConfig(a,r){return n.ContextConfig.merge(this.#e,this.#t.get(r),this.#s.get(a))}};return Qe.ContextConfigStorage=t,Qe}var et={},Or;function On(){if(Or)return et;Or=1,Object.defineProperty(et,"__esModule",{value:!0}),et.UserContextStorage=void 0;const n=j();let t=class{#e;constructor(a){this.#e=a}async getUserContexts(){const a=await this.#e.sendCommand("Target.getBrowserContexts");return[{userContext:"default"},...a.browserContextIds.map(r=>({userContext:r}))]}async verifyUserContextIdList(a){const r=new Set;if(!a.length)return r;const d=await this.getUserContexts(),o=new Set(d.map(e=>e.userContext));for(const e of a){if(!o.has(e))throw new n.NoSuchUserContextException(`User context ${e} not found`);r.add(e)}return r}};return et.UserContextStorage=t,et}var tt={},Pe={},st={},Dr;function Rt(){if(Dr)return st;Dr=1,Object.defineProperty(st,"__esModule",{value:!0}),st.Deferred=void 0;let n=class{#e=!1;#t;#s;#r;#n;get isFinished(){return this.#e}get result(){if(!this.#e)throw new Error("Deferred is not finished yet");return this.#s}constructor(){this.#t=new Promise((t,a)=>{this.#r=t,this.#n=a}),this.#t.catch(t=>{})}then(t,a){return this.#t.then(t,a)}catch(t){return this.#t.catch(t)}resolve(t){this.#s=t,this.#e||(this.#e=!0,this.#r(t))}reject(t){this.#e||(this.#e=!0,this.#n(t))}finally(t){return this.#t.finally(t)}[Symbol.toStringTag]="Promise"};return st.Deferred=n,st}var Ft={},Rr;function Fr(){if(Rr)return Ft;Rr=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.getTimestamp=n;function n(){return new Date().getTime()}return Ft}var At={},Ar;function Dn(){if(Ar)return At;Ar=1,Object.defineProperty(At,"__esModule",{value:!0}),At.inchesFromCm=n;function n(t){return t/2.54}return At}var rt={},Mr;function Br(){if(Mr)return rt;Mr=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.getSharedId=t,rt.parseSharedId=r;const n="_element_";function t(d,o,e){return`f.${d}.d.${o}.e.${e}`}function a(d){const o=d.match(new RegExp(`(.*)${n}(.*)`));if(!o)return null;const e=o[1],s=o[2];if(e===void 0||s===void 0)return null;const i=parseInt(s??"");return isNaN(i)?null:{documentId:e,backendNodeId:i}}function r(d){const o=a(d);if(o!==null)return{...o,frameId:void 0};const e=d.match(/f\.(.*)\.d\.(.*)\.e\.([0-9]*)/);if(!e)return null;const s=e[1],i=e[2],c=e[3];if(s===void 0||i===void 0||c===void 0)return null;const l=parseInt(c??"");return isNaN(l)?null:{frameId:s,documentId:i,backendNodeId:l}}return rt}var it={},nt={},jr;function Ur(){if(jr)return nt;jr=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.Realm=void 0;const n=j(),t=G(),a=fe(),r=yr();class d{#e;#t;#s;#r;#n;#i;realmStorage;constructor(e,s,i,c,l,u,h){this.#e=e,this.#t=s,this.#s=i,this.#r=c,this.#n=l,this.#i=u,this.realmStorage=h,this.realmStorage.addRealm(this)}cdpToBidiValue(e,s){const i=this.serializeForBiDi(e.result.deepSerializedValue,new Map);if(e.result.objectId){const c=e.result.objectId;s==="root"?(i.handle=c,this.realmStorage.knownHandlesToRealmMap.set(c,this.realmId)):this.#f(c).catch(l=>this.#r?.(t.LogType.debugError,l))}return i}isHidden(){return!1}serializeForBiDi(e,s){if(Object.hasOwn(e,"weakLocalObjectReference")){const c=e.weakLocalObjectReference;s.has(c)||s.set(c,(0,a.uuidv4)()),e.internalId=s.get(c),delete e.weakLocalObjectReference}if(e.type==="node"&&e.value&&Object.hasOwn(e.value,"frameId")&&delete e.value.frameId,e.type==="platformobject")return{type:"object"};const i=e.value;if(i===void 0)return e;if(["array","set","htmlcollection","nodelist"].includes(e.type))for(const c in i)i[c]=this.serializeForBiDi(i[c],s);if(["object","map"].includes(e.type))for(const c in i)i[c]=[this.serializeForBiDi(i[c][0],s),this.serializeForBiDi(i[c][1],s)];return e}get realmId(){return this.#i}get executionContextId(){return this.#s}get origin(){return this.#n}get source(){return{realm:this.realmId}}get cdpClient(){return this.#e}get baseInfo(){return{realm:this.realmId,origin:this.origin}}async evaluate(e,s,i="none",c={},l=!1,u=!1){const h=await this.cdpClient.sendCommand("Runtime.evaluate",{contextId:this.executionContextId,expression:e,awaitPromise:s,serializationOptions:d.#p("deep",c),userGesture:l,includeCommandLineAPI:u});return h.exceptionDetails?await this.#h(h.exceptionDetails,0,i):{realm:this.realmId,result:this.cdpToBidiValue(h,i),type:"success"}}#a(e){if(this.associatedBrowsingContexts.length===0)this.#t.registerGlobalEvent(e);else for(const s of this.associatedBrowsingContexts)this.#t.registerEvent(e,s.id)}initialize(){this.isHidden()||this.#a({type:"event",method:n.ChromiumBidi.Script.EventNames.RealmCreated,params:this.realmInfo})}async serializeCdpObject(e,s){const i=d.#d(e),c=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(l=>l),awaitPromise:!1,arguments:[i],serializationOptions:{serialization:"deep"},executionContextId:this.executionContextId});return this.cdpToBidiValue(c,s)}static#d(e){return e.objectId!==void 0?{objectId:e.objectId}:e.unserializableValue!==void 0?{unserializableValue:e.unserializableValue}:{value:e.value}}async stringifyObject(e){const{result:s}=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(i=>String(i)),awaitPromise:!1,arguments:[e],returnByValue:!0,executionContextId:this.executionContextId});return s.value}async#o(e){return(await Promise.all(e.map(async([s,i])=>{let c;typeof s=="string"?c={value:s}:c=await this.deserializeForCdp(s);const l=await this.deserializeForCdp(i);return[c,l]}))).flat()}async#u(e){return await Promise.all(e.map(s=>this.deserializeForCdp(s)))}async#l(e,s,i){const c=e.stackTrace?.callFrames.map(u=>({url:u.url,functionName:u.functionName,lineNumber:u.lineNumber-s,columnNumber:u.columnNumber}))??[],l=e.exception;return{exception:await this.serializeCdpObject(l,i),columnNumber:e.columnNumber,lineNumber:e.lineNumber-s,stackTrace:{callFrames:c},text:await this.stringifyObject(l)||e.text}}async callFunction(e,s,i={type:"undefined"},c=[],l="none",u={},h=!1){const f=`(...args) => {
      function callFunction(f, args) {
        const deserializedThis = args.shift();
        const deserializedArgs = args;
        return f.apply(deserializedThis, deserializedArgs);
      }
      return callFunction((
        ${e}
      ), args);
    }`,y=[await this.deserializeForCdp(i),...await Promise.all(c.map(async w=>await this.deserializeForCdp(w)))];let g;try{g=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:f,awaitPromise:s,arguments:y,serializationOptions:d.#p("deep",u),executionContextId:this.executionContextId,userGesture:h})}catch(w){throw w.code===-32e3&&["Could not find object with given id","Argument should belong to the same JavaScript world as target object","Invalid remote object id"].includes(w.message)?new n.NoSuchHandleException("Handle was not found."):w}return g.exceptionDetails?await this.#h(g.exceptionDetails,1,l):{type:"success",result:this.cdpToBidiValue(g,l),realm:this.realmId}}async deserializeForCdp(e){if("handle"in e&&e.handle)return{objectId:e.handle};if("handle"in e||"sharedId"in e)throw new n.NoSuchHandleException("Handle was not found.");switch(e.type){case"undefined":return{unserializableValue:"undefined"};case"null":return{unserializableValue:"null"};case"string":return{value:e.value};case"number":return e.value==="NaN"?{unserializableValue:"NaN"}:e.value==="-0"?{unserializableValue:"-0"}:e.value==="Infinity"?{unserializableValue:"Infinity"}:e.value==="-Infinity"?{unserializableValue:"-Infinity"}:{value:e.value};case"boolean":return{value:!!e.value};case"bigint":return{unserializableValue:`BigInt(${JSON.stringify(e.value)})`};case"date":return{unserializableValue:`new Date(Date.parse(${JSON.stringify(e.value)}))`};case"regexp":return{unserializableValue:`new RegExp(${JSON.stringify(e.value.pattern)}, ${JSON.stringify(e.value.flags)})`};case"map":{const s=await this.#o(e.value),{result:i}=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String((...c)=>{const l=new Map;for(let u=0;u<c.length;u+=2)l.set(c[u],c[u+1]);return l}),awaitPromise:!1,arguments:s,returnByValue:!1,executionContextId:this.executionContextId});return{objectId:i.objectId}}case"object":{const s=await this.#o(e.value),{result:i}=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String((...c)=>{const l={};for(let u=0;u<c.length;u+=2){const h=c[u];l[h]=c[u+1]}return l}),awaitPromise:!1,arguments:s,returnByValue:!1,executionContextId:this.executionContextId});return{objectId:i.objectId}}case"array":{const s=await this.#u(e.value),{result:i}=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String((...c)=>c),awaitPromise:!1,arguments:s,returnByValue:!1,executionContextId:this.executionContextId});return{objectId:i.objectId}}case"set":{const s=await this.#u(e.value),{result:i}=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String((...c)=>new Set(c)),awaitPromise:!1,arguments:s,returnByValue:!1,executionContextId:this.executionContextId});return{objectId:i.objectId}}case"channel":return{objectId:await new r.ChannelProxy(e.value,this.#r).init(this,this.#t)}}throw new Error(`Value ${JSON.stringify(e)} is not deserializable.`)}async#h(e,s,i){return{exceptionDetails:await this.#l(e,s,i),realm:this.realmId,type:"exception"}}static#p(e,s){return{serialization:e,additionalParameters:d.#c(s),...d.#m(s)}}static#c(e){const s={};return e.maxDomDepth!==void 0&&(s.maxNodeDepth=e.maxDomDepth===null?1e3:e.maxDomDepth),e.includeShadowTree!==void 0&&(s.includeShadowTree=e.includeShadowTree),s}static#m(e){return e.maxObjectDepth===void 0||e.maxObjectDepth===null?{}:{maxDepth:e.maxObjectDepth}}async#f(e){try{await this.cdpClient.sendCommand("Runtime.releaseObject",{objectId:e})}catch(s){if(!(s.code===-32e3&&s.message==="Invalid remote object id"))throw s}}async disown(e){this.realmStorage.knownHandlesToRealmMap.get(e)===this.realmId&&(await this.#f(e),this.realmStorage.knownHandlesToRealmMap.delete(e))}dispose(){this.#a({type:"event",method:n.ChromiumBidi.Script.EventNames.RealmDestroyed,params:{realm:this.realmId}})}}return nt.Realm=d,nt}var Lr;function qr(){if(Lr)return it;Lr=1,Object.defineProperty(it,"__esModule",{value:!0}),it.WindowRealm=void 0;const n=j(),t=Ur(),a=Br();class r extends t.Realm{#e;#t;sandbox;constructor(o,e,s,i,c,l,u,h,f,y){super(s,i,c,l,u,h,f),this.#e=o,this.#t=e,this.sandbox=y,this.initialize()}#s(o){return this.#t.getAllContexts().find(e=>e.navigableId===o)?.id??"UNKNOWN"}get browsingContext(){return this.#t.getContext(this.#e)}isHidden(){return this.realmStorage.hiddenSandboxes.has(this.sandbox)}get associatedBrowsingContexts(){return[this.browsingContext]}get realmType(){return"window"}get realmInfo(){return{...this.baseInfo,type:this.realmType,context:this.#e,sandbox:this.sandbox}}get source(){return{realm:this.realmId,context:this.browsingContext.id}}serializeForBiDi(o,e){const s=o.value;if(o.type==="node"&&s!==void 0){if(Object.hasOwn(s,"backendNodeId")){let i=this.browsingContext.navigableId??"UNKNOWN";Object.hasOwn(s,"loaderId")&&(i=s.loaderId,delete s.loaderId),o.sharedId=(0,a.getSharedId)(this.#s(i),i,s.backendNodeId),delete s.backendNodeId}if(Object.hasOwn(s,"children"))for(const i in s.children)s.children[i]=this.serializeForBiDi(s.children[i],e);Object.hasOwn(s,"shadowRoot")&&s.shadowRoot!==null&&(s.shadowRoot=this.serializeForBiDi(s.shadowRoot,e)),s.namespaceURI===""&&(s.namespaceURI=null)}return super.serializeForBiDi(o,e)}async deserializeForCdp(o){if("sharedId"in o&&o.sharedId){const e=(0,a.parseSharedId)(o.sharedId);if(e===null)throw new n.NoSuchNodeException(`SharedId "${o.sharedId}" was not found.`);const{documentId:s,backendNodeId:i}=e;if(this.browsingContext.navigableId!==s)throw new n.NoSuchNodeException(`SharedId "${o.sharedId}" belongs to different document. Current document is ${this.browsingContext.navigableId}.`);try{const{object:c}=await this.cdpClient.sendCommand("DOM.resolveNode",{backendNodeId:i,executionContextId:this.executionContextId});return{objectId:c.objectId}}catch(c){throw c.code===-32e3&&c.message==="No node with given id found"?new n.NoSuchNodeException(`SharedId "${o.sharedId}" was not found.`):new n.UnknownErrorException(c.message,c.stack)}}return await super.deserializeForCdp(o)}async evaluate(o,e,s,i,c,l){return await this.#t.getContext(this.#e).targetUnblockedOrThrow(),await super.evaluate(o,e,s,i,c,l)}async callFunction(o,e,s,i,c,l,u){return await this.#t.getContext(this.#e).targetUnblockedOrThrow(),await super.callFunction(o,e,s,i,c,l,u)}}return it.WindowRealm=r,it}var re={},Mt={},$r;function Rn(){if($r)return Mt;$r=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.urlMatchesAboutBlank=n;function n(t){if(t==="")return!0;try{const a=new URL(t);return a.protocol.replace(/:$/,"").toLowerCase()==="about"&&a.pathname.toLowerCase()==="blank"&&a.username===""&&a.password===""&&a.host===""}catch(a){if(a instanceof TypeError)return!1;throw a}}return Mt}var zr;function Fn(){if(zr)return re;zr=1,Object.defineProperty(re,"__esModule",{value:!0}),re.NavigationTracker=re.NavigationState=re.NavigationResult=void 0;const n=j(),t=Rt(),a=G(),r=Fr(),d=Rn(),o=fe();class e{eventName;message;constructor(l,u){this.eventName=l,this.message=u}}re.NavigationResult=e;class s{navigationId=(0,o.uuidv4)();#e;#t=!1;#s=new t.Deferred;url;loaderId;#r;#n;committed=new t.Deferred;isFragmentNavigation;get finished(){return this.#s}constructor(l,u,h,f){this.#e=u,this.url=l,this.#r=h,this.#n=f}navigationInfo(){return{context:this.#e,navigation:this.navigationId,timestamp:(0,r.getTimestamp)(),url:this.url}}start(){!this.#r&&!this.#t&&!this.isFragmentNavigation&&this.#n.registerEvent({type:"event",method:n.ChromiumBidi.BrowsingContext.EventNames.NavigationStarted,params:this.navigationInfo()},this.#e),this.#t=!0}#i(l){this.#t=!0,!this.#r&&!this.#s.isFinished&&l.eventName!=="browsingContext.load"&&this.#n.registerEvent({type:"event",method:l.eventName,params:this.navigationInfo()},this.#e),this.#s.resolve(l)}frameNavigated(){this.committed.resolve(),this.#r||this.#n.registerEvent({type:"event",method:n.ChromiumBidi.BrowsingContext.EventNames.NavigationCommitted,params:this.navigationInfo()},this.#e)}fragmentNavigated(){this.committed.resolve(),this.#i(new e("browsingContext.fragmentNavigated"))}load(){this.#i(new e("browsingContext.load"))}fail(l){this.#i(new e(this.committed.isFinished?"browsingContext.navigationAborted":"browsingContext.navigationFailed",l))}}re.NavigationState=s;let i=class Ns{#e;#t;#s=new Map;#r;#n;#i;#a=!0;constructor(l,u,h,f){this.#r=u,this.#e=h,this.#t=f,this.#a=!0,this.#n=new s(l,u,(0,d.urlMatchesAboutBlank)(l),this.#e)}get currentNavigationId(){return this.#i?.isFragmentNavigation===!1?this.#i.navigationId:this.#n.navigationId}get isInitialNavigation(){return this.#a}get url(){return this.#n.url}createPendingNavigation(l,u=!1){this.#t?.(a.LogType.debug,"createCommandNavigation"),this.#a=u&&this.#a&&(0,d.urlMatchesAboutBlank)(l),this.#i?.fail("navigation canceled by concurrent navigation");const h=new s(l,this.#r,this.#a,this.#e);return this.#i=h,h}dispose(){this.#i?.fail("navigation canceled by context disposal"),this.#n.fail("navigation canceled by context disposal")}onTargetInfoChanged(l){this.#t?.(a.LogType.debug,`onTargetInfoChanged ${l}`),this.#n.url=l}#d(l,u){return this.#s.has(u)?this.#s.get(u):this.#i!==void 0&&this.#i.loaderId===void 0?this.#i:this.createPendingNavigation(l,!0)}frameNavigated(l,u,h){if(this.#t?.(a.LogType.debug,`frameNavigated ${l}`),h!==void 0){const y=this.#s.get(u)??this.#i??this.createPendingNavigation(h,!0);y.url=h,y.start(),y.fail("the requested url is unreachable");return}const f=this.#d(l,u);f!==this.#n&&this.#n.fail("navigation canceled by concurrent navigation"),f.url=l,f.loaderId=u,this.#s.set(u,f),f.start(),f.frameNavigated(),this.#n=f,this.#i===f&&(this.#i=void 0)}navigatedWithinDocument(l,u){if(this.#t?.(a.LogType.debug,`navigatedWithinDocument ${l}, ${u}`),this.#n.url=l,u!=="fragment")return;const h=this.#i?.isFragmentNavigation===!0?this.#i:new s(l,this.#r,!1,this.#e);h.fragmentNavigated(),h===this.#i&&(this.#i=void 0)}loadPageEvent(l){this.#t?.(a.LogType.debug,"loadPageEvent"),this.#a=!1,this.#s.get(l)?.load()}failNavigation(l,u){this.#t?.(a.LogType.debug,"failCommandNavigation"),l.fail(u)}navigationCommandFinished(l,u){this.#t?.(a.LogType.debug,`finishCommandNavigation ${l.navigationId}, ${u}`),u!==void 0&&(l.loaderId=u,this.#s.set(u,l)),l.isFragmentNavigation=u===void 0}frameStartedNavigating(l,u,h){if(this.#t?.(a.LogType.debug,`frameStartedNavigating ${l}, ${u}`),this.#i&&this.#i?.loaderId!==void 0&&this.#i?.loaderId!==u&&(this.#i?.fail("navigation canceled by concurrent navigation"),this.#i=void 0),this.#s.has(u)){const y=this.#s.get(u);y.isFragmentNavigation=Ns.#o(h),this.#i=y;return}const f=this.#i??this.createPendingNavigation(l,!0);this.#s.set(u,f),f.isFragmentNavigation=Ns.#o(h),f.url=l,f.loaderId=u,f.start()}static#o(l){return["historySameDocument","sameDocument"].includes(l)}networkLoadingFailed(l,u){this.#s.get(l)?.fail(u)}};return re.NavigationTracker=i,re}var _r;function Hr(){if(_r)return Pe;_r=1;var n;Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.BrowsingContextImpl=void 0,Pe.serializeOrigin=h;const t=j(),a=ge(),r=Rt(),d=G(),o=Fr(),e=Dn(),s=fe(),i=Br(),c=qr(),l=Fn();let u=class{static LOGGER_PREFIX=`${d.LogType.debug}:browsingContext`;#e=new Set;#t;userContext;#s=(0,s.uuidv4)();#r=new Map;#n;#i=null;#a;#d={DOMContentLoaded:new r.Deferred,load:new r.Deferred};#o;#u=new r.Deferred;#l;#h;#p;#c;#m;#f;#g;constructor(p,b,E,k,C,S,P,T,D,F,B){this.#o=k,this.#t=p,this.#i=b,this.userContext=E,this.#h=C,this.#l=S,this.#m=P,this.#f=T,this.#p=B,this.#a=F,this.#m.hiddenSandboxes.add(this.#s),this.#c=new l.NavigationTracker(D,p,C,B)}static create(p,b,E,k,C,S,P,T,D,F,B){const x=new n(p,b,E,k,C,S,P,T,D,F,B);return x.#w(),S.addContext(x),x.isTopLevelContext()||x.parent.addChild(x.id),C.registerPromiseEvent(x.targetUnblockedOrThrow().then(()=>({kind:"success",value:{type:"event",method:t.ChromiumBidi.BrowsingContext.EventNames.ContextCreated,params:{...x.serializeToBidiValue(),url:D}}}),v=>({kind:"error",error:v})),x.id,t.ChromiumBidi.BrowsingContext.EventNames.ContextCreated),x}get navigableId(){return this.#n}get navigationId(){return this.#c.currentNavigationId}dispose(p){this.#c.dispose(),this.#m.deleteRealms({browsingContextId:this.id}),this.isTopLevelContext()||this.parent.#e.delete(this.id),this.#T(),p&&this.#h.registerEvent({type:"event",method:t.ChromiumBidi.BrowsingContext.EventNames.ContextDestroyed,params:this.serializeToBidiValue(null)},this.id),this.#x(),this.#h.clearBufferedEvents(this.id),this.#l.deleteContextById(this.id)}get id(){return this.#t}get parentId(){return this.#i}set parentId(p){if(this.#i!==null){this.#p?.(d.LogType.debugError,"Parent context already set");return}this.#i=p,this.isTopLevelContext()||this.parent.addChild(this.id)}get parent(){return this.parentId===null?null:this.#l.getContext(this.parentId)}get directChildren(){return[...this.#e].map(p=>this.#l.getContext(p))}get allChildren(){const p=this.directChildren;return p.concat(...p.map(b=>b.allChildren))}isTopLevelContext(){return this.#i===null}get top(){let p=this,b=p.parent;for(;b;)p=b,b=p.parent;return p}addChild(p){this.#e.add(p)}#x(p=!1){this.directChildren.map(b=>b.dispose(p))}get cdpTarget(){return this.#o}updateCdpTarget(p){this.#o=p,this.#w()}get url(){return this.#c.url}async lifecycleLoaded(){await this.#d.load}async targetUnblockedOrThrow(){const p=await this.#o.unblocked;if(p.kind==="error")throw p.error}async getOrCreateHiddenSandbox(){return await this.#b(this.#s)}async getOrCreateUserSandbox(p){const b=await this.#b(p);if(b.isHidden())throw new t.NoSuchFrameException(`Realm "${p}" not found`);return b}async#b(p){if(p===void 0||p==="")return await this.#u;let b=this.#m.findRealms({browsingContextId:this.id,sandbox:p});return b.length===0&&(await this.#o.cdpClient.sendCommand("Page.createIsolatedWorld",{frameId:this.id,worldName:p}),b=this.#m.findRealms({browsingContextId:this.id,sandbox:p}),(0,a.assert)(b.length!==0)),b[0]}serializeToBidiValue(p=0,b=!0){return{context:this.#t,url:this.url,userContext:this.userContext,originalOpener:this.#a??null,clientWindow:`${this.cdpTarget.windowId}`,children:p===null||p>0?this.directChildren.map(E=>E.serializeToBidiValue(p===null?p:p-1,!1)):null,...b?{parent:this.#i}:{}}}onTargetInfoChanged(p){this.#c.onTargetInfoChanged(p.targetInfo.url)}#w(){this.#o.cdpClient.on("Network.loadingFailed",p=>{this.#c.networkLoadingFailed(p.requestId,p.errorText)}),this.#o.cdpClient.on("Page.fileChooserOpened",p=>{if(this.id!==p.frameId)return;if(this.#n===void 0){this.#p?.(d.LogType.debugError,"LoaderId should be defined when file upload is shown",p);return}const b=p.backendNodeId===void 0?void 0:{sharedId:(0,i.getSharedId)(this.id,this.#n,p.backendNodeId)};this.#h.registerEvent({type:"event",method:t.ChromiumBidi.Input.EventNames.FileDialogOpened,params:{context:this.id,multiple:p.mode==="selectMultiple",element:b}},this.id)}),this.#o.cdpClient.on("Page.frameNavigated",p=>{this.id===p.frame.id&&(this.#c.frameNavigated(p.frame.url+(p.frame.urlFragment??""),p.frame.loaderId,p.frame.unreachableUrl),this.#x(),this.#C(p.frame.loaderId))}),this.#o.cdpClient.on("Page.frameStartedNavigating",p=>{this.id===p.frameId&&this.#c.frameStartedNavigating(p.url,p.loaderId,p.navigationType)}),this.#o.cdpClient.on("Page.navigatedWithinDocument",p=>{if(this.id===p.frameId&&(this.#c.navigatedWithinDocument(p.url,p.navigationType),p.navigationType==="historyApi")){this.#h.registerEvent({type:"event",method:"browsingContext.historyUpdated",params:{context:this.id,timestamp:(0,o.getTimestamp)(),url:this.#c.url}},this.id);return}}),this.#o.cdpClient.on("Page.lifecycleEvent",p=>{if(this.id===p.frameId){if(p.name==="init"){this.#C(p.loaderId);return}if(p.name==="commit"){this.#n=p.loaderId;return}if(this.#n||(this.#n=p.loaderId),p.loaderId===this.#n)switch(p.name){case"DOMContentLoaded":this.#c.isInitialNavigation||this.#h.registerEvent({type:"event",method:t.ChromiumBidi.BrowsingContext.EventNames.DomContentLoaded,params:{context:this.id,navigation:this.#c.currentNavigationId,timestamp:(0,o.getTimestamp)(),url:this.#c.url}},this.id),this.#d.DOMContentLoaded.resolve();break;case"load":this.#c.isInitialNavigation||this.#h.registerEvent({type:"event",method:t.ChromiumBidi.BrowsingContext.EventNames.Load,params:{context:this.id,navigation:this.#c.currentNavigationId,timestamp:(0,o.getTimestamp)(),url:this.#c.url}},this.id),this.#c.loadPageEvent(p.loaderId),this.#d.load.resolve();break}}}),this.#o.cdpClient.on("Runtime.executionContextCreated",p=>{const{auxData:b,name:E,uniqueId:k,id:C}=p.context;if(!b||b.frameId!==this.id)return;let S,P;switch(b.type){case"isolated":P=E,this.#u.isFinished||this.#p?.(d.LogType.debugError,"Unexpectedly, isolated realm created before the default one"),S=this.#u.isFinished?this.#u.result.origin:"";break;case"default":S=h(p.context.origin);break;default:return}const T=new c.WindowRealm(this.id,this.#l,this.#o.cdpClient,this.#h,C,this.#p,S,k,this.#m,P);b.isDefault&&(this.#u.resolve(T),Promise.all(this.#o.getChannels().map(D=>D.startListenerFromWindow(T,this.#h))))}),this.#o.cdpClient.on("Runtime.executionContextDestroyed",p=>{this.#u.isFinished&&this.#u.result.executionContextId===p.executionContextId&&(this.#u=new r.Deferred),this.#m.deleteRealms({cdpSessionId:this.#o.cdpSessionId,executionContextId:p.executionContextId})}),this.#o.cdpClient.on("Runtime.executionContextsCleared",()=>{this.#u.isFinished||this.#u.reject(new t.UnknownErrorException("execution contexts cleared")),this.#u=new r.Deferred,this.#m.deleteRealms({cdpSessionId:this.#o.cdpSessionId})}),this.#o.cdpClient.on("Page.javascriptDialogClosed",p=>{if(p.frameId&&this.id!==p.frameId||!p.frameId&&this.#i&&this.#o.cdpClient!==this.#l.getContext(this.#i)?.cdpTarget.cdpClient)return;const b=p.result;this.#g===void 0&&this.#p?.(d.LogType.debugError,"Unexpectedly no opening prompt event before closing one"),this.#h.registerEvent({type:"event",method:t.ChromiumBidi.BrowsingContext.EventNames.UserPromptClosed,params:{context:this.id,accepted:b,type:this.#g??"UNKNOWN",userText:b&&p.userInput?p.userInput:void 0}},this.id),this.#g=void 0}),this.#o.cdpClient.on("Page.javascriptDialogOpening",p=>{if(p.frameId&&this.id!==p.frameId||!p.frameId&&this.#i&&this.#o.cdpClient!==this.#l.getContext(this.#i)?.cdpTarget.cdpClient)return;const b=n.#v(p.type);this.#g=b;const E=this.#S(b);switch(this.#h.registerEvent({type:"event",method:t.ChromiumBidi.BrowsingContext.EventNames.UserPromptOpened,params:{context:this.id,handler:E,type:b,message:p.message,...p.type==="prompt"?{defaultValue:p.defaultPrompt}:{}}},this.id),E){case"accept":this.handleUserPrompt(!0);break;case"dismiss":this.handleUserPrompt(!1);break}}),this.#o.browserCdpClient.on("Browser.downloadWillBegin",p=>{this.id===p.frameId&&(this.#r.set(p.guid,p.url),this.#h.registerEvent({type:"event",method:t.ChromiumBidi.BrowsingContext.EventNames.DownloadWillBegin,params:{context:this.id,suggestedFilename:p.suggestedFilename,navigation:p.guid,timestamp:(0,o.getTimestamp)(),url:p.url}},this.id))}),this.#o.browserCdpClient.on("Browser.downloadProgress",p=>{if(!this.#r.has(p.guid)||p.state==="inProgress")return;const b=this.#r.get(p.guid);switch(p.state){case"canceled":this.#h.registerEvent({type:"event",method:t.ChromiumBidi.BrowsingContext.EventNames.DownloadEnd,params:{status:"canceled",context:this.id,navigation:p.guid,timestamp:(0,o.getTimestamp)(),url:b}},this.id);break;case"completed":this.#h.registerEvent({type:"event",method:t.ChromiumBidi.BrowsingContext.EventNames.DownloadEnd,params:{filepath:p.filePath??null,status:"complete",context:this.id,navigation:p.guid,timestamp:(0,o.getTimestamp)(),url:b}},this.id);break;default:throw new t.UnknownErrorException(`Unknown download state: ${p.state}`)}})}static#v(p){switch(p){case"alert":return"alert";case"beforeunload":return"beforeunload";case"confirm":return"confirm";case"prompt":return"prompt"}}#S(p){const b="dismiss",E=this.#f.getActiveConfig(this.top.id,this.userContext);switch(p){case"alert":return E.userPromptHandler?.alert??E.userPromptHandler?.default??b;case"beforeunload":return E.userPromptHandler?.beforeUnload??E.userPromptHandler?.default??"accept";case"confirm":return E.userPromptHandler?.confirm??E.userPromptHandler?.default??b;case"prompt":return E.userPromptHandler?.prompt??E.userPromptHandler?.default??b}}#C(p){p===void 0||this.#n===p||(this.#P(),this.#n=p,this.#x(!0))}#P(){this.#d.DOMContentLoaded.isFinished?this.#d.DOMContentLoaded=new r.Deferred:this.#p?.(n.LOGGER_PREFIX,"Document changed (DOMContentLoaded)"),this.#d.load.isFinished?this.#d.load=new r.Deferred:this.#p?.(n.LOGGER_PREFIX,"Document changed (load)")}#T(){this.#d.DOMContentLoaded.isFinished||this.#d.DOMContentLoaded.reject(new t.UnknownErrorException("navigation canceled")),this.#d.load.isFinished||this.#d.load.reject(new t.UnknownErrorException("navigation canceled"))}async navigate(p,b){try{new URL(p)}catch{throw new t.InvalidArgumentException(`Invalid URL: ${p}`)}const E=this.#c.createPendingNavigation(p),k=(async()=>{const S=await this.#o.cdpClient.sendCommand("Page.navigate",{url:p,frameId:this.id});if(S.errorText)throw this.#c.failNavigation(E,S.errorText),new t.UnknownErrorException(S.errorText);this.#c.navigationCommandFinished(E,S.loaderId),this.#C(S.loaderId)})(),C=await Promise.race([this.#I(b,k,E),E.finished]);if(C instanceof l.NavigationResult&&(C.eventName==="browsingContext.navigationAborted"||C.eventName==="browsingContext.navigationFailed"))throw new t.UnknownErrorException(C.message??"unknown exception");return{navigation:E.navigationId,url:E.url}}async#I(p,b,E){if(await Promise.all([E.committed,b]),p!=="none"){if(E.isFragmentNavigation===!0){await E.finished;return}if(p==="interactive"){await this.#d.DOMContentLoaded;return}if(p==="complete"){await this.#d.load;return}throw new t.InvalidArgumentException(`Wait condition ${p} is not supported`)}}async reload(p,b){await this.targetUnblockedOrThrow(),this.#P();const E=this.#c.createPendingNavigation(this.#c.url),k=this.#o.cdpClient.sendCommand("Page.reload",{ignoreCache:p}),C=await Promise.race([this.#I(b,k,E),E.finished]);if(C instanceof l.NavigationResult&&(C.eventName==="browsingContext.navigationAborted"||C.eventName==="browsingContext.navigationFailed"))throw new t.UnknownErrorException(C.message??"unknown exception");return{navigation:E.navigationId,url:E.url}}async setViewport(p,b){await this.cdpTarget.setViewport(p,b)}async handleUserPrompt(p,b){await this.top.#o.cdpClient.sendCommand("Page.handleJavaScriptDialog",{accept:p??!0,promptText:b})}async activate(){await this.#o.cdpClient.sendCommand("Page.bringToFront")}async captureScreenshot(p){if(!this.isTopLevelContext())throw new t.UnsupportedOperationException(`Non-top-level 'context' (${p.context}) is currently not supported`);const b=f(p);let E=!1,k;switch(p.origin??="viewport",p.origin){case"document":{k=String(()=>{const T=document.documentElement;return{x:0,y:0,width:T.scrollWidth,height:T.scrollHeight}}),E=!0;break}case"viewport":{k=String(()=>{const T=window.visualViewport;return{x:T.pageLeft,y:T.pageTop,width:T.width,height:T.height}});break}}const C=await(await this.getOrCreateHiddenSandbox()).callFunction(k,!1);(0,a.assert)(C.type==="success");const S=y(C.result);(0,a.assert)(S);let P=S;if(p.clip){const T=p.clip;p.origin==="viewport"&&T.type==="box"&&(T.x+=S.x,T.y+=S.y),P=w(await this.#E(T),S)}if(P.width===0||P.height===0)throw new t.UnableToCaptureScreenException(`Unable to capture screenshot with zero dimensions: width=${P.width}, height=${P.height}`);return await this.#o.cdpClient.sendCommand("Page.captureScreenshot",{clip:{...P,scale:1},...b,captureBeyondViewport:E})}async print(p){if(!this.isTopLevelContext())throw new t.UnsupportedOperationException("Printing of non-top level contexts is not supported");const b={};if(p.background!==void 0&&(b.printBackground=p.background),p.margin?.bottom!==void 0&&(b.marginBottom=(0,e.inchesFromCm)(p.margin.bottom)),p.margin?.left!==void 0&&(b.marginLeft=(0,e.inchesFromCm)(p.margin.left)),p.margin?.right!==void 0&&(b.marginRight=(0,e.inchesFromCm)(p.margin.right)),p.margin?.top!==void 0&&(b.marginTop=(0,e.inchesFromCm)(p.margin.top)),p.orientation!==void 0&&(b.landscape=p.orientation==="landscape"),p.page?.height!==void 0&&(b.paperHeight=(0,e.inchesFromCm)(p.page.height)),p.page?.width!==void 0&&(b.paperWidth=(0,e.inchesFromCm)(p.page.width)),p.pageRanges!==void 0){for(const E of p.pageRanges){if(typeof E=="number")continue;const k=E.split("-");if(k.length<1||k.length>2)throw new t.InvalidArgumentException(`Invalid page range: ${E} is not a valid integer range.`);if(k.length===1){m(k[0]??"");continue}let C,S;const[P="",T=""]=k;if(P===""?C=1:C=m(P),T===""?S=Number.MAX_SAFE_INTEGER:S=m(T),C>S)throw new t.InvalidArgumentException(`Invalid page range: ${P} > ${T}`)}b.pageRanges=p.pageRanges.join(",")}p.scale!==void 0&&(b.scale=p.scale),p.shrinkToFit!==void 0&&(b.preferCSSPageSize=!p.shrinkToFit);try{return{data:(await this.#o.cdpClient.sendCommand("Page.printToPDF",b)).data}}catch(E){throw E.message==="invalid print parameters: content area is empty"?new t.UnsupportedOperationException(E.message):E}}async#E(p){switch(p.type){case"box":return{x:p.x,y:p.y,width:p.width,height:p.height};case"element":{const b=await this.getOrCreateHiddenSandbox(),E=await b.callFunction(String(k=>k instanceof Element),!1,{type:"undefined"},[p.element]);if(E.type==="exception")throw new t.NoSuchElementException(`Element '${p.element.sharedId}' was not found`);if((0,a.assert)(E.result.type==="boolean"),!E.result.value)throw new t.NoSuchElementException(`Node '${p.element.sharedId}' is not an Element`);{const k=await b.callFunction(String(S=>{const P=S.getBoundingClientRect();return{x:P.x,y:P.y,height:P.height,width:P.width}}),!1,{type:"undefined"},[p.element]);(0,a.assert)(k.type==="success");const C=y(k.result);if(!C)throw new t.UnableToCaptureScreenException(`Could not get bounding box for Element '${p.element.sharedId}'`);return C}}}}async close(){await this.#o.cdpClient.sendCommand("Page.close")}async traverseHistory(p){if(p===0)return;const b=await this.#o.cdpClient.sendCommand("Page.getNavigationHistory"),E=b.entries[b.currentIndex+p];if(!E)throw new t.NoSuchHistoryEntryException(`No history entry at delta ${p}`);await this.#o.cdpClient.sendCommand("Page.navigateToHistoryEntry",{entryId:E.id})}async toggleModulesIfNeeded(){await Promise.all([this.#o.toggleNetworkIfNeeded(),this.#o.toggleDeviceAccessIfNeeded()])}async locateNodes(p){return await this.#N(await this.#u,p.locator,p.startNodes??[],p.maxNodeCount,p.serializationOptions)}async#y(p,b,E,k){switch(b.type){case"context":throw new Error("Unreachable");case"css":return{functionDeclaration:String((C,S,...P)=>{const T=F=>{if(!(F instanceof HTMLElement||F instanceof Document||F instanceof DocumentFragment||F instanceof SVGElement))throw new Error("startNodes in css selector should be HTMLElement, SVGElement or Document or DocumentFragment");return[...F.querySelectorAll(C)]};P=P.length>0?P:[document];const D=P.map(F=>T(F)).flat(1);return S===0?D:D.slice(0,S)}),argumentsLocalValues:[{type:"string",value:b.value},{type:"number",value:E??0},...k]};case"xpath":return{functionDeclaration:String((C,S,...P)=>{const T=new XPathEvaluator().createExpression(C),D=B=>{const x=T.evaluate(B,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE),v=[];for(let I=0;I<x.snapshotLength;I++)v.push(x.snapshotItem(I));return v};P=P.length>0?P:[document];const F=P.map(B=>D(B)).flat(1);return S===0?F:F.slice(0,S)}),argumentsLocalValues:[{type:"string",value:b.value},{type:"number",value:E??0},...k]};case"innerText":if(b.value==="")throw new t.InvalidSelectorException("innerText locator cannot be empty");return{functionDeclaration:String((C,S,P,T,D,...F)=>{const B=P?C.toUpperCase():C,x=(I,N)=>{const q=[];if(I instanceof DocumentFragment||I instanceof Document)return[...I.children].forEach(Q=>q.push(...x(Q,N))),q;if(!(I instanceof HTMLElement))return[];const H=I,Y=P?H.innerText?.toUpperCase():H.innerText;if(!Y.includes(B))return[];const V=[];for(const Q of H.children)Q instanceof HTMLElement&&V.push(Q);if(V.length===0)S&&Y===B?q.push(H):S||q.push(H);else{const Q=N<=0?[]:V.map(ie=>x(ie,N-1)).flat(1);Q.length===0?(!S||Y===B)&&q.push(H):q.push(...Q)}return q};F=F.length>0?F:[document];const v=F.map(I=>x(I,D)).flat(1);return T===0?v:v.slice(0,T)}),argumentsLocalValues:[{type:"string",value:b.value},{type:"boolean",value:b.matchType!=="partial"},{type:"boolean",value:b.ignoreCase===!0},{type:"number",value:E??0},{type:"number",value:b.maxDepth??1e3},...k]};case"accessibility":{if(!b.value.name&&!b.value.role)throw new t.InvalidSelectorException("Either name or role has to be specified");await Promise.all([this.#o.cdpClient.sendCommand("Accessibility.enable"),this.#o.cdpClient.sendCommand("Accessibility.getRootAXNode")]);const C=await p.evaluate("({getAccessibleName, getAccessibleRole})",!1,"root",void 0,!1,!0);if(C.type!=="success")throw new Error("Could not get bindings");if(C.result.type!=="object")throw new Error("Could not get bindings");return{functionDeclaration:String((S,P,T,D,...F)=>{const B=[];let x=!1;function v(I,N){if(!x)for(const q of I){let H=!0;if(N.role){const V=T.getAccessibleRole(q);N.role!==V&&(H=!1)}if(N.name){const V=T.getAccessibleName(q);N.name!==V&&(H=!1)}if(H){if(D!==0&&B.length===D){x=!0;break}B.push(q)}const Y=[];for(const V of q.children)V instanceof HTMLElement&&Y.push(V);v(Y,N)}}return F=F.length>0?F:Array.from(document.documentElement.children).filter(I=>I instanceof HTMLElement),v(F,{role:P,name:S}),B}),argumentsLocalValues:[{type:"string",value:b.value.name||""},{type:"string",value:b.value.role||""},{handle:C.result.handle},{type:"number",value:E??0},...k]}}}}async#N(p,b,E,k,C){if(b.type==="context"){if(E.length!==0)throw new t.InvalidArgumentException("Start nodes are not supported");const T=b.value.context;if(!T)throw new t.InvalidSelectorException("Invalid context");const D=this.#l.getContext(T).parent;if(!D)throw new t.InvalidArgumentException("This context has no container");try{const{backendNodeId:F}=await D.#o.cdpClient.sendCommand("DOM.getFrameOwner",{frameId:T}),{object:B}=await D.#o.cdpClient.sendCommand("DOM.resolveNode",{backendNodeId:F}),x=await p.callFunction("function () { return this; }",!1,{handle:B.objectId},[],"none",C);if(x.type==="exception")throw new Error("Unknown exception");return{nodes:[x.result]}}catch{throw new t.InvalidArgumentException("Context does not exist")}}const S=await this.#y(p,b,k,E);C={...C,maxObjectDepth:1};const P=await p.callFunction(S.functionDeclaration,!1,{type:"undefined"},S.argumentsLocalValues,"none",C);if(P.type!=="success")throw this.#p?.(n.LOGGER_PREFIX,"Failed locateNodesByLocator",P),P.exceptionDetails.text?.endsWith("is not a valid selector.")||P.exceptionDetails.text?.endsWith("is not a valid XPath expression.")?new t.InvalidSelectorException(`Not valid selector ${typeof b.value=="string"?b.value:JSON.stringify(b.value)}`):P.exceptionDetails.text==="Error: startNodes in css selector should be HTMLElement, SVGElement or Document or DocumentFragment"?new t.InvalidArgumentException("startNodes in css selector should be HTMLElement, SVGElement or Document or DocumentFragment"):new t.UnknownErrorException(`Unexpected error in selector script: ${P.exceptionDetails.text}`);if(P.result.type!=="array")throw new t.UnknownErrorException(`Unexpected selector script result type: ${P.result.type}`);return{nodes:P.result.value.map(T=>{if(T.type!=="node")throw new t.UnknownErrorException(`Unexpected selector script result element: ${T.type}`);return T})}}#k(){const p=new Set;return p.add(this.cdpTarget),this.allChildren.forEach(b=>p.add(b.cdpTarget)),Array.from(p)}async setTimezoneOverride(p){await Promise.all(this.#k().map(async b=>await b.setTimezoneOverride(p)))}async setLocaleOverride(p){await Promise.all(this.#k().map(async b=>await b.setLocaleOverride(p)))}async setGeolocationOverride(p){await Promise.all(this.#k().map(async b=>await b.setGeolocationOverride(p)))}async setScreenOrientationOverride(p){await this.#o.setScreenOrientationOverride(p)}async setScriptingEnabled(p){await Promise.all(this.#k().map(async b=>await b.setScriptingEnabled(p)))}};Pe.BrowsingContextImpl=u,n=u;function h(p){return["://",""].includes(p)&&(p="null"),p}function f(p){const{quality:b,type:E}=p.format??{type:"image/png"};switch(E){case"image/png":return{format:"png"};case"image/jpeg":return{format:"jpeg",...b===void 0?{}:{quality:Math.round(b*100)}};case"image/webp":return{format:"webp",...b===void 0?{}:{quality:Math.round(b*100)}}}throw new t.InvalidArgumentException(`Image format '${E}' is not a supported format`)}function y(p){if(p.type!=="object"||p.value===void 0)return;const b=p.value.find(([S])=>S==="x")?.[1],E=p.value.find(([S])=>S==="y")?.[1],k=p.value.find(([S])=>S==="height")?.[1],C=p.value.find(([S])=>S==="width")?.[1];if(!(b?.type!=="number"||E?.type!=="number"||k?.type!=="number"||C?.type!=="number"))return{x:b.value,y:E.value,width:C.value,height:k.value}}function g(p){return{...p.width<0?{x:p.x+p.width,width:-p.width}:{x:p.x,width:p.width},...p.height<0?{y:p.y+p.height,height:-p.height}:{y:p.y,height:p.height}}}function w(p,b){p=g(p),b=g(b);const E=Math.max(p.x,b.x),k=Math.max(p.y,b.y);return{x:E,y:k,width:Math.max(Math.min(p.x+p.width,b.x+b.width)-E,0),height:Math.max(Math.min(p.y+p.height,b.y+b.height)-k,0)}}function m(p){if(p=p.trim(),!/^[0-9]+$/.test(p))throw new t.InvalidArgumentException(`Invalid integer: ${p}`);return parseInt(p)}return Pe}var ot={},Kr;function An(){if(Kr)return ot;Kr=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.WorkerRealm=void 0;const n=Ur();let t=class extends n.Realm{#e;#t;constructor(a,r,d,o,e,s,i,c,l){super(a,r,d,o,e,i,c),this.#t=s,this.#e=l,this.initialize()}get associatedBrowsingContexts(){return this.#t.flatMap(a=>a.associatedBrowsingContexts)}get realmType(){return this.#e}get source(){return{realm:this.realmId,context:this.associatedBrowsingContexts[0]?.id}}get realmInfo(){const a=this.#t.map(d=>d.realmId),{realmType:r}=this;switch(r){case"dedicated-worker":{const d=a[0];if(d===void 0||a.length!==1)throw new Error("Dedicated worker must have exactly one owner");return{...this.baseInfo,type:r,owners:[d]}}case"service-worker":case"shared-worker":return{...this.baseInfo,type:r}}}};return ot.WorkerRealm=t,ot}var at={},ct={},dt={},Wr;function Mn(){if(Wr)return dt;Wr=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.logMessageFormatter=r,dt.getRemoteValuesText=e;const n=ge(),t=["%s","%d","%i","%f","%o","%O","%c"];function a(s){return t.some(i=>s.includes(i))}function r(s){let i="";const c=s[0].value.toString(),l=s.slice(1,void 0),u=c.split(new RegExp(t.map(h=>`(${h})`).join("|"),"g"));for(const h of u)if(!(h===void 0||h===""))if(a(h)){const f=l.shift();(0,n.assert)(f,`Less value is provided: "${e(s,!1)}"`),h==="%s"?i+=o(f):h==="%d"||h==="%i"?f.type==="bigint"||f.type==="number"||f.type==="string"?i+=parseInt(f.value.toString(),10):i+="NaN":h==="%f"?f.type==="bigint"||f.type==="number"||f.type==="string"?i+=parseFloat(f.value.toString()):i+="NaN":i+=d(f)}else i+=h;if(l.length>0)throw new Error(`More value is provided: "${e(s,!1)}"`);return i}function d(s){if(s.type!=="array"&&s.type!=="bigint"&&s.type!=="date"&&s.type!=="number"&&s.type!=="object"&&s.type!=="string")return o(s);if(s.type==="bigint")return`${s.value.toString()}n`;if(s.type==="number")return s.value.toString();if(["date","string"].includes(s.type))return JSON.stringify(s.value);if(s.type==="object")return`{${s.value.map(i=>`${JSON.stringify(i[0])}:${d(i[1])}`).join(",")}}`;if(s.type==="array")return`[${s.value?.map(i=>d(i)).join(",")??""}]`;throw Error(`Invalid value type: ${s}`)}function o(s){if(!Object.hasOwn(s,"value"))return s.type;switch(s.type){case"string":case"number":case"boolean":case"bigint":return String(s.value);case"regexp":return`/${s.value.pattern}/${s.value.flags??""}`;case"date":return new Date(s.value).toString();case"object":return`Object(${s.value?.length??""})`;case"array":return`Array(${s.value?.length??""})`;case"map":return`Map(${s.value?.length})`;case"set":return`Set(${s.value?.length})`;default:return s.type}}function e(s,i){const c=s[0];return c?c.type==="string"&&a(c.value.toString())&&i?r(s):s.map(l=>o(l)).join(" "):""}return dt}var Vr;function Bn(){if(Vr)return ct;Vr=1;var n;Object.defineProperty(ct,"__esModule",{value:!0}),ct.LogManager=void 0;const t=j(),a=G(),r=Mn();function d(i){const c=i?.callFrames.map(l=>({columnNumber:l.columnNumber,functionName:l.functionName,lineNumber:l.lineNumber,url:l.url}));return c?{callFrames:c}:void 0}function o(i){return["error","assert"].includes(i)?"error":["debug","trace"].includes(i)?"debug":["warn","warning"].includes(i)?"warn":"info"}function e(i){switch(i){case"warning":return"warn";case"startGroup":return"group";case"startGroupCollapsed":return"groupCollapsed";case"endGroup":return"groupEnd"}return i}let s=class{#e;#t;#s;#r;constructor(i,c,l,u){this.#s=i,this.#t=c,this.#e=l,this.#r=u}static create(i,c,l,u){const h=new n(i,c,l,u);return h.#i(),h}async#n(i,c){switch(i.type){case"undefined":return{type:"undefined"};case"boolean":return{type:"boolean",value:i.value};case"string":return{type:"string",value:i.value};case"number":return{type:"number",value:i.unserializableValue??i.value};case"bigint":if(i.unserializableValue!==void 0&&i.unserializableValue[i.unserializableValue.length-1]==="n")return{type:i.type,value:i.unserializableValue.slice(0,-1)};break;case"object":if(i.subtype==="null")return{type:"null"};break}return await c.serializeCdpObject(i,"none")}#i(){this.#s.cdpClient.on("Runtime.consoleAPICalled",i=>{const c=this.#t.findRealm({cdpSessionId:this.#s.cdpSessionId,executionContextId:i.executionContextId});if(c===void 0){this.#r?.(a.LogType.cdp,i);return}const l=Promise.all(i.args.map(u=>this.#n(u,c)));for(const u of c.associatedBrowsingContexts)this.#e.registerPromiseEvent(l.then(h=>({kind:"success",value:{type:"event",method:t.ChromiumBidi.Log.EventNames.LogEntryAdded,params:{level:o(i.type),source:c.source,text:(0,r.getRemoteValuesText)(h,!0),timestamp:Math.round(i.timestamp),stackTrace:d(i.stackTrace),type:"console",method:e(i.type),args:h}}}),h=>({kind:"error",error:h})),u.id,t.ChromiumBidi.Log.EventNames.LogEntryAdded)}),this.#s.cdpClient.on("Runtime.exceptionThrown",i=>{const c=this.#t.findRealm({cdpSessionId:this.#s.cdpSessionId,executionContextId:i.exceptionDetails.executionContextId});if(c===void 0){this.#r?.(a.LogType.cdp,i);return}for(const l of c.associatedBrowsingContexts)this.#e.registerPromiseEvent(n.#a(i,c).then(u=>({kind:"success",value:{type:"event",method:t.ChromiumBidi.Log.EventNames.LogEntryAdded,params:{level:"error",source:c.source,text:u,timestamp:Math.round(i.timestamp),stackTrace:d(i.exceptionDetails.stackTrace),type:"javascript"}}}),u=>({kind:"error",error:u})),l.id,t.ChromiumBidi.Log.EventNames.LogEntryAdded)})}static async#a(i,c){return i.exceptionDetails.exception?c===void 0?JSON.stringify(i.exceptionDetails.exception):await c.stringifyObject(i.exceptionDetails.exception):i.exceptionDetails.text}};return ct.LogManager=s,n=s,ct}var Gr;function jn(){if(Gr)return at;Gr=1,Object.defineProperty(at,"__esModule",{value:!0}),at.CdpTarget=void 0;const n=$s(),t=j(),a=Rt(),r=G(),d=Hr(),o=Bn();let e=class qi{#e;#t;#s;#r;#n;#i;#a;#d;#o;#u;contextConfigStorage;#l=new a.Deferred;#h;#p={width:0,height:0,deviceScaleFactor:0,mobile:!1,dontSetVisibleSize:!0};#c;#m=!1;#f=!1;#g={request:!1,response:!1,auth:!1};static create(i,c,l,u,h,f,y,g,w,m,p,b){const E=new qi(i,c,l,u,f,h,y,g,m,w,p,b);return o.LogManager.create(E,h,f,b),E.#v(),E.#x(),E}constructor(i,c,l,u,h,f,y,g,w,m,p,b){this.#t=p,this.#e=i,this.#s=c,this.#r=l,this.#n=u,this.#a=h,this.#i=f,this.#d=y,this.#u=m,this.#o=g,this.contextConfigStorage=w,this.#h=b}get unblocked(){return this.#l}get id(){return this.#e}get cdpClient(){return this.#s}get parentCdpClient(){return this.#n}get browserCdpClient(){return this.#r}get cdpSessionId(){return this.#s.sessionId}get windowId(){return this.#c===void 0&&this.#h?.(r.LogType.debugError,"Getting windowId before it was set, returning 0"),this.#c??0}async#x(){try{await Promise.all([this.#s.sendCommand("Page.enable",{enableFileChooserOpenedEvent:!0}),...this.#E()?[]:[this.#s.sendCommand("Page.setInterceptFileChooserDialog",{enabled:!0,cancel:!0})],this.#s.sendCommand("Page.getFrameTree").then(i=>this.#b(i.frameTree)),this.#s.sendCommand("Runtime.enable"),this.#s.sendCommand("Page.setLifecycleEventsEnabled",{enabled:!0}),this.#s.sendCommand("Network.enable").then(()=>this.toggleNetworkIfNeeded()),this.#s.sendCommand("Target.setAutoAttach",{autoAttach:!0,waitForDebuggerOnStart:!0,flatten:!0}),this.#P(),this.#I(),this.#T(),this.#s.sendCommand("Runtime.runIfWaitingForDebugger"),this.#n.sendCommand("Runtime.runIfWaitingForDebugger"),this.toggleDeviceAccessIfNeeded()])}catch(i){if(this.#h?.(r.LogType.debugError,"Failed to unblock target",i),!this.#s.isCloseError(i)){this.#l.resolve({kind:"error",error:i});return}}this.#l.resolve({kind:"success",value:void 0})}#b(i){const c=i.frame,l=this.#o.findContext(c.id);if(l!==void 0&&l.parentId===null&&c.parentId!==null&&c.parentId!==void 0&&(l.parentId=c.parentId),l===void 0&&c.parentId!==void 0){const u=this.#o.getContext(c.parentId);d.BrowsingContextImpl.create(c.id,c.parentId,this.#t,u.cdpTarget,this.#a,this.#o,this.#i,this.contextConfigStorage,c.url,void 0,this.#h)}i.childFrames?.map(u=>this.#b(u))}async toggleFetchIfNeeded(){const i=this.#u.getInterceptionStages(this.topLevelId);if(this.#g.request===i.request&&this.#g.response===i.response&&this.#g.auth===i.auth)return;const c=[];if(this.#g=i,(i.request||i.auth)&&c.push({urlPattern:"*",requestStage:"Request"}),i.response&&c.push({urlPattern:"*",requestStage:"Response"}),c.length)await this.#s.sendCommand("Fetch.enable",{patterns:c,handleAuthRequests:i.auth});else{const l=this.#u.getRequestsByTarget(this).filter(u=>u.interceptPhase);Promise.allSettled(l.map(u=>u.waitNextPhase)).then(async()=>this.#u.getRequestsByTarget(this).filter(u=>u.interceptPhase).length?await this.toggleFetchIfNeeded():await this.#s.sendCommand("Fetch.disable")).catch(u=>{this.#h?.(r.LogType.bidi,"Disable failed",u)})}}async toggleNetworkIfNeeded(){try{await Promise.all([this.toggleSetCacheDisabled(),this.toggleFetchIfNeeded()])}catch(i){if(this.#h?.(r.LogType.debugError,i),!this.#w(i))throw i}}async toggleSetCacheDisabled(i){const c=this.#u.defaultCacheBehavior==="bypass",l=i??c;if(this.#f!==l){this.#f=l;try{await this.#s.sendCommand("Network.setCacheDisabled",{cacheDisabled:l})}catch(u){if(this.#h?.(r.LogType.debugError,u),this.#f=!l,!this.#w(u))throw u}}}async toggleDeviceAccessIfNeeded(){const i=this.isSubscribedTo(n.Bluetooth.EventNames.RequestDevicePromptUpdated);if(this.#m!==i){this.#m=i;try{await this.#s.sendCommand(i?"DeviceAccess.enable":"DeviceAccess.disable")}catch(c){if(this.#h?.(r.LogType.debugError,c),this.#m=!i,!this.#w(c))throw c}}}#w(i){const c=i;return c.code===-32001&&c.message==="Session with given id not found."||this.#s.isCloseError(i)}#v(){this.#s.on("*",(i,c)=>{typeof i=="string"&&this.#a.registerEvent({type:"event",method:`goog:cdp.${i}`,params:{event:i,params:c,session:this.cdpSessionId}},this.id)})}async#S(i){const c=[];if((i.request||i.auth)&&c.push({urlPattern:"*",requestStage:"Request"}),i.response&&c.push({urlPattern:"*",requestStage:"Response"}),c.length){const l=this.#g;this.#g=i;try{await this.#s.sendCommand("Fetch.enable",{patterns:c,handleAuthRequests:i.auth})}catch{this.#g=l}}}async#C(){this.#u.getRequestsByTarget(this).filter(i=>i.interceptPhase).length===0&&(this.#g={request:!1,response:!1,auth:!1},await this.#s.sendCommand("Fetch.disable"))}async toggleNetwork(){const i=this.#u.getInterceptionStages(this.topLevelId),c=Object.values(i).some(u=>u),l=this.#g.request!==i.request||this.#g.response!==i.response||this.#g.auth!==i.auth;this.#h?.(r.LogType.debugInfo,"Toggle Network",`Fetch (${c}) ${l}`),c&&l&&await this.#S(i),!c&&l&&await this.#C()}getChannels(){return this.#d.find().flatMap(i=>i.channels)}async#P(){const{windowId:i}=await this.#r.sendCommand("Browser.getWindowForTarget",{targetId:this.id});this.#c=i}async#T(){await Promise.all(this.#d.find({targetId:this.topLevelId}).map(i=>i.initInTarget(this,!0)))}async setViewport(i,c){if(i===null&&c===null){await this.cdpClient.sendCommand("Emulation.clearDeviceMetricsOverride");return}const l={...this.#p};i===null?(l.width=0,l.height=0):i!==void 0&&(l.width=i.width,l.height=i.height),c===null?l.deviceScaleFactor=0:c!==void 0&&(l.deviceScaleFactor=c);try{await this.cdpClient.sendCommand("Emulation.setDeviceMetricsOverride",l),this.#p=l}catch(u){throw u.message.startsWith("Width and height values must be positive")?new t.UnsupportedOperationException("Provided viewport dimensions are not supported"):u}}async#I(){const i=[],c=this.contextConfigStorage.getActiveConfig(this.topLevelId,this.#t);i.push(this.#s.sendCommand("Page.setPrerenderingAllowed",{isAllowed:!c.prerenderingDisabled}).catch(()=>{})),(c.viewport!==void 0||c.devicePixelRatio!==void 0)&&i.push(this.setViewport(c.viewport,c.devicePixelRatio).catch(()=>{})),c.screenOrientation!==void 0&&c.screenOrientation!==null&&i.push(this.setScreenOrientationOverride(c.screenOrientation).catch(()=>{})),c.geolocation!==void 0&&c.geolocation!==null&&i.push(this.setGeolocationOverride(c.geolocation)),c.locale!==void 0&&i.push(this.setLocaleOverride(c.locale)),c.timezone!==void 0&&i.push(this.setTimezoneOverride(c.timezone)),c.extraHeaders!==void 0&&i.push(this.setExtraHeaders(c.extraHeaders)),c.scriptingEnabled!==void 0&&i.push(this.setScriptingEnabled(c.scriptingEnabled)),c.acceptInsecureCerts!==void 0&&i.push(this.cdpClient.sendCommand("Security.setIgnoreCertificateErrors",{ignore:c.acceptInsecureCerts})),await Promise.all(i)}get topLevelId(){return this.#o.findTopLevelContextId(this.id)??this.id}isSubscribedTo(i){return this.#a.subscriptionManager.isSubscribedTo(i,this.topLevelId)}#E(){const i=this.contextConfigStorage.getActiveConfig(this.topLevelId,this.#t);return(i.userPromptHandler?.file??i.userPromptHandler?.default??"ignore")==="ignore"}async setGeolocationOverride(i){if(i===null)await this.cdpClient.sendCommand("Emulation.clearGeolocationOverride");else if("type"in i){if(i.type!=="positionUnavailable")throw new t.UnknownErrorException(`Unknown geolocation error ${i.type}`);await this.cdpClient.sendCommand("Emulation.setGeolocationOverride",{})}else if("latitude"in i)await this.cdpClient.sendCommand("Emulation.setGeolocationOverride",{latitude:i.latitude,longitude:i.longitude,accuracy:i.accuracy??1,altitude:i.altitude??void 0,altitudeAccuracy:i.altitudeAccuracy??void 0,heading:i.heading??void 0,speed:i.speed??void 0});else throw new t.UnknownErrorException("Unexpected geolocation coordinates value")}async setScreenOrientationOverride(i){const c={...this.#p};i===null?delete c.screenOrientation:c.screenOrientation=this.#y(i),await this.cdpClient.sendCommand("Emulation.setDeviceMetricsOverride",c),this.#p=c}#y(i){if(i.natural==="portrait")switch(i.type){case"portrait-primary":return{angle:0,type:"portraitPrimary"};case"landscape-primary":return{angle:90,type:"landscapePrimary"};case"portrait-secondary":return{angle:180,type:"portraitSecondary"};case"landscape-secondary":return{angle:270,type:"landscapeSecondary"};default:throw new t.UnknownErrorException(`Unexpected screen orientation type ${i.type}`)}if(i.natural==="landscape")switch(i.type){case"landscape-primary":return{angle:0,type:"landscapePrimary"};case"portrait-primary":return{angle:90,type:"portraitPrimary"};case"landscape-secondary":return{angle:180,type:"landscapeSecondary"};case"portrait-secondary":return{angle:270,type:"portraitSecondary"};default:throw new t.UnknownErrorException(`Unexpected screen orientation type ${i.type}`)}throw new t.UnknownErrorException(`Unexpected orientation natural ${i.natural}`)}async setLocaleOverride(i){i===null?await this.cdpClient.sendCommand("Emulation.setLocaleOverride",{}):await this.cdpClient.sendCommand("Emulation.setLocaleOverride",{locale:i})}async setScriptingEnabled(i){await this.cdpClient.sendCommand("Emulation.setScriptExecutionDisabled",{value:i===!1})}async setTimezoneOverride(i){i===null?await this.cdpClient.sendCommand("Emulation.setTimezoneOverride",{timezoneId:""}):await this.cdpClient.sendCommand("Emulation.setTimezoneOverride",{timezoneId:i})}async setExtraHeaders(i){await this.cdpClient.sendCommand("Network.setExtraHTTPHeaders",{headers:i})}};return at.CdpTarget=e,at}var Xr;function Un(){if(Xr)return tt;Xr=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.CdpTargetManager=void 0;const n=G(),t=Hr(),a=An(),r=jn(),d={service_worker:"service-worker",shared_worker:"shared-worker",worker:"dedicated-worker"};let o=class{#e;#t;#s=new Set;#r;#n;#i;#a;#d;#o;#u;#l;#h;#p;constructor(e,s,i,c,l,u,h,f,y,g,w,m){this.#t=e,this.#e=s,this.#s.add(i),this.#r=i,this.#n=c,this.#i=l,this.#o=g,this.#a=h,this.#l=f,this.#d=y,this.#u=u,this.#h=w,this.#p=m,this.#c(s)}#c(e){e.on("Target.attachedToTarget",s=>{this.#g(s,e)}),e.on("Target.detachedFromTarget",this.#S.bind(this)),e.on("Target.targetInfoChanged",this.#C.bind(this)),e.on("Inspector.targetCrashed",()=>{this.#P(e)}),e.on("Page.frameAttached",this.#m.bind(this)),e.on("Page.frameSubtreeWillBeDetached",this.#f.bind(this))}#m(e){const s=this.#i.findContext(e.parentFrameId);s!==void 0&&t.BrowsingContextImpl.create(e.frameId,e.parentFrameId,s.userContext,s.cdpTarget,this.#n,this.#i,this.#u,this.#l,"about:blank",void 0,this.#p)}#f(e){this.#i.findContext(e.frameId)?.dispose(!0)}#g(e,s){const{sessionId:i,targetInfo:c}=e,l=this.#t.getCdpClient(i),u=async()=>{await l.sendCommand("Runtime.runIfWaitingForDebugger").then(()=>s.sendCommand("Target.detachFromTarget",e)).catch(y=>this.#p?.(n.LogType.debugError,y))};if(this.#r===c.targetId){u();return}const h=c.type==="service_worker"?`${s.sessionId}_${c.targetId}`:c.targetId;if(this.#s.has(h))return;this.#s.add(h);const f=c.browserContextId&&c.browserContextId!==this.#h?c.browserContextId:"default";switch(c.type){case"tab":{this.#c(l),(async()=>await l.sendCommand("Target.setAutoAttach",{autoAttach:!0,waitForDebuggerOnStart:!0,flatten:!0}))();return}case"page":case"iframe":{const y=this.#b(l,s,c,f),g=this.#i.findContext(c.targetId);if(g&&c.type==="iframe")g.updateCdpTarget(y);else{const w=this.#x(c,s.sessionId);t.BrowsingContextImpl.create(c.targetId,w,f,y,this.#n,this.#i,this.#u,this.#l,c.url===""?"about:blank":c.url,c.openerFrameId??c.openerId,this.#p)}return}case"service_worker":case"worker":{const y=this.#u.findRealm({cdpSessionId:s.sessionId});if(!y){u();return}const g=this.#b(l,s,c,f);this.#v(d[c.type],g,y);return}case"shared_worker":{const y=this.#b(l,s,c,f);this.#v(d[c.type],y);return}}u()}#x(e,s){if(e.type!=="iframe")return null;const i=e.openerFrameId??e.openerId;return i!==void 0?i:s!==void 0?this.#i.findContextBySession(s)?.id??null:null}#b(e,s,i,c){this.#c(e),this.#o.onCdpTargetCreated(i.targetId,c);const l=r.CdpTarget.create(i.targetId,e,this.#e,s,this.#u,this.#n,this.#o,this.#i,this.#a,this.#l,c,this.#p);return this.#a.onCdpTargetCreated(l),this.#d.onCdpTargetCreated(l),l}#w=new Map;#v(e,s,i){s.cdpClient.on("Runtime.executionContextCreated",c=>{const{uniqueId:l,id:u,origin:h}=c.context,f=new a.WorkerRealm(s.cdpClient,this.#n,u,this.#p,(0,t.serializeOrigin)(h),i?[i]:[],l,this.#u,e);this.#w.set(s.cdpSessionId,f)})}#S({sessionId:e,targetId:s}){s&&this.#o.find({targetId:s}).map(l=>{l.dispose(s)});const i=this.#i.findContextBySession(e);if(i){i.dispose(!0);return}const c=this.#w.get(e);c&&this.#u.deleteRealms({cdpSessionId:c.cdpClient.sessionId})}#C(e){const s=this.#i.findContext(e.targetInfo.targetId);s&&s.onTargetInfoChanged(e)}#P(e){const s=this.#u.findRealms({cdpSessionId:e.sessionId});for(const i of s)i.dispose()}};return tt.CdpTargetManager=o,tt}var ut={},Jr;function Ln(){if(Jr)return ut;Jr=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.BrowsingContextStorage=void 0;const n=j(),t=Oe();let a=class{#e=new Map;#t=new t.EventEmitter;getTopLevelContexts(){return this.getAllContexts().filter(r=>r.isTopLevelContext())}getAllContexts(){return Array.from(this.#e.values())}deleteContextById(r){this.#e.delete(r)}deleteContext(r){this.#e.delete(r.id)}addContext(r){this.#e.set(r.id,r),this.#t.emit("added",{browsingContext:r})}waitForContext(r){return this.#e.has(r)?Promise.resolve(this.getContext(r)):new Promise(d=>{const o=e=>{e.browsingContext.id===r&&(this.#t.off("added",o),d(e.browsingContext))};this.#t.on("added",o)})}hasContext(r){return this.#e.has(r)}findContext(r){return this.#e.get(r)}findTopLevelContextId(r){if(r===null)return null;const d=this.findContext(r);if(!d)return null;const o=d.parentId??null;return o===null?r:this.findTopLevelContextId(o)}findContextBySession(r){for(const d of this.#e.values())if(d.cdpTarget.cdpSessionId===r)return d}getContext(r){const d=this.findContext(r);if(d===void 0)throw new n.NoSuchFrameException(`Context ${r} not found`);return d}verifyTopLevelContextsList(r){const d=new Set;if(!r)return d;for(const o of r){const e=this.getContext(o);if(e.isTopLevelContext())d.add(e);else throw new n.InvalidArgumentException(`Non top-level context '${o}' given.`)}return d}verifyContextsList(r){if(r.length)for(const d of r)this.getContext(d)}};return ut.BrowsingContextStorage=a,ut}var lt={},ht={},pt={},Yr;function Qr(){if(Yr)return pt;Yr=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.DefaultMap=void 0;let n=class extends Map{#e;constructor(t,a){super(a),this.#e=t}get(t){return this.has(t)||this.set(t,this.#e(t)),super.get(t)}};return pt.DefaultMap=n,pt}var Zr;function qn(){if(Zr)return ht;Zr=1;var n;Object.defineProperty(ht,"__esModule",{value:!0}),ht.NetworkRequest=void 0;const t=j(),a=ge(),r=Qr(),d=Rt(),o=G(),e=Ot(),s=/(?<=realm=").*(?=")/;let i=class{static unknownParameter="UNKNOWN";#e;#t;#s;#r=!1;#n;#i={};#a;#d;#o={};#u;#l;#h;#p;#c={[t.ChromiumBidi.Network.EventNames.AuthRequired]:!1,[t.ChromiumBidi.Network.EventNames.BeforeRequestSent]:!1,[t.ChromiumBidi.Network.EventNames.FetchError]:!1,[t.ChromiumBidi.Network.EventNames.ResponseCompleted]:!1,[t.ChromiumBidi.Network.EventNames.ResponseStarted]:!1};waitNextPhase=new d.Deferred;constructor(u,h,f,y,g=0,w){this.#e=u,this.#u=h,this.#l=f,this.#h=y,this.#n=g,this.#p=w}get id(){return this.#e}get fetchId(){return this.#t}get interceptPhase(){return this.#s}get url(){const u=this.#i.info?.request.urlFragment??this.#i.paused?.request.urlFragment??"";return`${this.#o.paused?.request.url??this.#a?.url??this.#o.info?.url??this.#i.auth?.request.url??this.#i.info?.request.url??this.#i.paused?.request.url??n.unknownParameter}${u}`}get redirectCount(){return this.#n}get cdpTarget(){return this.#h}get cdpClient(){return this.#h.cdpClient}isRedirecting(){return!!this.#i.info}#m(){return this.url.startsWith("data:")}get#f(){return this.#a?.method??this.#i.info?.request.method??this.#i.paused?.request.method??this.#i.auth?.request.method??this.#o.paused?.request.method}get#g(){return!this.#i.info||!this.#i.info.loaderId||this.#i.info.loaderId!==this.#i.info.requestId?null:this.#l.getNavigationId(this.#w??void 0)}get#x(){let u=[];return this.#i.extraInfo&&(u=this.#i.extraInfo.associatedCookies.filter(({blockedReasons:h})=>!Array.isArray(h)||h.length===0).map(({cookie:h})=>(0,e.cdpToBiDiCookie)(h))),u}get#b(){let u=0;return typeof this.#a?.bodySize=="number"?u=this.#a.bodySize:u=(0,e.bidiBodySizeFromCdpPostDataEntries)(this.#i.info?.request.postDataEntries??[]),u}get#w(){const u=this.#o.paused?.frameId??this.#i.info?.frameId??this.#i.paused?.frameId??this.#i.auth?.frameId;if(u!==void 0)return u;if(this.#i?.info?.initiator.type==="preflight"&&this.#i?.info?.initiator.requestId!==void 0){const h=this.#l.getRequestById(this.#i?.info?.initiator.requestId);if(h!==void 0)return h.#i.info?.frameId??null}return null}get#v(){return this.#d?.statusCode??this.#o.paused?.responseStatusCode??this.#o.extraInfo?.statusCode??this.#o.info?.status}get#S(){let u=[];if(this.#a?.headers){const h=new r.DefaultMap(()=>[]);for(const f of this.#a.headers)h.get(f.name).push(f.value.value);for(const[f,y]of h.entries())u.push({name:f,value:{type:"string",value:y.join(`
`).trimEnd()}})}else u=[...(0,e.bidiNetworkHeadersFromCdpNetworkHeaders)(this.#i.info?.request.headers),...(0,e.bidiNetworkHeadersFromCdpNetworkHeaders)(this.#i.extraInfo?.headers)];return u}get#C(){if(!this.#o.info||!(this.#v===401||this.#v===407))return;const u=this.#v===401?"WWW-Authenticate":"Proxy-Authenticate",h=[];for(const[f,y]of Object.entries(this.#o.info.headers))f.localeCompare(u,void 0,{sensitivity:"base"})===0&&h.push({scheme:y.split(" ").at(0)??"",realm:y.match(s)?.at(0)??""});return h}get#P(){const u=(0,e.getTiming)((0,e.getTiming)(this.#o.info?.timing?.requestTime)-(0,e.getTiming)(this.#i.info?.timestamp));return{timeOrigin:Math.round((0,e.getTiming)(this.#i.info?.wallTime)*1e3),requestTime:0,redirectStart:0,redirectEnd:0,fetchStart:(0,e.getTiming)(this.#o.info?.timing?.workerFetchStart,u),dnsStart:(0,e.getTiming)(this.#o.info?.timing?.dnsStart,u),dnsEnd:(0,e.getTiming)(this.#o.info?.timing?.dnsEnd,u),connectStart:(0,e.getTiming)(this.#o.info?.timing?.connectStart,u),connectEnd:(0,e.getTiming)(this.#o.info?.timing?.connectEnd,u),tlsStart:(0,e.getTiming)(this.#o.info?.timing?.sslStart,u),requestStart:(0,e.getTiming)(this.#o.info?.timing?.sendStart,u),responseStart:(0,e.getTiming)(this.#o.info?.timing?.receiveHeadersStart,u),responseEnd:(0,e.getTiming)(this.#o.info?.timing?.receiveHeadersEnd,u)}}#T(){this.waitNextPhase.resolve(),this.waitNextPhase=new d.Deferred}#I(u){return this.#h.isSubscribedTo(`network.${u}`)?this.#l.getInterceptsForPhase(this,u):new Set}#E(u){return this.#I(u).size>0}handleRedirect(u){this.#o.hasExtraInfo=!1,this.#o.info=u.redirectResponse,this.#y({wasRedirected:!0})}#y(u={}){const h=u.wasRedirected||u.hasFailed||this.#m()||!!this.#i.extraInfo||this.#r||!!(this.#o.info&&!this.#o.hasExtraInfo),f=this.#m()||this.#r,y=!f&&this.#E("beforeRequestSent"),g=!y||y&&!!this.#i.paused;this.#i.info&&(y?g:h)&&this.#D(this.#U.bind(this));const w=!!this.#o.extraInfo||this.#r||!!(this.#o.info&&!this.#o.hasExtraInfo),m=!f&&this.#E("responseStarted");(this.#o.info||m&&this.#o.paused)&&this.#D(this.#L.bind(this));const p=!m||m&&!!this.#o.paused;this.#o.info&&w&&p&&(this.#D(this.#q.bind(this)),this.#l.disposeRequest(this.id))}onRequestWillBeSentEvent(u){this.#i.info=u,this.#y()}onRequestWillBeSentExtraInfoEvent(u){this.#i.extraInfo=u,this.#y()}onResponseReceivedExtraInfoEvent(u){u.statusCode>=300&&u.statusCode<=399&&this.#i.info&&u.headers.location===this.#i.info.request.url||(this.#o.extraInfo=u,this.#y())}onResponseReceivedEvent(u){this.#o.hasExtraInfo=u.hasExtraInfo,this.#o.info=u.response,this.#l.markRequestCollectedIfNeeded(this),this.#y()}onServedFromCache(){this.#r=!0,this.#y()}onLoadingFailedEvent(u){this.#y({hasFailed:!0}),this.#D(()=>({method:t.ChromiumBidi.Network.EventNames.FetchError,params:{...this.#R(),errorText:u.errorText}}))}async failRequest(u){(0,a.assert)(this.#t,"Network Interception not set-up."),await this.cdpClient.sendCommand("Fetch.failRequest",{requestId:this.#t,errorReason:u}),this.#s=void 0}onRequestPaused(u){this.#t=u.requestId,u.responseStatusCode||u.responseErrorReason?(this.#o.paused=u,this.#E("responseStarted")&&!this.#c[t.ChromiumBidi.Network.EventNames.ResponseStarted]&&this.#t!==this.id?this.#s="responseStarted":this.#k()):(this.#i.paused=u,this.#E("beforeRequestSent")&&!this.#c[t.ChromiumBidi.Network.EventNames.BeforeRequestSent]&&this.#t!==this.id?this.#s="beforeRequestSent":this.#N()),this.#y()}onAuthRequired(u){this.#t=u.requestId,this.#i.auth=u,this.#E("authRequired")&&this.#t!==this.id?this.#s="authRequired":this.#O({response:"Default"}),this.#D(()=>({method:t.ChromiumBidi.Network.EventNames.AuthRequired,params:{...this.#R("authRequired"),response:this.#F()}}))}async continueRequest(u={}){const h=this.#A(u.headers,u.cookies),f=(0,e.cdpFetchHeadersFromBidiNetworkHeaders)(h),y=c(u.body);await this.#N({url:u.url,method:u.method,headers:f,postData:y}),this.#a={url:u.url,method:u.method,headers:u.headers,cookies:u.cookies,bodySize:l(u.body)}}async#N(u={}){(0,a.assert)(this.#t,"Network Interception not set-up."),await this.cdpClient.sendCommand("Fetch.continueRequest",{requestId:this.#t,url:u.url,method:u.method,headers:u.headers,postData:u.postData}),this.#s=void 0}async continueResponse(u={}){if(this.interceptPhase==="authRequired")if(u.credentials)await Promise.all([this.waitNextPhase,await this.#O({response:"ProvideCredentials",username:u.credentials.username,password:u.credentials.password})]);else return await this.#O({response:"ProvideCredentials"});if(this.#s==="responseStarted"){const h=this.#A(u.headers,u.cookies),f=(0,e.cdpFetchHeadersFromBidiNetworkHeaders)(h);await this.#k({responseCode:u.statusCode??this.#o.paused?.responseStatusCode,responsePhrase:u.reasonPhrase??this.#o.paused?.responseStatusText,responseHeaders:f??this.#o.paused?.responseHeaders}),this.#d={statusCode:u.statusCode,headers:h}}}async#k({responseCode:u,responsePhrase:h,responseHeaders:f}={}){(0,a.assert)(this.#t,"Network Interception not set-up."),await this.cdpClient.sendCommand("Fetch.continueResponse",{requestId:this.#t,responseCode:u,responsePhrase:h,responseHeaders:f}),this.#s=void 0}async continueWithAuth(u){let h,f;if(u.action==="provideCredentials"){const{credentials:g}=u;h=g.username,f=g.password}const y=(0,e.cdpAuthChallengeResponseFromBidiAuthContinueWithAuthAction)(u.action);await this.#O({response:y,username:h,password:f})}async provideResponse(u){if((0,a.assert)(this.#t,"Network Interception not set-up."),this.interceptPhase==="authRequired")return await this.#O({response:"ProvideCredentials"});if(!u.body&&!u.headers)return await this.#N();const h=this.#A(u.headers,u.cookies),f=(0,e.cdpFetchHeadersFromBidiNetworkHeaders)(h),y=u.statusCode??this.#v??200;await this.cdpClient.sendCommand("Fetch.fulfillRequest",{requestId:this.#t,responseCode:y,responsePhrase:u.reasonPhrase,responseHeaders:f,body:c(u.body)}),this.#s=void 0}dispose(){this.waitNextPhase.reject(new Error("waitNextPhase disposed"))}async#O(u){(0,a.assert)(this.#t,"Network Interception not set-up."),await this.cdpClient.sendCommand("Fetch.continueWithAuth",{requestId:this.#t,authChallengeResponse:u}),this.#s=void 0}#D(u){let h;try{h=u()}catch(f){this.#p?.(o.LogType.debugError,f);return}this.#$()||this.#c[h.method]&&h.method!==t.ChromiumBidi.Network.EventNames.AuthRequired||(this.#T(),this.#c[h.method]=!0,this.#w?this.#u.registerEvent(Object.assign(h,{type:"event"}),this.#w):this.#u.registerGlobalEvent(Object.assign(h,{type:"event"})))}#R(u){const h={isBlocked:!1};if(u){const f=this.#I(u);h.isBlocked=f.size>0,h.isBlocked&&(h.intercepts=[...f])}return{context:this.#w,navigation:this.#g,redirectCount:this.#n,request:this.#M(),timestamp:Math.round((0,e.getTiming)(this.#i.info?.wallTime)*1e3),...h}}#F(){this.#o.info?.fromDiskCache&&(this.#o.extraInfo=void 0);const u=[...(0,e.bidiNetworkHeadersFromCdpNetworkHeaders)(this.#o.info?.headers),...(0,e.bidiNetworkHeadersFromCdpNetworkHeaders)(this.#o.extraInfo?.headers)],h=this.#C;return{url:this.url,protocol:this.#o.info?.protocol??"",status:this.#v??-1,statusText:this.#o.info?.statusText||this.#o.paused?.responseStatusText||"",fromCache:this.#o.info?.fromDiskCache||this.#o.info?.fromPrefetchCache||this.#r,headers:this.#d?.headers??u,mimeType:this.#o.info?.mimeType||"",bytesReceived:this.#o.info?.encodedDataLength||0,headersSize:(0,e.computeHeadersSize)(u),bodySize:0,content:{size:0},...h?{authChallenges:h}:{},"goog:securityDetails":this.#o.info?.securityDetails}}#M(){const u=this.#S;return{request:this.#e,url:this.url,method:this.#f??n.unknownParameter,headers:u,cookies:this.#x,headersSize:(0,e.computeHeadersSize)(u),bodySize:this.#b,destination:this.#B(),initiatorType:this.#j(),timings:this.#P,"goog:postData":this.#i.info?.request?.postData,"goog:hasPostData":this.#i.info?.request?.hasPostData,"goog:resourceType":this.#i.info?.type,"goog:resourceInitiator":this.#i.info?.initiator}}#B(){switch(this.#i.info?.type){case"Script":return"script";case"Stylesheet":return"style";case"Image":return"image";case"Document":return this.#i.info?.initiator.type==="parser"?"iframe":"";default:return""}}#j(){if(this.#i.info?.initiator.type==="parser")switch(this.#i.info?.type){case"Document":return"iframe";case"Font":return this.#i.info?.initiator?.url===this.#i.info?.documentURL?"font":"css";case"Image":return this.#i.info?.initiator?.url===this.#i.info?.documentURL?"img":"css";case"Script":return"script";case"Stylesheet":return"link";default:return null}return this.#i?.info?.type==="Fetch"?"fetch":null}#U(){return(0,a.assert)(this.#i.info,"RequestWillBeSentEvent is not set"),{method:t.ChromiumBidi.Network.EventNames.BeforeRequestSent,params:{...this.#R("beforeRequestSent"),initiator:{type:n.#z(this.#i.info.initiator.type),columnNumber:this.#i.info.initiator.columnNumber,lineNumber:this.#i.info.initiator.lineNumber,stackTrace:this.#i.info.initiator.stack,request:this.#i.info.initiator.requestId}}}}#L(){return{method:t.ChromiumBidi.Network.EventNames.ResponseStarted,params:{...this.#R("responseStarted"),response:this.#F()}}}#q(){return{method:t.ChromiumBidi.Network.EventNames.ResponseCompleted,params:{...this.#R(),response:this.#F()}}}#$(){const u="/favicon.ico";return this.#i.paused?.request.url.endsWith(u)??this.#i.info?.request.url.endsWith(u)??!1}#A(u,h){if(!u&&!h)return;let f=u;const y=(0,e.networkHeaderFromCookieHeaders)(h);return y&&!f&&(f=this.#S),y&&f&&(f.filter(g=>g.name.localeCompare("cookie",void 0,{sensitivity:"base"})!==0),f.push(y)),f}static#z(u){switch(u){case"parser":case"script":case"preflight":return u;default:return"other"}}};ht.NetworkRequest=i,n=i;function c(u){let h;return u?.type==="string"?h=(0,e.stringToBase64)(u.value):u?.type==="base64"&&(h=u.value),h}function l(u){return u?.type==="string"?u.value.length:u?.type==="base64"?atob(u.value).length:0}return ht}var ei;function $n(){if(ei)return lt;ei=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.NetworkStorage=void 0;const n=j(),t=G(),a=fe(),r=qn(),d=Ot();let o=class{#e;#t;#s;#r=new Map;#n=new Map;#i=new Map;#a=new Map;#d="default";constructor(e,s,i,c){this.#e=s,this.#t=e,i.on("Target.detachedFromTarget",({sessionId:l})=>{this.disposeRequestMap(l)}),this.#s=c}#o(e,s,i){let c=this.getRequestById(e);return c||(c=new r.NetworkRequest(e,this.#t,this,s,i,this.#s),this.addRequest(c),c)}onCdpTargetCreated(e){const s=e.cdpClient,i=[["Network.requestWillBeSent",c=>{const l=this.getRequestById(c.requestId);l&&l.isRedirecting()?(l.handleRedirect(c),this.disposeRequest(c.requestId),this.#o(c.requestId,e,l.redirectCount+1).onRequestWillBeSentEvent(c)):this.#o(c.requestId,e).onRequestWillBeSentEvent(c)}],["Network.requestWillBeSentExtraInfo",c=>{this.#o(c.requestId,e).onRequestWillBeSentExtraInfoEvent(c)}],["Network.responseReceived",c=>{this.#o(c.requestId,e).onResponseReceivedEvent(c)}],["Network.responseReceivedExtraInfo",c=>{this.#o(c.requestId,e).onResponseReceivedExtraInfoEvent(c)}],["Network.requestServedFromCache",c=>{this.#o(c.requestId,e).onServedFromCache()}],["Network.loadingFailed",c=>{this.#o(c.requestId,e).onLoadingFailedEvent(c)}],["Fetch.requestPaused",c=>{this.#o(c.networkId??c.requestId,e).onRequestPaused(c)}],["Fetch.authRequired",c=>{let l=this.getRequestByFetchId(c.requestId);l||(l=this.#o(c.requestId,e)),l.onAuthRequired(c)}]];for(const[c,l]of i)s.on(c,l)}getCollectorsForBrowsingContext(e){if(!this.#e.hasContext(e))return this.#s?.(t.LogType.debugError,"trying to get collector for unknown browsing context"),[];const s=this.#e.getContext(e).userContext,i=new Set;for(const c of this.#i.values())c.contexts?.includes(e)&&i.add(c),c.userContexts?.includes(s)&&i.add(c),c.userContexts===void 0&&c.contexts===void 0&&i.add(c);return[...i.values()]}async getCollectedData(e){if(e.collector!==void 0&&!this.#i.has(e.collector))throw new n.NoSuchNetworkCollectorException(`Unknown collector ${e.collector}`);const s=this.#a.get(e.request);if(s===void 0)throw new n.NoSuchNetworkDataException(`No collected data for request ${e.request}`);if(e.collector!==void 0&&!s.has(e.collector))throw new n.NoSuchNetworkDataException(`Collector ${e.collector} didn't collect data for request ${e.request}`);if(e.disown&&e.collector===void 0)throw new n.InvalidArgumentException("Cannot disown collected data without collector ID");const i=this.getRequestById(e.request);if(i===void 0)throw new n.NoSuchNetworkDataException(`No collected data for request ${e.request}`);const c=await i.cdpClient.sendCommand("Network.getResponseBody",{requestId:i.id});return e.disown&&e.collector!==void 0&&(this.#a.delete(e.request),this.disposeRequest(i.id)),{bytes:{type:c.base64Encoded?"base64":"string",value:c.body}}}#u(e){const s=new Set;for(const i of this.#i.keys()){const c=this.#i.get(i);!c.userContexts&&!c.contexts&&s.add(i),c.contexts?.includes(e.cdpTarget.topLevelId)&&s.add(i),c.userContexts?.includes(this.#e.getContext(e.cdpTarget.topLevelId).userContext)&&s.add(i)}return this.#s?.(t.LogType.debug,`Request ${e.id} has ${s.size} collectors`),[...s.values()]}markRequestCollectedIfNeeded(e){const s=this.#u(e);s.length>0&&this.#a.set(e.id,new Set(s))}getInterceptionStages(e){const s={request:!1,response:!1,auth:!1};for(const i of this.#n.values())i.contexts&&!i.contexts.includes(e)||(s.request||=i.phases.includes("beforeRequestSent"),s.response||=i.phases.includes("responseStarted"),s.auth||=i.phases.includes("authRequired"));return s}getInterceptsForPhase(e,s){if(e.url===r.NetworkRequest.unknownParameter)return new Set;const i=new Set;for(const[c,l]of this.#n.entries())if(!(!l.phases.includes(s)||l.contexts&&!l.contexts.includes(e.cdpTarget.topLevelId))){if(l.urlPatterns.length===0){i.add(c);continue}for(const u of l.urlPatterns)if((0,d.matchUrlPattern)(u,e.url)){i.add(c);break}}return i}disposeRequestMap(e){for(const s of this.#r.values())s.cdpClient.sessionId===e&&(this.#r.delete(s.id),s.dispose())}addIntercept(e){const s=(0,a.uuidv4)();return this.#n.set(s,e),s}removeIntercept(e){if(!this.#n.has(e))throw new n.NoSuchInterceptException(`Intercept '${e}' does not exist.`);this.#n.delete(e)}getRequestsByTarget(e){const s=[];for(const i of this.#r.values())i.cdpTarget===e&&s.push(i);return s}getRequestById(e){return this.#r.get(e)}getRequestByFetchId(e){for(const s of this.#r.values())if(s.fetchId===e)return s}addRequest(e){this.#r.set(e.id,e)}disposeRequest(e){(this.#a.get(e)?.size??!1)||this.#r.delete(e)}getNavigationId(e){return e===void 0?null:this.#e.findContext(e)?.navigationId??null}set defaultCacheBehavior(e){this.#d=e}get defaultCacheBehavior(){return this.#d}addDataCollector(e){const s=(0,a.uuidv4)();return this.#i.set(s,e),s}removeDataCollector(e){const s=e.collector;if(!this.#i.has(s))throw new n.NoSuchNetworkCollectorException(`Collector ${e.collector} does not exist`);this.#i.delete(e.collector);for(const[i,c]of this.#a)c.has(s)&&(c.delete(s),c.size===0&&(this.#a.delete(i),this.disposeRequest(i)))}disownData(e){const s=e.collector,i=e.request;if(!this.#i.has(s))throw new n.NoSuchNetworkCollectorException(`Collector ${s} does not exist`);if(!this.#a.has(i))throw new n.NoSuchNetworkDataException(`No collected data for request ${i}`);const c=this.#a.get(i);if(!c.has(s))throw new n.NoSuchNetworkDataException(`No collected data for request ${i} and collector ${s}`);c.delete(s),c.size===0&&(this.#a.delete(i),this.disposeRequest(i))}};return lt.NetworkStorage=o,lt}var mt={},ti;function zn(){if(ti)return mt;ti=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.PreloadScriptStorage=void 0;const n=It();let t=class{#e=new Set;find(a){return a?[...this.#e].filter(r=>!!(r.contexts===void 0&&r.userContexts===void 0||a.targetId!==void 0&&r.targetIds.has(a.targetId))):[...this.#e]}add(a){this.#e.add(a)}remove(a){const r=[...this.#e].find(d=>d.id===a);if(r===void 0)throw new n.NoSuchScriptException(`No preload script with id '${a}'`);this.#e.delete(r)}getPreloadScript(a){const r=[...this.#e].find(d=>d.id===a);if(r===void 0)throw new n.NoSuchScriptException(`No preload script with id '${a}'`);return r}onCdpTargetCreated(a,r){const d=[...this.#e].filter(o=>!o.userContexts&&!o.contexts?!0:o.userContexts?.includes(r));for(const o of d)o.targetIds.add(a)}};return mt.PreloadScriptStorage=t,mt}var gt={},si;function _n(){if(si)return gt;si=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.RealmStorage=void 0;const n=j(),t=qr();let a=class{#e=new Map;#t=new Map;hiddenSandboxes=new Set;get knownHandlesToRealmMap(){return this.#e}addRealm(r){this.#t.set(r.realmId,r)}findRealms(r){return Array.from(this.#t.values()).filter(d=>!(r.realmId!==void 0&&r.realmId!==d.realmId||r.browsingContextId!==void 0&&!d.associatedBrowsingContexts.map(o=>o.id).includes(r.browsingContextId)||r.sandbox!==void 0&&(!(d instanceof t.WindowRealm)||r.sandbox!==d.sandbox)||r.executionContextId!==void 0&&r.executionContextId!==d.executionContextId||r.origin!==void 0&&r.origin!==d.origin||r.type!==void 0&&r.type!==d.realmType||r.cdpSessionId!==void 0&&r.cdpSessionId!==d.cdpClient.sessionId||r.isHidden!==void 0&&r.isHidden!==d.isHidden()))}findRealm(r){const d=this.findRealms(r);if(d.length===1)return d[0]}getRealm(r){const d=this.findRealm(r);if(d===void 0)throw new n.NoSuchFrameException(`Realm ${JSON.stringify(r)} not found`);return d}deleteRealms(r){this.findRealms(r).map(d=>{d.dispose(),this.#t.delete(d.realmId),Array.from(this.knownHandlesToRealmMap.entries()).filter(([,o])=>o===d.realmId).map(([o])=>this.knownHandlesToRealmMap.delete(o))})}};return gt.RealmStorage=a,gt}var ft={},wt={},ri;function Hn(){if(ri)return wt;ri=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.Buffer=void 0;class n{#e;#t=[];#s;constructor(a,r){this.#e=a,this.#s=r}get(){return this.#t}add(a){for(this.#t.push(a);this.#t.length>this.#e;){const r=this.#t.shift();r!==void 0&&this.#s?.(r)}}}return wt.Buffer=n,wt}var vt={},ii;function Kn(){if(ii)return vt;ii=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.IdWrapper=void 0;let n=class $i{static#e=0;#t;constructor(){this.#t=++$i.#e}get id(){return this.#t}};return vt.IdWrapper=n,vt}var yt={},ni;function Wn(){if(ni)return yt;ni=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.isCdpEvent=t,yt.assertSupportedEvent=a;const n=j();function t(r){return r.split(".").at(0)?.startsWith(n.ChromiumBidi.BiDiModule.Cdp)??!1}function a(r){if(!n.ChromiumBidi.EVENT_NAMES.has(r)&&!t(r))throw new n.InvalidArgumentException(`Unknown event: ${r}`)}return yt}var oe={},oi;function Vn(){if(oi)return oe;oi=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.SubscriptionManager=void 0,oe.cartesianProduct=a,oe.unrollEvents=r,oe.difference=e;const n=j(),t=fe();function a(...i){return i.reduce((c,l)=>c.flatMap(u=>l.map(h=>[u,h].flat())))}function r(i){const c=new Set;function l(u){for(const h of u)c.add(h)}for(const u of i)switch(u){case n.ChromiumBidi.BiDiModule.Bluetooth:l(Object.values(n.ChromiumBidi.Bluetooth.EventNames));break;case n.ChromiumBidi.BiDiModule.BrowsingContext:l(Object.values(n.ChromiumBidi.BrowsingContext.EventNames));break;case n.ChromiumBidi.BiDiModule.Input:l(Object.values(n.ChromiumBidi.Input.EventNames));break;case n.ChromiumBidi.BiDiModule.Log:l(Object.values(n.ChromiumBidi.Log.EventNames));break;case n.ChromiumBidi.BiDiModule.Network:l(Object.values(n.ChromiumBidi.Network.EventNames));break;case n.ChromiumBidi.BiDiModule.Script:l(Object.values(n.ChromiumBidi.Script.EventNames));break;default:c.add(u)}return c.values()}let d=class{#e=[];#t=new Set;#s;constructor(i){this.#s=i}getGoogChannelsSubscribedToEvent(i,c){const l=new Set;for(const u of this.#e)this.#r(u,i,c)&&l.add(u.googChannel);return Array.from(l)}getGoogChannelsSubscribedToEventGlobally(i){const c=new Set;for(const l of this.#e)this.#r(l,i)&&c.add(l.googChannel);return Array.from(c)}#r(i,c,l){let u=!1;for(const h of i.eventNames)if(h===c||h===c.split(".").at(0)||h.split(".").at(0)===c){u=!0;break}if(!u)return!1;if(i.userContextIds.size!==0){if(!l)return!1;const h=this.#s.findContext(l);return h?i.userContextIds.has(h.userContext):!1}if(i.topLevelTraversableIds.size!==0){if(!l)return!1;const h=this.#s.findTopLevelContextId(l);return h!==null&&i.topLevelTraversableIds.has(h)}return!0}isSubscribedTo(i,c){for(const l of this.#e)if(this.#r(l,i,c))return!0;return!1}subscribe(i,c,l,u){const h={id:(0,t.uuidv4)(),eventNames:new Set(r(i)),topLevelTraversableIds:new Set(c.map(f=>{const y=this.#s.findTopLevelContextId(f);if(!y)throw new n.NoSuchFrameException(`Top-level navigable not found for context id ${f}`);return y})),userContextIds:new Set(l),googChannel:u};return this.#e.push(h),this.#t.add(h.id),h}unsubscribe(i,c,l){const u=new Set(r(i));this.#s.verifyContextsList(c);const h=new Set(c.map(m=>{const p=this.#s.findTopLevelContextId(m);if(!p)throw new n.NoSuchFrameException(`Top-level navigable not found for context id ${m}`);return p})),f=h.size===0,y=[],g=new Set,w=new Set;for(const m of this.#e){if(m.googChannel!==l){y.push(m);continue}if(m.userContextIds.size!==0){y.push(m);continue}if(o(m.eventNames,u).size===0){y.push(m);continue}if(f){if(m.topLevelTraversableIds.size!==0){y.push(m);continue}const p=new Set(m.eventNames);for(const b of u)p.has(b)&&(g.add(b),p.delete(b));p.size!==0&&y.push({...m,eventNames:p})}else{if(m.topLevelTraversableIds.size===0){y.push(m);continue}const p=new Map;for(const b of m.eventNames)p.set(b,new Set(m.topLevelTraversableIds));for(const b of u){const E=p.get(b);if(E){for(const k of h)E.has(k)&&(w.add(k),g.add(b),E.delete(k));E.size===0&&p.delete(b)}}for(const[b,E]of p){const k={id:m.id,googChannel:m.googChannel,eventNames:new Set([b]),topLevelTraversableIds:E,userContextIds:new Set};y.push(k)}}}if(!s(g,u))throw new n.InvalidArgumentException("No subscription found");if(!f&&!s(w,h))throw new n.InvalidArgumentException("No subscription found");this.#e=y}unsubscribeById(i){const c=new Set(i);if(e(c,this.#t).size!==0)throw new n.InvalidArgumentException("No subscription found");this.#e=this.#e.filter(l=>!c.has(l.id)),this.#t=e(this.#t,c)}};oe.SubscriptionManager=d;function o(i,c){const l=new Set;for(const u of i)c.has(u)&&l.add(u);return l}function e(i,c){const l=new Set;for(const u of i)c.has(u)||l.add(u);return l}function s(i,c){if(i.size!==c.size)return!1;for(const l of i)if(!c.has(l))return!1;return!0}return oe}var ai;function Gn(){if(ai)return ft;ai=1;var n;Object.defineProperty(ft,"__esModule",{value:!0}),ft.EventManager=void 0;const t=j(),a=Hn(),r=Qr(),d=Oe(),o=Kn(),e=rs(),s=Wn(),i=Vn();class c{#e=new o.IdWrapper;#t;#s;constructor(f,y){this.#s=f,this.#t=y}get id(){return this.#e.id}get contextId(){return this.#t}get event(){return this.#s}}const l=new Map([[t.ChromiumBidi.Log.EventNames.LogEntryAdded,100]]);let u=class extends d.EventEmitter{#e=new r.DefaultMap(()=>new Set);#t=new Map;#s=new Map;#r;#n;#i;#a;constructor(h,f){super(),this.#n=h,this.#a=f,this.#r=new i.SubscriptionManager(h),this.#i=new r.DefaultMap(()=>[])}get subscriptionManager(){return this.#r}static#d(h,f){return JSON.stringify({eventName:h,browsingContext:f})}addSubscribeHook(h,f){this.#i.get(h).push(f)}registerEvent(h,f){this.registerPromiseEvent(Promise.resolve({kind:"success",value:h}),f,h.method)}registerGlobalEvent(h){this.registerGlobalPromiseEvent(Promise.resolve({kind:"success",value:h}),h.method)}registerPromiseEvent(h,f,y){const g=new c(h,f),w=this.#r.getGoogChannelsSubscribedToEvent(y,f);this.#o(g,y);for(const m of w)this.emit("event",{message:e.OutgoingMessage.createFromPromise(h,m),event:y}),this.#u(g,m,y)}registerGlobalPromiseEvent(h,f){const y=new c(h,null),g=this.#r.getGoogChannelsSubscribedToEventGlobally(f);this.#o(y,f);for(const w of g)this.emit("event",{message:e.OutgoingMessage.createFromPromise(h,w),event:f}),this.#u(y,w,f)}async subscribe(h,f,y,g){for(const E of h)(0,s.assertSupportedEvent)(E);if(y.length&&f.length)throw new t.InvalidArgumentException("Both userContexts and contexts cannot be specified.");this.#n.verifyContextsList(f),await this.#a.verifyUserContextIdList(y);const w=new Set((0,i.unrollEvents)(h)),m=new Map,p=new Set(f.length?f.map(E=>{const k=this.#n.findTopLevelContextId(E);if(!k)throw new t.InvalidArgumentException("Invalid context id");return k}):this.#n.getTopLevelContexts().map(E=>E.id));for(const E of w){const k=new Set(this.#n.getTopLevelContexts().map(C=>C.id).filter(C=>this.#r.isSubscribedTo(E,C)));m.set(E,(0,i.difference)(p,k))}const b=this.#r.subscribe(h,f,y,g);for(const E of b.eventNames)for(const k of p)for(const C of this.#l(E,k,g))this.emit("event",{message:e.OutgoingMessage.createFromPromise(C.event,g),event:E}),this.#u(C,g,E);for(const[E,k]of m)for(const C of k)this.#i.get(E).forEach(S=>S(C));return await this.toggleModulesIfNeeded(),b.id}async unsubscribe(h,f,y){for(const g of h)(0,s.assertSupportedEvent)(g);this.#r.unsubscribe(h,f,y),await this.toggleModulesIfNeeded()}async unsubscribeByIds(h){this.#r.unsubscribeById(h),await this.toggleModulesIfNeeded()}async toggleModulesIfNeeded(){await Promise.all(this.#n.getAllContexts().map(async h=>await h.toggleModulesIfNeeded()))}clearBufferedEvents(h){for(const f of l.keys()){const y=n.#d(f,h);this.#t.delete(y)}}#o(h,f){if(!l.has(f))return;const y=n.#d(f,h.contextId);this.#t.has(y)||this.#t.set(y,new a.Buffer(l.get(f))),this.#t.get(y).add(h),this.#e.get(f).add(h.contextId)}#u(h,f,y){if(!l.has(y))return;const g=n.#d(y,h.contextId),w=Math.max(this.#s.get(g)?.get(f)??0,h.id),m=this.#s.get(g);m?m.set(f,w):this.#s.set(g,new Map([[f,w]]))}#l(h,f,y){const g=n.#d(h,f),w=this.#s.get(g)?.get(y)??-1/0,m=this.#t.get(g)?.get().filter(p=>p.id>w)??[];return f===null&&Array.from(this.#e.get(h).keys()).filter(p=>p!==null&&this.#n.hasContext(p)).map(p=>this.#l(h,p,y)).forEach(p=>m.push(...p)),m.sort((p,b)=>p.id-b.id)}};return ft.EventManager=u,n=u,ft}var ci;function Xn(){if(ci)return Ne;ci=1,Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.BidiServer=void 0;const n=Oe(),t=G(),a=Zi(),r=In(),d=kn(),o=Nn(),e=On(),s=Un(),i=Ln(),c=$n(),l=zn(),u=_n(),h=Gn();let f=class zi extends n.EventEmitter{#e;#t;#s;#r;#n=new i.BrowsingContextStorage;#i=new u.RealmStorage;#a=new l.PreloadScriptStorage;#d;#o;#u=g=>{this.#s.processCommand(g).catch(w=>{this.#o?.(t.LogType.debugError,w)})};#l=async g=>{const w=g.message;g.googChannel!==null&&(w["goog:channel"]=g.googChannel),await this.#t.sendMessage(w)};constructor(g,w,m,p,b,E,k){super(),this.#o=k,this.#e=new a.ProcessingQueue(this.#l,this.#o),this.#t=g,this.#t.setOnMessage(this.#u);const C=new o.ContextConfigStorage,S=new e.UserContextStorage(m);this.#r=new h.EventManager(this.#n,S);const P=new c.NetworkStorage(this.#r,this.#n,m,k);this.#d=new d.BluetoothProcessor(this.#r,this.#n),this.#s=new r.CommandProcessor(w,m,this.#r,this.#n,this.#i,this.#a,P,C,this.#d,S,E,async T=>{await m.sendCommand("Security.setIgnoreCertificateErrors",{ignore:T.acceptInsecureCerts??!1}),C.updateGlobalConfig({acceptInsecureCerts:T.acceptInsecureCerts??!1,userPromptHandler:T.unhandledPromptBehavior,prerenderingDisabled:T?.["goog:prerenderingDisabled"]??!1}),new s.CdpTargetManager(w,m,p,this.#r,this.#n,this.#i,P,C,this.#d,this.#a,b,k),await m.sendCommand("Target.setDiscoverTargets",{discover:!0}),await m.sendCommand("Target.setAutoAttach",{autoAttach:!0,waitForDebuggerOnStart:!0,flatten:!0,filter:[{type:"page",exclude:!0},{}]}),await this.#h()},this.#o),this.#r.on("event",({message:T,event:D})=>{this.emitOutgoingMessage(T,D)}),this.#s.on("response",({message:T,event:D})=>{this.emitOutgoingMessage(T,D)})}static async createAndStart(g,w,m,p,b,E){const[{browserContextIds:k},{targetInfos:C}]=await Promise.all([m.sendCommand("Target.getBrowserContexts"),m.sendCommand("Target.getTargets"),m.sendCommand("Browser.setDownloadBehavior",{behavior:"default",eventsEnabled:!0})]);let S="default";for(const P of C)if(P.browserContextId&&!k.includes(P.browserContextId)){S=P.browserContextId;break}return new zi(g,w,m,p,S,b,E)}emitOutgoingMessage(g,w){this.#e.add(g,w)}close(){this.#t.close()}async#h(){await Promise.all(this.#n.getTopLevelContexts().map(g=>g.lifecycleLoaded()))}};return Ne.BidiServer=f,Ne}var di;function Jn(){return di||(di=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.OutgoingMessage=n.EventEmitter=n.BidiServer=void 0;var t=Xn();Object.defineProperty(n,"BidiServer",{enumerable:!0,get:function(){return t.BidiServer}});var a=Oe();Object.defineProperty(n,"EventEmitter",{enumerable:!0,get:function(){return a.EventEmitter}});var r=rs();Object.defineProperty(n,"OutgoingMessage",{enumerable:!0,get:function(){return r.OutgoingMessage}})})(As)),As}var is=Jn();class ae extends Zo{static sessions=new Map;#e=!1;#t;#s=Pi.create();frame;constructor(t,a){if(super(),this.frame=t,!this.frame.page().browser().cdpSupported)return;const r=this.frame.page().browser().connection;this.#t=r,a?(this.#s.resolve(a),ae.sessions.set(a,this)):(async()=>{try{const{result:d}=await r.send("goog:cdp.getSession",{context:t._id});this.#s.resolve(d.session),ae.sessions.set(d.session,this)}catch(d){this.#s.reject(d)}})(),ae.sessions.set(this.#s.value(),this)}connection(){}get detached(){return this.#e}async send(t,a,r){if(this.#t===void 0)throw new A("CDP support is required for this feature. The current browser does not support CDP.");if(this.#e)throw new ws(`Protocol error (${t}): Session closed. Most likely the page has been closed.`);const d=await this.#s.valueOrThrow(),{result:o}=await this.#t.send("goog:cdp.sendCommand",{method:t,params:a,session:d},r?.timeout);return o.result}async detach(){if(!(this.#t===void 0||this.#t.closed||this.#e))try{await this.frame.client.send("Target.detachFromTarget",{sessionId:this.id()})}finally{this.onClose()}}onClose=()=>{ae.sessions.delete(this.id()),this.#e=!0};id(){const t=this.#s.value();return typeof t=="string"?t:""}}const Yn=vs("puppeteer:webDriverBiDi:SEND \u25BA"),Qn=vs("puppeteer:webDriverBiDi:RECV \u25C0");xs=class extends M{#e;#t;#s;#r=0;#n=!1;#i=new ea;#a=[];constructor(n,t,a=0,r){super(),this.#e=n,this.#s=a,this.#r=r??18e4,this.#t=t,this.#t.onmessage=this.onMessage.bind(this),this.#t.onclose=this.unbind.bind(this)}get closed(){return this.#n}get url(){return this.#e}pipeTo(n){this.#a.push(n)}emit(n,t){for(const a of this.#a)a.emit(n,t);return super.emit(n,t)}send(n,t,a){return this.#n?Promise.reject(new ta("Connection closed.")):this.#i.create(n,a??this.#r,r=>{const d=JSON.stringify({id:r,method:n,params:t});Yn(d),this.#t.send(d)})}async onMessage(n){this.#s&&await new Promise(a=>setTimeout(a,this.#s)),Qn(n);const t=JSON.parse(n);if("type"in t)switch(t.type){case"success":this.#i.resolve(t.id,t);return;case"error":if(t.id===null)break;this.#i.reject(t.id,Zn(t),`${t.error}: ${t.message}`);return;case"event":if(eo(t)){ae.sessions.get(t.params.session)?.emit(t.params.event,t.params.params);return}this.emit(t.method,t.params);return}"id"in t&&this.#i.reject(t.id,`Protocol Error. Message is not in BiDi protocol format: '${n}'`,t.message),K(t)}unbind(){this.#n||(this.#n=!0,this.#t.onmessage=()=>{},this.#t.onclose=()=>{},this.#i.clear())}dispose(){this.unbind(),this.#t.close()}getPendingProtocolErrors(){return this.#i.getPendingProtocolErrors()}};function Zn(n){let t=`${n.error} ${n.message}`;return n.stacktrace&&(t+=` ${n.stacktrace}`),t}function eo(n){return n.method.startsWith("goog:cdp.")}const to=(n,...t)=>{vs(`bidi:${n}`)(t)};Ui=async function(n){const t=new ro,a=new so(n),r={send(e){t.emitMessage(JSON.parse(e))},close(){o.close(),a.close(),n.dispose()},onmessage(e){}};t.on("bidiResponse",e=>{r.onmessage(JSON.stringify(e))});const d=new xs(n.url(),r,n.delay,n.timeout),o=await is.BidiServer.createAndStart(t,a,a.browserClient(),"",void 0,to);return d};class so{#e;#t=new Map;#s;constructor(t){this.#e=t,this.#s=new ui(t)}browserClient(){return this.#s}getCdpClient(t){const a=this.#e.session(t);if(!a)throw new Error(`Unknown CDP session with id ${t}`);if(!this.#t.has(a)){const r=new ui(a,t,this.#s);return this.#t.set(a,r),r}return this.#t.get(a)}close(){this.#s.close();for(const t of this.#t.values())t.close()}}class ui extends is.EventEmitter{#e=!1;#t;sessionId=void 0;#s;constructor(t,a,r){super(),this.#t=t,this.sessionId=a,this.#s=r,this.#t.on("*",this.#r)}browserClient(){return this.#s}#r=(t,a)=>{this.emit(t,a)};async sendCommand(t,...a){if(!this.#e)try{return await this.#t.send(t,...a)}catch(r){if(this.#e)return;throw r}}close(){this.#t.off("*",this.#r),this.#e=!0}isCloseError(t){return t instanceof ws}}class ro extends is.EventEmitter{#e=async t=>{};emitMessage(t){this.#e(t)}setOnMessage(t){this.#e=t}async sendMessage(t){this.emit("bidiResponse",t)}close(){this.#e=async t=>{}}}var io=function(n,t,a){for(var r=arguments.length>2,d=0;d<t.length;d++)a=r?t[d].call(n,a):t[d].call(n);return r?a:void 0},no=function(n,t,a,r,d,o){function e(m){if(m!==void 0&&typeof m!="function")throw new TypeError("Function expected");return m}for(var s=r.kind,i=s==="getter"?"get":s==="setter"?"set":"value",c=!t&&n?r.static?n:n.prototype:null,l=t||(c?Object.getOwnPropertyDescriptor(c,r.name):{}),u,h=!1,f=a.length-1;f>=0;f--){var y={};for(var g in r)y[g]=g==="access"?{}:r[g];for(var g in r.access)y.access[g]=r.access[g];y.addInitializer=function(m){if(h)throw new TypeError("Cannot add initializers after decoration has completed");o.push(e(m||null))};var w=(0,a[f])(s==="accessor"?{get:l.get,set:l.set}:l[i],y);if(s==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(u=e(w.get))&&(l.get=u),(u=e(w.set))&&(l.set=u),(u=e(w.init))&&d.unshift(u)}else(u=e(w))&&(s==="field"?d.unshift(u):l[i]=u)}c&&Object.defineProperty(c,r.name,l),h=!0};let oo=(()=>{let n=M,t=[],a;return class Os extends n{static{const d=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;no(this,null,a,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:o=>"dispose"in o,get:o=>o.dispose},metadata:d},null,t),d&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:d})}static from(d){const o=new Os(d);return o.#i(),o}#e=io(this,t);#t;#s;#r=new ee;#n;constructor(d){super(),this.#s=d}#i(){const d=this.#r.use(new M(this.#s));d.once("closed",()=>{this.emit("failed",{url:this.#s.url,timestamp:new Date}),this.dispose()}),d.on("request",({request:e})=>{e.navigation===void 0||!this.#a(e.navigation)||(this.#e=e,this.emit("request",e),this.#r.use(new M(this.#e)).on("redirect",s=>{this.#e=s}))});const o=this.#r.use(new M(this.#d));o.on("browsingContext.navigationStarted",e=>{e.context!==this.#s.id||this.#t!==void 0||(this.#t=Os.from(this.#s))});for(const e of["browsingContext.domContentLoaded","browsingContext.load"])o.on(e,s=>{s.context!==this.#s.id||s.navigation===null||!this.#a(s.navigation)||this.dispose()});for(const[e,s]of[["browsingContext.fragmentNavigated","fragment"],["browsingContext.navigationFailed","failed"],["browsingContext.navigationAborted","aborted"]])o.on(e,i=>{i.context!==this.#s.id||!this.#a(i.navigation)||(this.emit(s,{url:i.url,timestamp:new Date(i.timestamp)}),this.dispose())})}#a(d){return this.#t!==void 0&&!this.#t.disposed?!1:this.#n===void 0?(this.#n=d,!0):this.#n===d}get#d(){return this.#s.userContext.browser.session}get disposed(){return this.#r.disposed}get request(){return this.#e}get navigation(){return this.#t}dispose(){this[$]()}[(a=[de],$)](){this.#r.dispose(),super[$]()}}})();var ao=function(n,t,a){for(var r=arguments.length>2,d=0;d<t.length;d++)a=r?t[d].call(n,a):t[d].call(n);return r?a:void 0},bt=function(n,t,a,r,d,o){function e(m){if(m!==void 0&&typeof m!="function")throw new TypeError("Function expected");return m}for(var s=r.kind,i=s==="getter"?"get":s==="setter"?"set":"value",c=!t&&n?r.static?n:n.prototype:null,l=t||(c?Object.getOwnPropertyDescriptor(c,r.name):{}),u,h=!1,f=a.length-1;f>=0;f--){var y={};for(var g in r)y[g]=g==="access"?{}:r[g];for(var g in r.access)y.access[g]=r.access[g];y.addInitializer=function(m){if(h)throw new TypeError("Cannot add initializers after decoration has completed");o.push(e(m||null))};var w=(0,a[f])(s==="accessor"?{get:l.get,set:l.set}:l[i],y);if(s==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(u=e(w.get))&&(l.get=u),(u=e(w.set))&&(l.set=u),(u=e(w.init))&&d.unshift(u)}else(u=e(w))&&(s==="field"?d.unshift(u):l[i]=u)}c&&Object.defineProperty(c,r.name,l),h=!0},ns;let os=(()=>{let n=M,t=[],a,r,d,o,e;return class extends n{static{const s=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;bt(this,null,a,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:i=>"dispose"in i,get:i=>i.dispose},metadata:s},null,t),bt(this,null,r,{kind:"method",name:"disown",static:!1,private:!1,access:{has:i=>"disown"in i,get:i=>i.disown},metadata:s},null,t),bt(this,null,d,{kind:"method",name:"callFunction",static:!1,private:!1,access:{has:i=>"callFunction"in i,get:i=>i.callFunction},metadata:s},null,t),bt(this,null,o,{kind:"method",name:"evaluate",static:!1,private:!1,access:{has:i=>"evaluate"in i,get:i=>i.evaluate},metadata:s},null,t),bt(this,null,e,{kind:"method",name:"resolveExecutionContextId",static:!1,private:!1,access:{has:i=>"resolveExecutionContextId"in i,get:i=>i.resolveExecutionContextId},metadata:s},null,t),s&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:s})}#e=ao(this,t);disposables=new ee;id;origin;executionContextId;constructor(s,i){super(),this.id=s,this.origin=i}get disposed(){return this.#e!==void 0}get target(){return{realm:this.id}}dispose(s){this.#e=s,this[$]()}async disown(s){await this.session.send("script.disown",{target:this.target,handles:s})}async callFunction(s,i,c={}){const{result:l}=await this.session.send("script.callFunction",{functionDeclaration:s,awaitPromise:i,target:this.target,...c});return l}async evaluate(s,i,c={}){const{result:l}=await this.session.send("script.evaluate",{expression:s,awaitPromise:i,target:this.target,...c});return l}async resolveExecutionContextId(){if(!this.executionContextId){const{result:s}=await this.session.connection.send("goog:cdp.resolveRealm",{realm:this.id});this.executionContextId=s.executionContextId}return this.executionContextId}[(a=[de],r=[R(s=>s.#e)],d=[R(s=>s.#e)],o=[R(s=>s.#e)],e=[R(s=>s.#e)],$)](){this.#e??="Realm already destroyed, probably because all associated browsing contexts closed.",this.emit("destroyed",{reason:this.#e}),this.disposables.dispose(),super[$]()}}})();class as extends os{static from(t,a){const r=new as(t,a);return r.#t(),r}browsingContext;sandbox;#e=new Map;constructor(t,a){super("",""),this.browsingContext=t,this.sandbox=a}#t(){this.disposables.use(new M(this.browsingContext)).on("closed",({reason:a})=>{this.dispose(a)});const t=this.disposables.use(new M(this.session));t.on("script.realmCreated",a=>{a.type!=="window"||a.context!==this.browsingContext.id||a.sandbox!==this.sandbox||(this.id=a.realm,this.origin=a.origin,this.executionContextId=void 0,this.emit("updated",this))}),t.on("script.realmCreated",a=>{if(a.type!=="dedicated-worker"||!a.owners.includes(this.id))return;const r=cs.from(this,a.realm,a.origin);this.#e.set(r.id,r);const d=this.disposables.use(new M(r));d.once("destroyed",()=>{d.removeAllListeners(),this.#e.delete(r.id)}),this.emit("worker",r)})}get session(){return this.browsingContext.userContext.browser.session}get target(){return{context:this.browsingContext.id,sandbox:this.sandbox}}}class cs extends os{static from(t,a,r){const d=new ns(t,a,r);return d.#t(),d}#e=new Map;owners;constructor(t,a,r){super(a,r),this.owners=new Set([t])}#t(){const t=this.disposables.use(new M(this.session));t.on("script.realmDestroyed",a=>{a.realm===this.id&&this.dispose("Realm already destroyed.")}),t.on("script.realmCreated",a=>{if(a.type!=="dedicated-worker"||!a.owners.includes(this.id))return;const r=ns.from(this,a.realm,a.origin);this.#e.set(r.id,r),this.disposables.use(new M(r)).once("destroyed",()=>{this.#e.delete(r.id)}),this.emit("worker",r)})}get session(){return this.owners.values().next().value.session}}ns=cs;class ds extends os{static from(t,a,r){const d=new ds(t,a,r);return d.#t(),d}#e=new Map;browser;constructor(t,a,r){super(a,r),this.browser=t}#t(){const t=this.disposables.use(new M(this.session));t.on("script.realmDestroyed",a=>{a.realm===this.id&&this.dispose("Realm already destroyed.")}),t.on("script.realmCreated",a=>{if(a.type!=="dedicated-worker"||!a.owners.includes(this.id))return;const r=cs.from(this,a.realm,a.origin);this.#e.set(r.id,r),this.disposables.use(new M(r)).once("destroyed",()=>{this.#e.delete(r.id)}),this.emit("worker",r)})}get session(){return this.browser.session}}var co=function(n,t,a){for(var r=arguments.length>2,d=0;d<t.length;d++)a=r?t[d].call(n,a):t[d].call(n);return r?a:void 0},uo=function(n,t,a,r,d,o){function e(m){if(m!==void 0&&typeof m!="function")throw new TypeError("Function expected");return m}for(var s=r.kind,i=s==="getter"?"get":s==="setter"?"set":"value",c=!t&&n?r.static?n:n.prototype:null,l=t||(c?Object.getOwnPropertyDescriptor(c,r.name):{}),u,h=!1,f=a.length-1;f>=0;f--){var y={};for(var g in r)y[g]=g==="access"?{}:r[g];for(var g in r.access)y.access[g]=r.access[g];y.addInitializer=function(m){if(h)throw new TypeError("Cannot add initializers after decoration has completed");o.push(e(m||null))};var w=(0,a[f])(s==="accessor"?{get:l.get,set:l.set}:l[i],y);if(s==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(u=e(w.get))&&(l.get=u),(u=e(w.set))&&(l.set=u),(u=e(w.init))&&d.unshift(u)}else(u=e(w))&&(s==="field"?d.unshift(u):l[i]=u)}c&&Object.defineProperty(c,r.name,l),h=!0};let lo=(()=>{let n=M,t=[],a;return class Ds extends n{static{const d=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;uo(this,null,a,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:o=>"dispose"in o,get:o=>o.dispose},metadata:d},null,t),d&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:d})}static from(d,o){const e=new Ds(d,o);return e.#d(),e}#e=(co(this,t),null);#t;#s;#r;#n;#i=new ee;#a;constructor(d,o){super(),this.#n=d,this.#a=o}#d(){this.#i.use(new M(this.#n)).once("closed",({reason:o})=>{this.#t=o,this.emit("error",this.#t),this.dispose()});const d=this.#i.use(new M(this.#o));d.on("network.beforeRequestSent",o=>{if(o.context!==this.#n.id||o.request.request!==this.id)return;const e=this.#a.request.headers.find(i=>i.name.toLowerCase()==="authorization"),s=o.request.headers.find(i=>i.name.toLowerCase()==="authorization")&&!e;o.redirectCount!==this.#a.redirectCount+1&&!s||(this.#s=Ds.from(this.#n,o),this.emit("redirect",this.#s),this.dispose())}),d.on("network.authRequired",o=>{o.context!==this.#n.id||o.request.request!==this.id||!o.isBlocked||this.emit("authenticate",void 0)}),d.on("network.fetchError",o=>{o.context!==this.#n.id||o.request.request!==this.id||this.#a.redirectCount!==o.redirectCount||(this.#t=o.errorText,this.emit("error",this.#t),this.dispose())}),d.on("network.responseCompleted",o=>{o.context!==this.#n.id||o.request.request!==this.id||this.#a.redirectCount!==o.redirectCount||(this.#r=o.response,this.#a.request.timings=o.request.timings,this.emit("success",this.#r),!(this.#r.status>=300&&this.#r.status<400)&&this.dispose())})}get#o(){return this.#n.userContext.browser.session}get disposed(){return this.#i.disposed}get error(){return this.#t}get headers(){return this.#a.request.headers}get id(){return this.#a.request.request}get initiator(){return this.#a.initiator}get method(){return this.#a.request.method}get navigation(){return this.#a.navigation??void 0}get redirect(){return this.#s}get lastRedirect(){let d=this.#s;for(;d;){if(d&&!d.#s)return d;d=d.#s}return d}get response(){return this.#r}get url(){return this.#a.request.url}get isBlocked(){return this.#a.isBlocked}get resourceType(){return this.#a.request["goog:resourceType"]??void 0}get postData(){return this.#a.request["goog:postData"]??void 0}get hasPostData(){return this.#a.request["goog:hasPostData"]??!1}async continueRequest({url:d,method:o,headers:e,cookies:s,body:i}){await this.#o.send("network.continueRequest",{request:this.id,url:d,method:o,headers:e,body:i,cookies:s})}async failRequest(){await this.#o.send("network.failRequest",{request:this.id})}async provideResponse({statusCode:d,reasonPhrase:o,headers:e,body:s}){await this.#o.send("network.provideResponse",{request:this.id,statusCode:d,reasonPhrase:o,headers:e,body:s})}async getResponseContent(){return this.#e||(this.#e=(async()=>{try{const d=await this.#o.send("network.getData",{dataType:"response",request:this.id});return Ii(d.result.bytes.value,d.result.bytes.type==="base64")}catch(d){throw d instanceof Lt&&d.originalMessage.includes("No resource with given identifier found")?new Lt("Could not load body for this request. This might happen if the request is a preflight request."):d}})()),await this.#e}async continueWithAuth(d){d.action==="provideCredentials"?await this.#o.send("network.continueWithAuth",{request:this.id,action:d.action,credentials:d.credentials}):await this.#o.send("network.continueWithAuth",{request:this.id,action:d.action})}dispose(){this[$]()}[(a=[de],$)](){this.#i.dispose(),super[$]()}timing(){return this.#a.request.timings}}})();var ho=function(n,t,a){for(var r=arguments.length>2,d=0;d<t.length;d++)a=r?t[d].call(n,a):t[d].call(n);return r?a:void 0},li=function(n,t,a,r,d,o){function e(m){if(m!==void 0&&typeof m!="function")throw new TypeError("Function expected");return m}for(var s=r.kind,i=s==="getter"?"get":s==="setter"?"set":"value",c=!t&&n?r.static?n:n.prototype:null,l=t||(c?Object.getOwnPropertyDescriptor(c,r.name):{}),u,h=!1,f=a.length-1;f>=0;f--){var y={};for(var g in r)y[g]=g==="access"?{}:r[g];for(var g in r.access)y.access[g]=r.access[g];y.addInitializer=function(m){if(h)throw new TypeError("Cannot add initializers after decoration has completed");o.push(e(m||null))};var w=(0,a[f])(s==="accessor"?{get:l.get,set:l.set}:l[i],y);if(s==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(u=e(w.get))&&(l.get=u),(u=e(w.set))&&(l.set=u),(u=e(w.init))&&d.unshift(u)}else(u=e(w))&&(s==="field"?d.unshift(u):l[i]=u)}c&&Object.defineProperty(c,r.name,l),h=!0};let po=(()=>{let n=M,t=[],a,r;return class _i extends n{static{const o=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;li(this,null,a,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:e=>"dispose"in e,get:e=>e.dispose},metadata:o},null,t),li(this,null,r,{kind:"method",name:"handle",static:!1,private:!1,access:{has:e=>"handle"in e,get:e=>e.handle},metadata:o},null,t),o&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:o})}static from(o,e){const s=new _i(o,e);return s.#r(),s}#e=ho(this,t);#t;#s=new ee;browsingContext;info;constructor(o,e){super(),this.browsingContext=o,this.info=e}#r(){this.#s.use(new M(this.browsingContext)).once("closed",({reason:o})=>{this.dispose(`User prompt already closed: ${o}`)}),this.#s.use(new M(this.#n)).on("browsingContext.userPromptClosed",o=>{o.context===this.browsingContext.id&&(this.#t=o,this.emit("handled",o),this.dispose("User prompt already handled."))})}get#n(){return this.browsingContext.userContext.browser.session}get closed(){return this.#e!==void 0}get disposed(){return this.closed}get handled(){return this.info.handler==="accept"||this.info.handler==="dismiss"?!0:this.#t!==void 0}get result(){return this.#t}dispose(o){this.#e=o,this[$]()}async handle(o={}){return await this.#n.send("browsingContext.handleUserPrompt",{...o,context:this.info.context}),this.#t}[(a=[de],r=[R(o=>o.#e)],$)](){this.#e??="User prompt already closed, probably because the associated browsing context was destroyed.",this.emit("closed",{reason:this.#e}),this.#s.dispose(),super[$]()}}})();var mo=function(n,t,a){for(var r=arguments.length>2,d=0;d<t.length;d++)a=r?t[d].call(n,a):t[d].call(n);return r?a:void 0},U=function(n,t,a,r,d,o){function e(m){if(m!==void 0&&typeof m!="function")throw new TypeError("Function expected");return m}for(var s=r.kind,i=s==="getter"?"get":s==="setter"?"set":"value",c=!t&&n?r.static?n:n.prototype:null,l=t||(c?Object.getOwnPropertyDescriptor(c,r.name):{}),u,h=!1,f=a.length-1;f>=0;f--){var y={};for(var g in r)y[g]=g==="access"?{}:r[g];for(var g in r.access)y.access[g]=r.access[g];y.addInitializer=function(m){if(h)throw new TypeError("Cannot add initializers after decoration has completed");o.push(e(m||null))};var w=(0,a[f])(s==="accessor"?{get:l.get,set:l.set}:l[i],y);if(s==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(u=e(w.get))&&(l.get=u),(u=e(w.set))&&(l.set=u),(u=e(w.init))&&d.unshift(u)}else(u=e(w))&&(s==="field"?d.unshift(u):l[i]=u)}c&&Object.defineProperty(c,r.name,l),h=!0};let go=(()=>{let n=M,t=[],a,r,d,o,e,s,i,c,l,u,h,f,y,g,w,m,p,b,E,k,C,S,P,T,D,F;return class Rs extends n{static{const x=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;D=[R(v=>v.#t)],F=[R(v=>v.#t)],U(this,null,a,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:v=>"dispose"in v,get:v=>v.dispose},metadata:x},null,t),U(this,null,r,{kind:"method",name:"activate",static:!1,private:!1,access:{has:v=>"activate"in v,get:v=>v.activate},metadata:x},null,t),U(this,null,d,{kind:"method",name:"captureScreenshot",static:!1,private:!1,access:{has:v=>"captureScreenshot"in v,get:v=>v.captureScreenshot},metadata:x},null,t),U(this,null,o,{kind:"method",name:"close",static:!1,private:!1,access:{has:v=>"close"in v,get:v=>v.close},metadata:x},null,t),U(this,null,e,{kind:"method",name:"traverseHistory",static:!1,private:!1,access:{has:v=>"traverseHistory"in v,get:v=>v.traverseHistory},metadata:x},null,t),U(this,null,s,{kind:"method",name:"navigate",static:!1,private:!1,access:{has:v=>"navigate"in v,get:v=>v.navigate},metadata:x},null,t),U(this,null,i,{kind:"method",name:"reload",static:!1,private:!1,access:{has:v=>"reload"in v,get:v=>v.reload},metadata:x},null,t),U(this,null,c,{kind:"method",name:"setCacheBehavior",static:!1,private:!1,access:{has:v=>"setCacheBehavior"in v,get:v=>v.setCacheBehavior},metadata:x},null,t),U(this,null,l,{kind:"method",name:"print",static:!1,private:!1,access:{has:v=>"print"in v,get:v=>v.print},metadata:x},null,t),U(this,null,u,{kind:"method",name:"handleUserPrompt",static:!1,private:!1,access:{has:v=>"handleUserPrompt"in v,get:v=>v.handleUserPrompt},metadata:x},null,t),U(this,null,h,{kind:"method",name:"setViewport",static:!1,private:!1,access:{has:v=>"setViewport"in v,get:v=>v.setViewport},metadata:x},null,t),U(this,null,f,{kind:"method",name:"performActions",static:!1,private:!1,access:{has:v=>"performActions"in v,get:v=>v.performActions},metadata:x},null,t),U(this,null,y,{kind:"method",name:"releaseActions",static:!1,private:!1,access:{has:v=>"releaseActions"in v,get:v=>v.releaseActions},metadata:x},null,t),U(this,null,g,{kind:"method",name:"createWindowRealm",static:!1,private:!1,access:{has:v=>"createWindowRealm"in v,get:v=>v.createWindowRealm},metadata:x},null,t),U(this,null,w,{kind:"method",name:"addPreloadScript",static:!1,private:!1,access:{has:v=>"addPreloadScript"in v,get:v=>v.addPreloadScript},metadata:x},null,t),U(this,null,m,{kind:"method",name:"addIntercept",static:!1,private:!1,access:{has:v=>"addIntercept"in v,get:v=>v.addIntercept},metadata:x},null,t),U(this,null,p,{kind:"method",name:"removePreloadScript",static:!1,private:!1,access:{has:v=>"removePreloadScript"in v,get:v=>v.removePreloadScript},metadata:x},null,t),U(this,null,b,{kind:"method",name:"setGeolocationOverride",static:!1,private:!1,access:{has:v=>"setGeolocationOverride"in v,get:v=>v.setGeolocationOverride},metadata:x},null,t),U(this,null,E,{kind:"method",name:"setTimezoneOverride",static:!1,private:!1,access:{has:v=>"setTimezoneOverride"in v,get:v=>v.setTimezoneOverride},metadata:x},null,t),U(this,null,k,{kind:"method",name:"getCookies",static:!1,private:!1,access:{has:v=>"getCookies"in v,get:v=>v.getCookies},metadata:x},null,t),U(this,null,C,{kind:"method",name:"setCookie",static:!1,private:!1,access:{has:v=>"setCookie"in v,get:v=>v.setCookie},metadata:x},null,t),U(this,null,S,{kind:"method",name:"setFiles",static:!1,private:!1,access:{has:v=>"setFiles"in v,get:v=>v.setFiles},metadata:x},null,t),U(this,null,P,{kind:"method",name:"subscribe",static:!1,private:!1,access:{has:v=>"subscribe"in v,get:v=>v.subscribe},metadata:x},null,t),U(this,null,T,{kind:"method",name:"addInterception",static:!1,private:!1,access:{has:v=>"addInterception"in v,get:v=>v.addInterception},metadata:x},null,t),U(this,null,D,{kind:"method",name:"deleteCookie",static:!1,private:!1,access:{has:v=>"deleteCookie"in v,get:v=>v.deleteCookie},metadata:x},null,t),U(this,null,F,{kind:"method",name:"locateNodes",static:!1,private:!1,access:{has:v=>"locateNodes"in v,get:v=>v.locateNodes},metadata:x},null,t),x&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:x})}static from(x,v,I,N,q){const H=new Rs(x,v,I,N,q);return H.#o(),H}#e=mo(this,t);#t;#s;#r=new Map;#n=new ee;#i=new Map;#a=new Map;defaultRealm;id;parent;userContext;originalOpener;#d={javaScriptEnabled:!0};constructor(x,v,I,N,q){super(),this.#s=N,this.id=I,this.parent=v,this.userContext=x,this.originalOpener=q,this.defaultRealm=this.#l()}#o(){this.#n.use(new M(this.userContext)).once("closed",({reason:v})=>{this.dispose(`Browsing context already closed: ${v}`)});const x=this.#n.use(new M(this.#u));x.on("input.fileDialogOpened",v=>{this.id===v.context&&this.emit("filedialogopened",v)}),x.on("browsingContext.contextCreated",v=>{if(v.parent!==this.id)return;const I=Rs.from(this.userContext,this,v.context,v.url,v.originalOpener);this.#r.set(v.context,I);const N=this.#n.use(new M(I));N.once("closed",()=>{N.removeAllListeners(),this.#r.delete(I.id)}),this.emit("browsingcontext",{browsingContext:I})}),x.on("browsingContext.contextDestroyed",v=>{v.context===this.id&&this.dispose("Browsing context already closed.")}),x.on("browsingContext.historyUpdated",v=>{v.context===this.id&&(this.#s=v.url,this.emit("historyUpdated",void 0))}),x.on("browsingContext.domContentLoaded",v=>{v.context===this.id&&(this.#s=v.url,this.emit("DOMContentLoaded",void 0))}),x.on("browsingContext.load",v=>{v.context===this.id&&(this.#s=v.url,this.emit("load",void 0))}),x.on("browsingContext.navigationStarted",v=>{if(v.context!==this.id)return;for(const[N,q]of this.#a)q.disposed&&this.#a.delete(N);if(this.#e!==void 0&&!this.#e.disposed)return;this.#e=oo.from(this);const I=this.#n.use(new M(this.#e));for(const N of["fragment","failed","aborted"])I.once(N,({url:q})=>{I[$](),this.#s=q});this.emit("navigation",{navigation:this.#e})}),x.on("network.beforeRequestSent",v=>{if(v.context!==this.id||this.#a.has(v.request.request))return;const I=lo.from(this,v);this.#a.set(I.id,I),this.emit("request",{request:I})}),x.on("log.entryAdded",v=>{v.source.context===this.id&&this.emit("log",{entry:v})}),x.on("browsingContext.userPromptOpened",v=>{if(v.context!==this.id)return;const I=po.from(this,v);this.emit("userprompt",{userPrompt:I})})}get#u(){return this.userContext.browser.session}get children(){return this.#r.values()}get closed(){return this.#t!==void 0}get disposed(){return this.closed}get realms(){const x=this;return(function*(){yield x.defaultRealm,yield*x.#i.values()})()}get top(){let x=this;for(let{parent:v}=x;v;{parent:v}=x)x=v;return x}get url(){return this.#s}#l(x){const v=as.from(this,x);return v.on("worker",I=>{this.emit("worker",{realm:I})}),v}dispose(x){this.#t=x;for(const v of this.#r.values())v.dispose("Parent browsing context was disposed");this[$]()}async activate(){await this.#u.send("browsingContext.activate",{context:this.id})}async captureScreenshot(x={}){const{result:{data:v}}=await this.#u.send("browsingContext.captureScreenshot",{context:this.id,...x});return v}async close(x){await Promise.all([...this.#r.values()].map(async v=>{await v.close(x)})),await this.#u.send("browsingContext.close",{context:this.id,promptUnload:x})}async traverseHistory(x){await this.#u.send("browsingContext.traverseHistory",{context:this.id,delta:x})}async navigate(x,v){await this.#u.send("browsingContext.navigate",{context:this.id,url:x,wait:v})}async reload(x={}){await this.#u.send("browsingContext.reload",{context:this.id,...x})}async setCacheBehavior(x){await this.#u.send("network.setCacheBehavior",{contexts:[this.id],cacheBehavior:x})}async print(x={}){const{result:{data:v}}=await this.#u.send("browsingContext.print",{context:this.id,...x});return v}async handleUserPrompt(x={}){await this.#u.send("browsingContext.handleUserPrompt",{context:this.id,...x})}async setViewport(x={}){await this.#u.send("browsingContext.setViewport",{context:this.id,...x})}async performActions(x){await this.#u.send("input.performActions",{context:this.id,actions:x})}async releaseActions(){await this.#u.send("input.releaseActions",{context:this.id})}createWindowRealm(x){return this.#l(x)}async addPreloadScript(x,v={}){return await this.userContext.browser.addPreloadScript(x,{...v,contexts:[this]})}async addIntercept(x){const{result:{intercept:v}}=await this.userContext.browser.session.send("network.addIntercept",{...x,contexts:[this.id]});return v}async removePreloadScript(x){await this.userContext.browser.removePreloadScript(x)}async setGeolocationOverride(x){if(!("coordinates"in x))throw new Error("Missing coordinates");await this.userContext.browser.session.send("emulation.setGeolocationOverride",{coordinates:x.coordinates,contexts:[this.id]})}async setTimezoneOverride(x){x?.startsWith("GMT")&&(x=x?.replace("GMT","")),await this.userContext.browser.session.send("emulation.setTimezoneOverride",{timezone:x??null,contexts:[this.id]})}async getCookies(x={}){const{result:{cookies:v}}=await this.#u.send("storage.getCookies",{...x,partition:{type:"context",context:this.id}});return v}async setCookie(x){await this.#u.send("storage.setCookie",{cookie:x,partition:{type:"context",context:this.id}})}async setFiles(x,v){await this.#u.send("input.setFiles",{context:this.id,element:x,files:v})}async subscribe(x){await this.#u.subscribe(x,[this.id])}async addInterception(x){await this.#u.subscribe(x,[this.id])}[(a=[de],r=[R(x=>x.#t)],d=[R(x=>x.#t)],o=[R(x=>x.#t)],e=[R(x=>x.#t)],s=[R(x=>x.#t)],i=[R(x=>x.#t)],c=[R(x=>x.#t)],l=[R(x=>x.#t)],u=[R(x=>x.#t)],h=[R(x=>x.#t)],f=[R(x=>x.#t)],y=[R(x=>x.#t)],g=[R(x=>x.#t)],w=[R(x=>x.#t)],m=[R(x=>x.#t)],p=[R(x=>x.#t)],b=[R(x=>x.#t)],E=[R(x=>x.#t)],k=[R(x=>x.#t)],C=[R(x=>x.#t)],S=[R(x=>x.#t)],P=[R(x=>x.#t)],T=[R(x=>x.#t)],$)](){this.#t??="Browsing context already closed, probably because the user context closed.",this.emit("closed",{reason:this.#t}),this.#n.dispose(),super[$]()}async deleteCookie(...x){await Promise.all(x.map(async v=>{await this.#u.send("storage.deleteCookies",{filter:v,partition:{type:"context",context:this.id}})}))}async locateNodes(x,v){return(await this.#u.send("browsingContext.locateNodes",{context:this.id,locator:x,startNodes:v.length?v:void 0})).result.nodes}async setJavaScriptEnabled(x){await this.userContext.browser.session.send("emulation.setScriptingEnabled",{enabled:x?null:!1,contexts:[this.id]}),this.#d.javaScriptEnabled=x}isJavaScriptEnabled(){return this.#d.javaScriptEnabled}}})();var fo=function(n,t,a){for(var r=arguments.length>2,d=0;d<t.length;d++)a=r?t[d].call(n,a):t[d].call(n);return r?a:void 0},Ie=function(n,t,a,r,d,o){function e(m){if(m!==void 0&&typeof m!="function")throw new TypeError("Function expected");return m}for(var s=r.kind,i=s==="getter"?"get":s==="setter"?"set":"value",c=!t&&n?r.static?n:n.prototype:null,l=t||(c?Object.getOwnPropertyDescriptor(c,r.name):{}),u,h=!1,f=a.length-1;f>=0;f--){var y={};for(var g in r)y[g]=g==="access"?{}:r[g];for(var g in r.access)y.access[g]=r.access[g];y.addInitializer=function(m){if(h)throw new TypeError("Cannot add initializers after decoration has completed");o.push(e(m||null))};var w=(0,a[f])(s==="accessor"?{get:l.get,set:l.set}:l[i],y);if(s==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(u=e(w.get))&&(l.get=u),(u=e(w.set))&&(l.set=u),(u=e(w.init))&&d.unshift(u)}else(u=e(w))&&(s==="field"?d.unshift(u):l[i]=u)}c&&Object.defineProperty(c,r.name,l),h=!0};let Bt=(()=>{let n=M,t=[],a,r,d,o,e,s;return class Hi extends n{static{const c=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;Ie(this,null,a,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:l=>"dispose"in l,get:l=>l.dispose},metadata:c},null,t),Ie(this,null,r,{kind:"method",name:"createBrowsingContext",static:!1,private:!1,access:{has:l=>"createBrowsingContext"in l,get:l=>l.createBrowsingContext},metadata:c},null,t),Ie(this,null,d,{kind:"method",name:"remove",static:!1,private:!1,access:{has:l=>"remove"in l,get:l=>l.remove},metadata:c},null,t),Ie(this,null,o,{kind:"method",name:"getCookies",static:!1,private:!1,access:{has:l=>"getCookies"in l,get:l=>l.getCookies},metadata:c},null,t),Ie(this,null,e,{kind:"method",name:"setCookie",static:!1,private:!1,access:{has:l=>"setCookie"in l,get:l=>l.setCookie},metadata:c},null,t),Ie(this,null,s,{kind:"method",name:"setPermissions",static:!1,private:!1,access:{has:l=>"setPermissions"in l,get:l=>l.setPermissions},metadata:c},null,t),c&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:c})}static DEFAULT="default";static create(c,l){const u=new Hi(c,l);return u.#n(),u}#e=fo(this,t);#t=new Map;#s=new ee;#r;browser;constructor(c,l){super(),this.#r=l,this.browser=c}#n(){const c=this.#s.use(new M(this.browser));c.once("closed",({reason:l})=>{this.dispose(`User context was closed: ${l}`)}),c.once("disconnected",({reason:l})=>{this.dispose(`User context was closed: ${l}`)}),this.#s.use(new M(this.#i)).on("browsingContext.contextCreated",l=>{if(l.parent||l.userContext!==this.#r)return;const u=go.from(this,void 0,l.context,l.url,l.originalOpener);this.#t.set(u.id,u);const h=this.#s.use(new M(u));h.on("closed",()=>{h.removeAllListeners(),this.#t.delete(u.id)}),this.emit("browsingcontext",{browsingContext:u})})}get#i(){return this.browser.session}get browsingContexts(){return this.#t.values()}get closed(){return this.#e!==void 0}get disposed(){return this.closed}get id(){return this.#r}dispose(c){this.#e=c,this[$]()}async createBrowsingContext(c,l={}){const{result:{context:u}}=await this.#i.send("browsingContext.create",{type:c,...l,referenceContext:l.referenceContext?.id,userContext:this.#r}),h=this.#t.get(u);return X(h,"The WebDriver BiDi implementation is failing to create a browsing context correctly."),h}async remove(){try{await this.#i.send("browser.removeUserContext",{userContext:this.#r})}finally{this.dispose("User context already closed.")}}async getCookies(c={},l=void 0){const{result:{cookies:u}}=await this.#i.send("storage.getCookies",{...c,partition:{type:"storageKey",userContext:this.#r,sourceOrigin:l}});return u}async setCookie(c,l){await this.#i.send("storage.setCookie",{cookie:c,partition:{type:"storageKey",sourceOrigin:l,userContext:this.id}})}async setPermissions(c,l,u){await this.#i.send("permissions.setPermission",{origin:c,descriptor:l,state:u,userContext:this.#r})}[(a=[de],r=[R(c=>c.#e)],d=[R(c=>c.#e)],o=[R(c=>c.#e)],e=[R(c=>c.#e)],s=[R(c=>c.#e)],$)](){this.#e??="User context already closed, probably because the browser disconnected/closed.",this.emit("closed",{reason:this.#e}),this.#s.dispose(),super[$]()}}})();class jt{static deserialize(t){if(!t){K("Service did not produce a result.");return}switch(t.type){case"array":return t.value?.map(a=>this.deserialize(a));case"set":return t.value?.reduce((a,r)=>a.add(this.deserialize(r)),new Set);case"object":return t.value?.reduce((a,r)=>{const{key:d,value:o}=this.#t(r);return a[d]=o,a},{});case"map":return t.value?.reduce((a,r)=>{const{key:d,value:o}=this.#t(r);return a.set(d,o)},new Map);case"promise":return{};case"regexp":return new RegExp(t.value.pattern,t.value.flags);case"date":return new Date(t.value);case"undefined":return;case"null":return null;case"number":return this.#e(t.value);case"bigint":return BigInt(t.value);case"boolean":return!!t.value;case"string":return t.value}K(`Deserialization of type ${t.type} not supported.`)}static#e(t){switch(t){case"-0":return-0;case"NaN":return NaN;case"Infinity":return 1/0;case"-Infinity":return-1/0;default:return t}}static#t([t,a]){const r=typeof t=="string"?t:this.deserialize(t),d=this.deserialize(a);return{key:r,value:d}}}pe=class extends sa{static from(n,t){return new pe(n,t)}#e;realm;#t=!1;constructor(n,t){super(),this.#e=n,this.realm=t}get disposed(){return this.#t}async jsonValue(){return await this.evaluate(n=>n)}asElement(){return null}async dispose(){this.#t||(this.#t=!0,await this.realm.destroyHandles([this]))}get isPrimitiveValue(){switch(this.#e.type){case"string":case"number":case"bigint":case"boolean":case"undefined":case"null":return!0;default:return!1}}toString(){return this.isPrimitiveValue?"JSHandle:"+jt.deserialize(this.#e):"JSHandle@"+this.#e.type}get id(){return"handle"in this.#e?this.#e.handle:void 0}remoteValue(){return this.#e}remoteObject(){throw new A("Not available in WebDriver BiDi")}};var wo=function(n,t,a){for(var r=arguments.length>2,d=0;d<t.length;d++)a=r?t[d].call(n,a):t[d].call(n);return r?a:void 0},hi=function(n,t,a,r,d,o){function e(m){if(m!==void 0&&typeof m!="function")throw new TypeError("Function expected");return m}for(var s=r.kind,i=s==="getter"?"get":s==="setter"?"set":"value",c=!t&&n?r.static?n:n.prototype:null,l=t||(c?Object.getOwnPropertyDescriptor(c,r.name):{}),u,h=!1,f=a.length-1;f>=0;f--){var y={};for(var g in r)y[g]=g==="access"?{}:r[g];for(var g in r.access)y.access[g]=r.access[g];y.addInitializer=function(m){if(h)throw new TypeError("Cannot add initializers after decoration has completed");o.push(e(m||null))};var w=(0,a[f])(s==="accessor"?{get:l.get,set:l.set}:l[i],y);if(s==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(u=e(w.get))&&(l.get=u),(u=e(w.set))&&(l.set=u),(u=e(w.init))&&d.unshift(u)}else(u=e(w))&&(s==="field"?d.unshift(u):l[i]=u)}c&&Object.defineProperty(c,r.name,l),h=!0},vo=function(n,t,a){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var r,d;if(a){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=t[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=t[Symbol.dispose],a&&(d=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");d&&(r=function(){try{d.call(this)}catch(o){return Promise.reject(o)}}),n.stack.push({value:t,dispose:r,async:a})}else a&&n.stack.push({async:!0});return t},yo=(function(n){return function(t){function a(e){t.error=t.hasError?new n(e,t.error,"An error was suppressed during disposal."):e,t.hasError=!0}var r,d=0;function o(){for(;r=t.stack.pop();)try{if(!r.async&&d===1)return d=0,t.stack.push(r),Promise.resolve().then(o);if(r.dispose){var e=r.dispose.call(r.value);if(r.async)return d|=2,Promise.resolve(e).then(o,function(s){return a(s),o()})}else d|=1}catch(s){a(s)}if(d===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return o()}})(typeof SuppressedError=="function"?SuppressedError:function(n,t,a){var r=new Error(a);return r.name="SuppressedError",r.error=n,r.suppressed=t,r});xe=(()=>{let n=ra,t=[],a,r;return class Fs extends n{static{const o=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;a=[R()],r=[R(),na],hi(this,null,a,{kind:"method",name:"autofill",static:!1,private:!1,access:{has:e=>"autofill"in e,get:e=>e.autofill},metadata:o},null,t),hi(this,null,r,{kind:"method",name:"contentFrame",static:!1,private:!1,access:{has:e=>"contentFrame"in e,get:e=>e.contentFrame},metadata:o},null,t),o&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:o})}#e=wo(this,t);static from(o,e){return new Fs(o,e)}constructor(o,e){super(pe.from(o,e))}get realm(){return this.handle.realm}get frame(){return this.realm.environment}remoteValue(){return this.handle.remoteValue()}async autofill(o){const e=this.frame.client,s=(await e.send("DOM.describeNode",{objectId:this.handle.id})).node.backendNodeId,i=this.frame._id;await e.send("Autofill.trigger",{fieldId:s,frameId:i,card:o.creditCard})}async contentFrame(){const o={stack:[],error:void 0,hasError:!1};try{const e=vo(o,await this.evaluateHandle(s=>{if(s instanceof HTMLIFrameElement||s instanceof HTMLFrameElement)return s.contentWindow}),!1).remoteValue();return e.type==="window"?this.frame.page().frames().find(s=>s._id===e.value.context)??null:null}catch(e){o.error=e,o.hasError=!0}finally{yo(o)}}async uploadFile(...o){const e=ia.value.path;e&&(o=o.map(s=>e.win32.isAbsolute(s)||e.posix.isAbsolute(s)?s:e.resolve(s))),await this.frame.setFiles(this,o)}async*queryAXTree(o,e){const s=await this.frame.locateNodes(this,{type:"accessibility",value:{role:e,name:o}});return yield*ki.map(s,i=>Promise.resolve(Fs.from(i,this.realm)))}async backendNodeId(){if(!this.frame.page().browser().cdpSupported)throw new A;if(this.#e)return this.#e;const{node:o}=await this.frame.client.send("DOM.describeNode",{objectId:this.handle.id});return this.#e=o.backendNodeId,this.#e}}})();class us extends oa{static from(t){return new us(t)}#e;constructor(t){super(t.info.type,t.info.message,t.info.defaultValue),this.#e=t,this.handled=t.handled}async handle(t){await this.#e.handle({accept:t.accept,userText:t.text})}}var ls=function(n,t,a){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var r,d;if(a){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=t[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=t[Symbol.dispose],a&&(d=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");d&&(r=function(){try{d.call(this)}catch(o){return Promise.reject(o)}}),n.stack.push({value:t,dispose:r,async:a})}else a&&n.stack.push({async:!0});return t},pi=(function(n){return function(t){function a(e){t.error=t.hasError?new n(e,t.error,"An error was suppressed during disposal."):e,t.hasError=!0}var r,d=0;function o(){for(;r=t.stack.pop();)try{if(!r.async&&d===1)return d=0,t.stack.push(r),Promise.resolve().then(o);if(r.dispose){var e=r.dispose.call(r.value);if(r.async)return d|=2,Promise.resolve(e).then(o,function(s){return a(s),o()})}else d|=1}catch(s){a(s)}if(d===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return o()}})(typeof SuppressedError=="function"?SuppressedError:function(n,t,a){var r=new Error(a);return r.name="SuppressedError",r.error=n,r.suppressed=t,r});class xt{static async from(t,a,r,d=!1){const o=new xt(t,a,r,d);return await o.#a(),o}#e;name;#t;#s;#r;#n=[];#i=new ee;constructor(t,a,r,d=!1){this.#e=t,this.name=a,this.#t=r,this.#s=d,this.#r=`__puppeteer__${this.#e._id}_page_exposeFunction_${this.name}`}async#a(){const t=this.#d,a={type:"channel",value:{channel:this.#r,ownership:"root"}};this.#i.use(new M(t)).on("script.message",this.#o);const r=Ti(aa(o=>{Object.assign(globalThis,{[PLACEHOLDER("name")]:function(...e){return new Promise((s,i)=>{o([s,i,e])})}})},{name:JSON.stringify(this.name)})),d=[this.#e];for(const o of d)d.push(...o.childFrames());await Promise.all(d.map(async o=>{const e=this.#s?o.isolatedRealm():o.mainRealm();try{const[s]=await Promise.all([o.browsingContext.addPreloadScript(r,{arguments:[a],sandbox:e.sandbox}),e.realm.callFunction(r,!1,{arguments:[a]})]);this.#n.push([o,s])}catch(s){K(s)}}))}get#d(){return this.#e.page().browser().connection}#o=async t=>{const a={stack:[],error:void 0,hasError:!1};try{if(t.channel!==this.#r)return;const r=this.#u(t.source);if(!r)return;const d=ls(a,pe.from(t.data,r),!1),o=ls(a,new ee,!1),e=[];let s;try{const i={stack:[],error:void 0,hasError:!1};try{const c=ls(i,await d.evaluateHandle(([,,l])=>l),!1);for(const[l,u]of await c.getProperties()){if(o.use(u),u instanceof xe){e[+l]=u,o.use(u);continue}e[+l]=u.jsonValue()}s=await this.#t(...await Promise.all(e))}catch(c){i.error=c,i.hasError=!0}finally{pi(i)}}catch(i){try{i instanceof Error?await d.evaluate(([,c],l,u,h)=>{const f=new Error(u);f.name=l,h&&(f.stack=h),c(f)},i.name,i.message,i.stack):await d.evaluate(([,c],l)=>{c(l)},i)}catch(c){K(c)}return}try{await d.evaluate(([i],c)=>{i(c)},s)}catch(i){K(i)}}catch(r){a.error=r,a.hasError=!0}finally{pi(a)}};#u(t){const a=this.#l(t.context);if(a)return a.realm(t.realm)}#l(t){const a=[this.#e];for(const r of a){if(r._id===t)return r;a.push(...r.childFrames())}}[Symbol.dispose](){this[Symbol.asyncDispose]().catch(K)}async[Symbol.asyncDispose](){this.#i.dispose(),await Promise.all(this.#n.map(async([t,a])=>{const r=this.#s?t.isolatedRealm():t.mainRealm();try{await Promise.all([r.evaluate(d=>{delete globalThis[d]},this.name),...t.childFrames().map(d=>d.evaluate(o=>{delete globalThis[o]},this.name)),t.browsingContext.removePreloadScript(a)])}catch(d){K(d)}}))}}var bo=function(n,t,a){for(var r=arguments.length>2,d=0;d<t.length;d++)a=r?t[d].call(n,a):t[d].call(n);return r?a:void 0},xo=function(n,t,a,r,d,o){function e(m){if(m!==void 0&&typeof m!="function")throw new TypeError("Function expected");return m}for(var s=r.kind,i=s==="getter"?"get":s==="setter"?"set":"value",c=!t&&n?r.static?n:n.prototype:null,l=t||(c?Object.getOwnPropertyDescriptor(c,r.name):{}),u,h=!1,f=a.length-1;f>=0;f--){var y={};for(var g in r)y[g]=g==="access"?{}:r[g];for(var g in r.access)y.access[g]=r.access[g];y.addInitializer=function(m){if(h)throw new TypeError("Cannot add initializers after decoration has completed");o.push(e(m||null))};var w=(0,a[f])(s==="accessor"?{get:l.get,set:l.set}:l[i],y);if(s==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(u=e(w.get))&&(l.get=u),(u=e(w.set))&&(l.set=u),(u=e(w.init))&&d.unshift(u)}else(u=e(w))&&(s==="field"?d.unshift(u):l[i]=u)}c&&Object.defineProperty(c,r.name,l),h=!0};Es=(()=>{let n=da,t=[],a;return class Ki extends n{static{const d=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;a=[ua],xo(this,null,a,{kind:"method",name:"remoteAddress",static:!1,private:!1,access:{has:o=>"remoteAddress"in o,get:o=>o.remoteAddress},metadata:d},null,t),d&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:d})}static from(d,o,e){const s=new Ki(d,o,e);return s.#n(),s}#e=bo(this,t);#t;#s;#r=!1;constructor(d,o,e){super(),this.#e=d,this.#t=o,this.#r=e;const s=d["goog:securityDetails"];e&&s&&(this.#s=new ca(s))}#n(){this.#e.fromCache&&(this.#t._fromMemoryCache=!0,this.#t.frame()?.page().trustedEmitter.emit("requestservedfromcache",this.#t)),this.#t.frame()?.page().trustedEmitter.emit("response",this)}remoteAddress(){return{ip:"",port:-1}}url(){return this.#e.url}status(){return this.#e.status}statusText(){return this.#e.statusText}headers(){const d={};for(const o of this.#e.headers)o.value.type==="string"&&(d[o.name.toLowerCase()]=o.value.value);return d}request(){return this.#t}fromCache(){return this.#e.fromCache}timing(){const d=this.#t.timing();return{requestTime:d.requestTime,proxyStart:-1,proxyEnd:-1,dnsStart:d.dnsStart,dnsEnd:d.dnsEnd,connectStart:d.connectStart,connectEnd:d.connectEnd,sslStart:d.tlsStart,sslEnd:-1,workerStart:-1,workerReady:-1,workerFetchStart:-1,workerRespondWithSettled:-1,workerRouterEvaluationStart:-1,workerCacheLookupStart:-1,sendStart:d.requestStart,sendEnd:-1,pushStart:-1,pushEnd:-1,receiveHeadersStart:d.responseStart,receiveHeadersEnd:d.responseEnd}}frame(){return this.#t.frame()}fromServiceWorker(){return!1}securityDetails(){if(!this.#r)throw new A;return this.#s??null}async content(){return await this.#t.getResponseContent()}}})();var hs;es=new WeakMap,Vt=class extends Ni{static from(n,t,a){const r=new hs(n,t,a);return r.#n(),r}#e;#t=null;id;#s;#r;constructor(n,t,a){super(),es.set(n,this),this.interception.enabled=n.isBlocked,this.#r=n,this.#s=t,this.#e=a?a.#e:[],this.id=n.id}get client(){return this.#s.client}#n(){this.#r.on("redirect",n=>{const t=hs.from(n,this.#s,this);this.#e.push(this),n.once("success",()=>{this.#s.page().trustedEmitter.emit("requestfinished",t)}),n.once("error",()=>{this.#s.page().trustedEmitter.emit("requestfailed",t)}),t.finalizeInterceptions()}),this.#r.once("success",n=>{this.#t=Es.from(n,this,this.#s.page().browser().cdpSupported)}),this.#r.on("authenticate",this.#u),this.#s.page().trustedEmitter.emit("request",this),this.#i&&this.interception.handlers.push(async()=>{await this.continue({headers:this.headers()},0)})}url(){return this.#r.url}resourceType(){if(!this.#s.page().browser().cdpSupported)throw new A;return(this.#r.resourceType||"other").toLowerCase()}method(){return this.#r.method}postData(){if(!this.#s.page().browser().cdpSupported)throw new A;return this.#r.postData}hasPostData(){if(!this.#s.page().browser().cdpSupported)throw new A;return this.#r.hasPostData}async fetchPostData(){throw new A}get#i(){return!!(Object.keys(this.#a).length||Object.keys(this.#d).length)}get#a(){return this.#s?.page()._extraHTTPHeaders??{}}get#d(){return this.#s?.page()._userAgentHeaders??{}}headers(){const n={};for(const t of this.#r.headers)n[t.name.toLowerCase()]=t.value.value;return{...n,...this.#a,...this.#d}}response(){return this.#t}failure(){return this.#r.error===void 0?null:{errorText:this.#r.error}}isNavigationRequest(){return this.#r.navigation!==void 0}initiator(){return{...this.#r.initiator,type:this.#r.initiator?.type??"other"}}redirectChain(){return this.#e.slice()}frame(){return this.#s}async continue(n,t){return await super.continue({headers:this.#i?this.headers():void 0,...n},t)}async _continue(n={}){const t=mi(n.headers);return this.interception.handled=!0,await this.#r.continueRequest({url:n.url,method:n.method,body:n.postData?{type:"base64",value:la(n.postData)}:void 0,headers:t.length>0?t:void 0}).catch(a=>(this.interception.handled=!1,ha(a)))}async _abort(){return this.interception.handled=!0,await this.#r.failRequest().catch(n=>{throw this.interception.handled=!1,n})}async _respond(n,t){this.interception.handled=!0;let a;n.body&&(a=Ni.getResponse(n.body));const r=mi(n.headers),d=r.some(e=>e.name==="content-length");n.contentType&&r.push({name:"content-type",value:{type:"string",value:n.contentType}}),a?.contentLength&&!d&&r.push({name:"content-length",value:{type:"string",value:String(a.contentLength)}});const o=n.status||200;return await this.#r.provideResponse({statusCode:o,headers:r.length>0?r:void 0,reasonPhrase:pa[o],body:a?.base64?{type:"base64",value:a?.base64}:void 0}).catch(e=>{throw this.interception.handled=!1,e})}#o=!1;#u=async()=>{if(!this.#s)return;const n=this.#s.page()._credentials;n&&!this.#o?(this.#o=!0,this.#r.continueWithAuth({action:"provideCredentials",credentials:{type:"password",username:n.username,password:n.password}})):this.#r.continueWithAuth({action:"cancel"})};timing(){return this.#r.timing()}getResponseContent(){return this.#r.getResponseContent()}},hs=Vt;function mi(n){const t=[];for(const[a,r]of Object.entries(n??[]))if(!Object.is(r,void 0)){const d=Array.isArray(r)?r:[r];for(const o of d)t.push({name:a.toLowerCase(),value:{type:"string",value:String(o)}})}return t}class gi extends Error{}class Co{static serialize(t){switch(typeof t){case"symbol":case"function":throw new gi(`Unable to serializable ${typeof t}`);case"object":return this.#t(t);case"undefined":return{type:"undefined"};case"number":return this.#e(t);case"bigint":return{type:"bigint",value:t.toString()};case"string":return{type:"string",value:t};case"boolean":return{type:"boolean",value:t}}}static#e(t){let a;return Object.is(t,-0)?a="-0":Object.is(t,1/0)?a="Infinity":Object.is(t,-1/0)?a="-Infinity":Object.is(t,NaN)?a="NaN":a=t,{type:"number",value:a}}static#t(t){if(t===null)return{type:"null"};if(Array.isArray(t))return{type:"array",value:t.map(a=>this.serialize(a))};if(ma(t)){try{JSON.stringify(t)}catch(r){throw r instanceof TypeError&&r.message.startsWith("Converting circular structure to JSON")&&(r.message+=" Recursive objects are not allowed."),r}const a=[];for(const r in t)a.push([this.serialize(r),this.serialize(t[r])]);return{type:"object",value:a}}else{if(ga(t))return{type:"regexp",value:{pattern:t.source,flags:t.flags}};if(fa(t))return{type:"date",value:t.toISOString()}}throw new gi("Custom object serialization not possible. Use plain objects instead.")}}function Eo(n){if(n.exception.type!=="error")return jt.deserialize(n.exception);const[t="",...a]=n.text.split(": "),r=a.join(": "),d=new Error(r);d.name=t;const o=[];if(n.stackTrace&&o.length<Error.stackTraceLimit)for(const e of n.stackTrace.callFrames.reverse()){if(qt.isPuppeteerURL(e.url)&&e.url!==qt.INTERNAL_URL){const s=qt.parse(e.url);o.unshift(`    at ${e.functionName||s.functionName} (${s.functionName} at ${s.siteString}, <anonymous>:${e.lineNumber}:${e.columnNumber})`)}else o.push(`    at ${e.functionName||"<anonymous>"} (${e.url}:${e.lineNumber}:${e.columnNumber})`);if(o.length>=Error.stackTraceLimit)break}return d.stack=[n.text,...o].join(`
`),d}function fi(n,t){return a=>{throw a instanceof Lt?a.message+=` at ${n}`:a instanceof wa&&(a.message=`Navigation timeout of ${t} ms exceeded`),a}}var So=function(n,t,a){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var r,d;if(a){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=t[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=t[Symbol.dispose],a&&(d=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");d&&(r=function(){try{d.call(this)}catch(o){return Promise.reject(o)}}),n.stack.push({value:t,dispose:r,async:a})}else a&&n.stack.push({async:!0});return t},Po=(function(n){return function(t){function a(e){t.error=t.hasError?new n(e,t.error,"An error was suppressed during disposal."):e,t.hasError=!0}var r,d=0;function o(){for(;r=t.stack.pop();)try{if(!r.async&&d===1)return d=0,t.stack.push(r),Promise.resolve().then(o);if(r.dispose){var e=r.dispose.call(r.value);if(r.async)return d|=2,Promise.resolve(e).then(o,function(s){return a(s),o()})}else d|=1}catch(s){a(s)}if(d===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return o()}})(typeof SuppressedError=="function"?SuppressedError:function(n,t,a){var r=new Error(a);return r.name="SuppressedError",r.error=n,r.suppressed=t,r});Gt=class extends va{realm;constructor(n,t){super(t),this.realm=n}initialize(){this.realm.on("destroyed",({reason:n})=>{this.taskManager.terminateAll(new Error(n)),this.dispose()}),this.realm.on("updated",()=>{this.internalPuppeteerUtil=void 0,this.taskManager.rerunAll()})}internalPuppeteerUtil;get puppeteerUtil(){const n=Promise.resolve();return ya.inject(t=>{this.internalPuppeteerUtil&&this.internalPuppeteerUtil.then(a=>{a.dispose()}),this.internalPuppeteerUtil=n.then(()=>this.evaluateHandle(t))},!this.internalPuppeteerUtil),this.internalPuppeteerUtil}async evaluateHandle(n,...t){return await this.#e(!1,n,...t)}async evaluate(n,...t){return await this.#e(!0,n,...t)}async#e(n,t,...a){const r=ba(xa(t)?.toString()??qt.INTERNAL_URL);let d;const o=n?"none":"root",e=n?{}:{maxObjectDepth:0,maxDomDepth:0};if(Oi(t)){const i=Fi.test(t)?t:`${t}
${r}
`;d=this.realm.evaluate(i,!0,{resultOwnership:o,userActivation:!0,serializationOptions:e})}else{let i=Ti(t);i=Fi.test(i)?i:`${i}
${r}
`,d=this.realm.callFunction(i,!0,{arguments:a.some(c=>c instanceof Di)?await Promise.all(a.map(c=>this.serializeAsync(c))):a.map(c=>this.serialize(c)),resultOwnership:o,userActivation:!0,serializationOptions:e})}const s=await d;if("type"in s&&s.type==="exception")throw Eo(s.exceptionDetails);return n?jt.deserialize(s.result):this.createHandle(s.result)}createHandle(n){return(n.type==="node"||n.type==="window")&&this instanceof he?xe.from(n,this):pe.from(n,this)}async serializeAsync(n){return n instanceof Di&&(n=await n.get(this)),this.serialize(n)}serialize(n){if(n instanceof pe||n instanceof xe){if(n.realm!==this){if(!(n.realm instanceof he)||!(this instanceof he))throw new Error("Trying to evaluate JSHandle from different global types. Usually this means you're using a handle from a worker in a page or vice versa.");if(n.realm.environment!==this.environment)throw new Error("Trying to evaluate JSHandle from different frames. Usually this means you're using a handle from a page on a different page.")}if(n.disposed)throw new Error("JSHandle is disposed!");return n.remoteValue()}return Co.serialize(n)}async destroyHandles(n){if(this.disposed)return;const t=n.map(({id:a})=>a).filter(a=>a!==void 0);t.length!==0&&await this.realm.disown(t).catch(a=>{K(a)})}async adoptHandle(n){return await this.evaluateHandle(t=>t,n)}async transferHandle(n){if(n.realm===this)return n;const t=this.adoptHandle(n);return await n.dispose(),await t}},he=class extends Gt{static from(n,t){const a=new he(n,t);return a.#t(),a}#e;constructor(n,t){super(n,t.timeoutSettings),this.#e=t}#t(){super.initialize(),this.realm.on("updated",()=>{this.environment.clearDocumentHandle(),this.#s=!1})}#s=!1;get puppeteerUtil(){let n=Promise.resolve();return this.#s||(n=Promise.all([xt.from(this.environment,"__ariaQuerySelector",Ri.queryOne,!!this.sandbox),xt.from(this.environment,"__ariaQuerySelectorAll",async(t,a)=>{const r=Ri.queryAll(t,a);return await t.realm.evaluateHandle((...d)=>d,...await ki.collect(r))},!!this.sandbox)]),this.#s=!0),n.then(()=>super.puppeteerUtil)}get sandbox(){return this.realm.sandbox}get environment(){return this.#e}async adoptBackendNode(n){const t={stack:[],error:void 0,hasError:!1};try{const{object:a}=await this.#e.client.send("DOM.resolveNode",{backendNodeId:n,executionContextId:await this.realm.resolveExecutionContextId()});return await So(t,xe.from({handle:a.objectId,type:"node"},this),!1).evaluateHandle(r=>r)}catch(a){t.error=a,t.hasError=!0}finally{Po(t)}}},Xt=class extends Gt{static from(n,t){const a=new Xt(n,t);return a.initialize(),a}#e;constructor(n,t){super(n,t.timeoutSettings),this.#e=t}get environment(){return this.#e}async adoptBackendNode(){throw new Error("Cannot adopt DOM nodes into a worker.")}};class ps extends Ca{static from(t,a){return new ps(t,a)}#e;#t;constructor(t,a){super(a.origin),this.#e=t,this.#t=Xt.from(a,this)}get frame(){return this.#e}mainRealm(){return this.#t}get client(){throw new A}}var Io=function(n,t,a){for(var r=arguments.length>2,d=0;d<t.length;d++)a=r?t[d].call(n,a):t[d].call(n);return r?a:void 0},we=function(n,t,a,r,d,o){function e(m){if(m!==void 0&&typeof m!="function")throw new TypeError("Function expected");return m}for(var s=r.kind,i=s==="getter"?"get":s==="setter"?"set":"value",c=!t&&n?r.static?n:n.prototype:null,l=t||(c?Object.getOwnPropertyDescriptor(c,r.name):{}),u,h=!1,f=a.length-1;f>=0;f--){var y={};for(var g in r)y[g]=g==="access"?{}:r[g];for(var g in r.access)y.access[g]=r.access[g];y.addInitializer=function(m){if(h)throw new TypeError("Cannot add initializers after decoration has completed");o.push(e(m||null))};var w=(0,a[f])(s==="accessor"?{get:l.get,set:l.set}:l[i],y);if(s==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(u=e(w.get))&&(l.get=u),(u=e(w.set))&&(l.set=u),(u=e(w.init))&&d.unshift(u)}else(u=e(w))&&(s==="field"?d.unshift(u):l[i]=u)}c&&Object.defineProperty(c,r.name,l),h=!0},wi=function(n,t,a){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:a?"".concat(a," ",t):t})};function ko(n){switch(n){case"group":return"startGroup";case"groupCollapsed":return"startGroupCollapsed";case"groupEnd":return"endGroup";default:return n}}Cs=(()=>{let n=Ea,t=[],a,r,d,o,e,s,i,c,l;return class St extends n{static{const h=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;a=[be],r=[be],d=[be],o=[be],s=[be],c=[be],l=[be],we(this,null,a,{kind:"method",name:"goto",static:!1,private:!1,access:{has:f=>"goto"in f,get:f=>f.goto},metadata:h},null,t),we(this,null,r,{kind:"method",name:"setContent",static:!1,private:!1,access:{has:f=>"setContent"in f,get:f=>f.setContent},metadata:h},null,t),we(this,null,d,{kind:"method",name:"waitForNavigation",static:!1,private:!1,access:{has:f=>"waitForNavigation"in f,get:f=>f.waitForNavigation},metadata:h},null,t),we(this,e={value:wi(function(f={}){let{waitUntil:y="load"}=f;const{timeout:g=this.timeoutSettings.navigationTimeout()}=f;Array.isArray(y)||(y=[y]);const w=new Set;for(const m of y)switch(m){case"load":{w.add("load");break}case"domcontentloaded":{w.add("DOMContentLoaded");break}}return w.size===0?ue(void 0):$t([...w].map(m=>te(this.browsingContext,m))).pipe(Et(()=>{}),Ai(),ye(zt(g),this.#n().pipe(Et(()=>{throw new Error("Frame detached.")}))))},"#waitForLoad$")},o,{kind:"method",name:"#waitForLoad$",static:!1,private:!0,access:{has:f=>#a in f,get:f=>f.#a},metadata:h},null,t),we(this,i={value:wi(function(f={}){let{waitUntil:y="load"}=f;Array.isArray(y)||(y=[y]);let g=1/0;for(const w of y)switch(w){case"networkidle0":{g=Math.min(0,g);break}case"networkidle2":{g=Math.min(2,g);break}}return g===1/0?ue(void 0):this.page().waitForNetworkIdle$({idleTime:500,timeout:f.timeout??this.timeoutSettings.timeout(),concurrency:g})},"#waitForNetworkIdle$")},s,{kind:"method",name:"#waitForNetworkIdle$",static:!1,private:!0,access:{has:f=>#d in f,get:f=>f.#d},metadata:h},null,t),we(this,null,c,{kind:"method",name:"setFiles",static:!1,private:!1,access:{has:f=>"setFiles"in f,get:f=>f.setFiles},metadata:h},null,t),we(this,null,l,{kind:"method",name:"locateNodes",static:!1,private:!1,access:{has:f=>"locateNodes"in f,get:f=>f.locateNodes},metadata:h},null,t),h&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:h})}static from(h,f){const y=new St(h,f);return y.#s(),y}#e=Io(this,t);browsingContext;#t=new WeakMap;realms;_id;client;accessibility;constructor(h,f){super(),this.#e=h,this.browsingContext=f,this._id=f.id,this.client=new ae(this),this.realms={default:he.from(this.browsingContext.defaultRealm,this),internal:he.from(this.browsingContext.createWindowRealm(`__puppeteer_internal_${Math.ceil(Math.random()*1e4)}`),this)},this.accessibility=new Sa(this.realms.default,this._id)}#s(){for(const h of this.browsingContext.children)this.#r(h);this.browsingContext.on("browsingcontext",({browsingContext:h})=>{this.#r(h)}),this.browsingContext.on("closed",()=>{for(const h of ae.sessions.values())h.frame===this&&h.onClose();this.page().trustedEmitter.emit("framedetached",this)}),this.browsingContext.on("request",({request:h})=>{const f=Vt.from(h,this);h.once("success",()=>{this.page().trustedEmitter.emit("requestfinished",f)}),h.once("error",()=>{this.page().trustedEmitter.emit("requestfailed",f)}),f.finalizeInterceptions()}),this.browsingContext.on("navigation",({navigation:h})=>{h.once("fragment",()=>{this.page().trustedEmitter.emit("framenavigated",this)})}),this.browsingContext.on("load",()=>{this.page().trustedEmitter.emit("load",void 0)}),this.browsingContext.on("DOMContentLoaded",()=>{this._hasStartedLoading=!0,this.page().trustedEmitter.emit("domcontentloaded",void 0),this.page().trustedEmitter.emit("framenavigated",this)}),this.browsingContext.on("userprompt",({userPrompt:h})=>{this.page().trustedEmitter.emit("dialog",us.from(h))}),this.browsingContext.on("log",({entry:h})=>{if(this._id===h.source.context)if(To(h)){const f=h.args.map(g=>this.mainRealm().createHandle(g)),y=f.reduce((g,w)=>{const m=w instanceof pe&&w.isPrimitiveValue?jt.deserialize(w.remoteValue()):w.toString();return`${g} ${m}`},"").slice(1);this.page().trustedEmitter.emit("console",new Pa(ko(h.method),y,f,Oo(h.stackTrace),this))}else if(No(h)){const f=new Error(h.text??""),y=f.message.split(`
`).length,g=f.stack.split(`
`).splice(0,y),w=[];if(h.stackTrace){for(const m of h.stackTrace.callFrames)if(w.push(`    at ${m.functionName||"<anonymous>"} (${m.url}:${m.lineNumber+1}:${m.columnNumber+1})`),w.length>=Error.stackTraceLimit)break}f.stack=[...g,...w].join(`
`),this.page().trustedEmitter.emit("pageerror",f)}else K(`Unhandled LogEntry with type "${h.type}", text "${h.text}" and level "${h.level}"`)}),this.browsingContext.on("worker",({realm:h})=>{const f=ps.from(this,h);h.on("destroyed",()=>{this.page().trustedEmitter.emit("workerdestroyed",f)}),this.page().trustedEmitter.emit("workercreated",f)})}#r(h){const f=St.from(this,h);return this.#t.set(h,f),this.page().trustedEmitter.emit("frameattached",f),h.on("closed",()=>{this.#t.delete(h)}),f}get timeoutSettings(){return this.page()._timeoutSettings}mainRealm(){return this.realms.default}isolatedRealm(){return this.realms.internal}realm(h){for(const f of Object.values(this.realms))if(f.realm.id===h)return f}page(){let h=this.#e;for(;h instanceof St;)h=h.#e;return h}url(){return this.browsingContext.url}parentFrame(){return this.#e instanceof St?this.#e:null}childFrames(){return[...this.browsingContext.children].map(h=>this.#t.get(h))}#n(){return Ia(()=>this.detached?ue(this):te(this.page().trustedEmitter,"framedetached").pipe(ka(h=>h===this)))}async goto(h,f={}){const[y]=await Promise.all([this.waitForNavigation(f),this.browsingContext.navigate(h,"interactive").catch(g=>{if(!(Ta(g)&&g.message.includes("net::ERR_HTTP_RESPONSE_CODE_FAILURE"))&&!g.message.includes("navigation canceled")&&!g.message.includes("Navigation was aborted by another navigation"))throw g})]).catch(fi(h,f.timeout??this.timeoutSettings.navigationTimeout()));return y}async setContent(h,f={}){await Promise.all([this.setFrameContent(h),_t($t([this.#a(f),this.#d(f)]))])}async waitForNavigation(h={}){const{timeout:f=this.timeoutSettings.navigationTimeout(),signal:y}=h,g=this.childFrames().map(w=>w.#n());return await _t($t([Na(te(this.browsingContext,"navigation"),te(this.browsingContext,"historyUpdated").pipe(Et(()=>({navigation:null})))).pipe(Ai()).pipe(ys(({navigation:w})=>w===null?ue(null):this.#a(h).pipe(Oa(()=>g.length===0?ue(void 0):$t(g)),ye(te(w,"fragment"),te(w,"failed"),te(w,"aborted")),ys(()=>{if(w.request){let m=function(p){return w===null?ue(null):p.response||p.error?ue(w):p.redirect?m(p.redirect):te(p,"success").pipe(ye(te(p,"error")),ye(te(p,"redirect"))).pipe(ys(()=>m(p)))};return m(w.request)}return ue(w)})))),this.#d(h)]).pipe(Et(([w])=>{if(!w)return null;const m=w.request;if(!m)return null;const p=m.lastRedirect??m;return es.get(p).response()}),ye(zt(f),Da(y),this.#n().pipe(Et(()=>{throw new ws("Frame detached.")})))))}waitForDevicePrompt(){throw new A}get detached(){return this.browsingContext.closed}#i=new Map;async exposeFunction(h,f){if(this.#i.has(h))throw new Error(`Failed to add page binding with name ${h}: globalThis['${h}'] already exists!`);const y=await xt.from(this,h,f);this.#i.set(h,y)}async removeExposedFunction(h){const f=this.#i.get(h);if(!f)throw new Error(`Failed to remove page binding with name ${h}: window['${h}'] does not exists!`);this.#i.delete(h),await f[Symbol.asyncDispose]()}async createCDPSession(){if(!this.page().browser().cdpSupported)throw new A;return await this.page().browser().cdpConnection._createSession({targetId:this._id})}get#a(){return e.value}get#d(){return i.value}async setFiles(h,f){await this.browsingContext.setFiles(h.remoteValue(),f)}async locateNodes(h,f){return await this.browsingContext.locateNodes(f,[h.remoteValue()])}}})();function To(n){return n.type==="console"}function No(n){return n.type==="javascript"}function Oo(n){const t=[];if(n)for(const a of n.callFrames)t.push({url:a.url,lineNumber:a.lineNumber,columnNumber:a.columnNumber});return t}var W;(function(n){n.None="none",n.Key="key",n.Pointer="pointer",n.Wheel="wheel"})(W||(W={}));var L;(function(n){n.Pause="pause",n.KeyDown="keyDown",n.KeyUp="keyUp",n.PointerUp="pointerUp",n.PointerDown="pointerDown",n.PointerMove="pointerMove",n.Scroll="scroll"})(L||(L={}));const Ct=n=>{switch(n){case"\r":case`
`:n="Enter";break}if([...n].length===1)return n;switch(n){case"Cancel":return"\uE001";case"Help":return"\uE002";case"Backspace":return"\uE003";case"Tab":return"\uE004";case"Clear":return"\uE005";case"Enter":return"\uE007";case"Shift":case"ShiftLeft":return"\uE008";case"Control":case"ControlLeft":return"\uE009";case"Alt":case"AltLeft":return"\uE00A";case"Pause":return"\uE00B";case"Escape":return"\uE00C";case"PageUp":return"\uE00E";case"PageDown":return"\uE00F";case"End":return"\uE010";case"Home":return"\uE011";case"ArrowLeft":return"\uE012";case"ArrowUp":return"\uE013";case"ArrowRight":return"\uE014";case"ArrowDown":return"\uE015";case"Insert":return"\uE016";case"Delete":return"\uE017";case"NumpadEqual":return"\uE019";case"Numpad0":return"\uE01A";case"Numpad1":return"\uE01B";case"Numpad2":return"\uE01C";case"Numpad3":return"\uE01D";case"Numpad4":return"\uE01E";case"Numpad5":return"\uE01F";case"Numpad6":return"\uE020";case"Numpad7":return"\uE021";case"Numpad8":return"\uE022";case"Numpad9":return"\uE023";case"NumpadMultiply":return"\uE024";case"NumpadAdd":return"\uE025";case"NumpadSubtract":return"\uE027";case"NumpadDecimal":return"\uE028";case"NumpadDivide":return"\uE029";case"F1":return"\uE031";case"F2":return"\uE032";case"F3":return"\uE033";case"F4":return"\uE034";case"F5":return"\uE035";case"F6":return"\uE036";case"F7":return"\uE037";case"F8":return"\uE038";case"F9":return"\uE039";case"F10":return"\uE03A";case"F11":return"\uE03B";case"F12":return"\uE03C";case"Meta":case"MetaLeft":return"\uE03D";case"ShiftRight":return"\uE050";case"ControlRight":return"\uE051";case"AltRight":return"\uE052";case"MetaRight":return"\uE053";case"Digit0":return"0";case"Digit1":return"1";case"Digit2":return"2";case"Digit3":return"3";case"Digit4":return"4";case"Digit5":return"5";case"Digit6":return"6";case"Digit7":return"7";case"Digit8":return"8";case"Digit9":return"9";case"KeyA":return"a";case"KeyB":return"b";case"KeyC":return"c";case"KeyD":return"d";case"KeyE":return"e";case"KeyF":return"f";case"KeyG":return"g";case"KeyH":return"h";case"KeyI":return"i";case"KeyJ":return"j";case"KeyK":return"k";case"KeyL":return"l";case"KeyM":return"m";case"KeyN":return"n";case"KeyO":return"o";case"KeyP":return"p";case"KeyQ":return"q";case"KeyR":return"r";case"KeyS":return"s";case"KeyT":return"t";case"KeyU":return"u";case"KeyV":return"v";case"KeyW":return"w";case"KeyX":return"x";case"KeyY":return"y";case"KeyZ":return"z";case"Semicolon":return";";case"Equal":return"=";case"Comma":return",";case"Minus":return"-";case"Period":return".";case"Slash":return"/";case"Backquote":return"`";case"BracketLeft":return"[";case"Backslash":return"\\";case"BracketRight":return"]";case"Quote":return'"';default:throw new Error(`Unknown key: "${n}"`)}};Ss=class extends Ra{#e;constructor(n){super(),this.#e=n}async down(n,t){await this.#e.mainFrame().browsingContext.performActions([{type:W.Key,id:"__puppeteer_keyboard",actions:[{type:L.KeyDown,value:Ct(n)}]}])}async up(n){await this.#e.mainFrame().browsingContext.performActions([{type:W.Key,id:"__puppeteer_keyboard",actions:[{type:L.KeyUp,value:Ct(n)}]}])}async press(n,t={}){const{delay:a=0}=t,r=[{type:L.KeyDown,value:Ct(n)}];a>0&&r.push({type:L.Pause,duration:a}),r.push({type:L.KeyUp,value:Ct(n)}),await this.#e.mainFrame().browsingContext.performActions([{type:W.Key,id:"__puppeteer_keyboard",actions:r}])}async type(n,t={}){const{delay:a=0}=t,r=[...n].map(Ct),d=[];if(a<=0)for(const o of r)d.push({type:L.KeyDown,value:o},{type:L.KeyUp,value:o});else for(const o of r)d.push({type:L.KeyDown,value:o},{type:L.Pause,duration:a},{type:L.KeyUp,value:o});await this.#e.mainFrame().browsingContext.performActions([{type:W.Key,id:"__puppeteer_keyboard",actions:d}])}async sendCharacter(n){if([...n].length>1)throw new Error("Cannot send more than 1 character.");await(await this.#e.focusedFrame()).isolatedRealm().evaluate(async t=>{document.execCommand("insertText",!1,t)},n)}};const ms=n=>{switch(n){case le.Left:return 0;case le.Middle:return 1;case le.Right:return 2;case le.Back:return 3;case le.Forward:return 4}};Ps=class extends Fa{#e;#t={x:0,y:0};constructor(n){super(),this.#e=n}async reset(){this.#t={x:0,y:0},await this.#e.mainFrame().browsingContext.releaseActions()}async move(n,t,a={}){const r=this.#t,d={x:Math.round(n),y:Math.round(t)},o=[],e=a.steps??0;for(let s=0;s<e;++s)o.push({type:L.PointerMove,x:r.x+(d.x-r.x)*(s/e),y:r.y+(d.y-r.y)*(s/e),origin:a.origin});o.push({type:L.PointerMove,...d,origin:a.origin}),this.#t=d,await this.#e.mainFrame().browsingContext.performActions([{type:W.Pointer,id:"__puppeteer_mouse",actions:o}])}async down(n={}){await this.#e.mainFrame().browsingContext.performActions([{type:W.Pointer,id:"__puppeteer_mouse",actions:[{type:L.PointerDown,button:ms(n.button??le.Left)}]}])}async up(n={}){await this.#e.mainFrame().browsingContext.performActions([{type:W.Pointer,id:"__puppeteer_mouse",actions:[{type:L.PointerUp,button:ms(n.button??le.Left)}]}])}async click(n,t,a={}){const r=[{type:L.PointerMove,x:Math.round(n),y:Math.round(t),origin:a.origin}],d={type:L.PointerDown,button:ms(a.button??le.Left)},o={type:L.PointerUp,button:d.button};for(let e=1;e<(a.count??1);++e)r.push(d,o);r.push(d),a.delay&&r.push({type:L.Pause,duration:a.delay}),r.push(o),await this.#e.mainFrame().browsingContext.performActions([{type:W.Pointer,id:"__puppeteer_mouse",actions:r}])}async wheel(n={}){await this.#e.mainFrame().browsingContext.performActions([{type:W.Wheel,id:"__puppeteer_wheel",actions:[{type:L.Scroll,...this.#t??{x:0,y:0},deltaX:n.deltaX??0,deltaY:n.deltaY??0}]}])}drag(){throw new A}dragOver(){throw new A}dragEnter(){throw new A}drop(){throw new A}dragAndDrop(){throw new A}};class Do{#e=!1;#t;#s;#r;#n;#i;#a;constructor(t,a,r,d,o,e){this.#n=t,this.#i=a,this.#t=Math.round(d),this.#s=Math.round(o),this.#a=e,this.#r=`__puppeteer_finger_${r}`}async start(t={}){if(this.#e)throw new Ma("Touch has already started");await this.#n.mainFrame().browsingContext.performActions([{type:W.Pointer,id:this.#r,parameters:{pointerType:"touch"},actions:[{type:L.PointerMove,x:this.#t,y:this.#s,origin:t.origin},{...this.#a,type:L.PointerDown,button:0}]}]),this.#e=!0}move(t,a){const r=Math.round(t),d=Math.round(a);return this.#n.mainFrame().browsingContext.performActions([{type:W.Pointer,id:this.#r,parameters:{pointerType:"touch"},actions:[{...this.#a,type:L.PointerMove,x:r,y:d}]}])}async end(){await this.#n.mainFrame().browsingContext.performActions([{type:W.Pointer,id:this.#r,parameters:{pointerType:"touch"},actions:[{type:L.PointerUp,button:0}]}]),this.#i.removeHandle(this)}}Is=class extends Aa{#e;constructor(n){super(),this.#e=n}async touchStart(n,t,a={}){const r=this.idGenerator(),d={width:.5*2,height:.5*2,pressure:.5,altitudeAngle:Math.PI/2},o=new Do(this.#e,this,r,n,t,d);return await o.start(a),this.touches.push(o),o}};var Ro=function(n,t,a,r,d,o){function e(m){if(m!==void 0&&typeof m!="function")throw new TypeError("Function expected");return m}for(var s=r.kind,i=s==="getter"?"get":s==="setter"?"set":"value",c=!t&&n?r.static?n:n.prototype:null,l=t||(c?Object.getOwnPropertyDescriptor(c,r.name):{}),u,h=!1,f=a.length-1;f>=0;f--){var y={};for(var g in r)y[g]=g==="access"?{}:r[g];for(var g in r.access)y.access[g]=r.access[g];y.addInitializer=function(m){if(h)throw new TypeError("Cannot add initializers after decoration has completed");o.push(e(m||null))};var w=(0,a[f])(s==="accessor"?{get:l.get,set:l.set}:l[i],y);if(s==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(u=e(w.get))&&(l.get=u),(u=e(w.set))&&(l.set=u),(u=e(w.init))&&d.unshift(u)}else(u=e(w))&&(s==="field"?d.unshift(u):l[i]=u)}c&&Object.defineProperty(c,r.name,l),h=!0},vi=function(n,t,a){for(var r=arguments.length>2,d=0;d<t.length;d++)a=r?t[d].call(n,a):t[d].call(n);return r?a:void 0},yi=function(n,t,a){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var r,d;if(a){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=t[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=t[Symbol.dispose],a&&(d=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");d&&(r=function(){try{d.call(this)}catch(o){return Promise.reject(o)}}),n.stack.push({value:t,dispose:r,async:a})}else a&&n.stack.push({async:!0});return t},bi=(function(n){return function(t){function a(e){t.error=t.hasError?new n(e,t.error,"An error was suppressed during disposal."):e,t.hasError=!0}var r,d=0;function o(){for(;r=t.stack.pop();)try{if(!r.async&&d===1)return d=0,t.stack.push(r),Promise.resolve().then(o);if(r.dispose){var e=r.dispose.call(r.value);if(r.async)return d|=2,Promise.resolve(e).then(o,function(s){return a(s),o()})}else d|=1}catch(s){a(s)}if(d===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return o()}})(typeof SuppressedError=="function"?SuppressedError:function(n,t,a){var r=new Error(a);return r.name="SuppressedError",r.error=n,r.suppressed=t,r});Te=(()=>{let n=Ba,t,a=[],r=[];return class Wi extends n{static{const o=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;t=[Ht()],Ro(this,null,t,{kind:"accessor",name:"trustedEmitter",static:!1,private:!1,access:{has:e=>"trustedEmitter"in e,get:e=>e.trustedEmitter,set:(e,s)=>{e.trustedEmitter=s}},metadata:o},a,r),o&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:o})}static from(o,e){const s=new Wi(o,e);return s.#o(),s}#e=vi(this,a,new M);get trustedEmitter(){return this.#e}set trustedEmitter(o){this.#e=o}#t=vi(this,r);#s;#r=null;#n=new Set;keyboard;mouse;touchscreen;tracing;coverage;#i;#a;#d=new Set;_client(){return this.#s.client}constructor(o,e){super(),this.#t=o,this.#s=Cs.from(this,e),this.#i=new ja(this.#s.client),this.tracing=new Ua(this.#s.client),this.coverage=new La(this.#s.client),this.keyboard=new Ss(this),this.mouse=new Ps(this),this.touchscreen=new Is(this)}#o(){this.#s.browsingContext.on("closed",()=>{this.trustedEmitter.emit("close",void 0),this.trustedEmitter.removeAllListeners()}),this.trustedEmitter.on("workercreated",o=>{this.#n.add(o)}),this.trustedEmitter.on("workerdestroyed",o=>{this.#n.delete(o)})}_userAgentHeaders={};#u;#l;async setUserAgent(o,e){if(!this.#t.browser().cdpSupported&&e)throw new A("Current Browser does not support `userAgentMetadata`");if(this.#t.browser().cdpSupported&&e)return await this._client().send("Network.setUserAgentOverride",{userAgent:o,userAgentMetadata:e});const s=o!=="";o=o??await this.#t.browser().userAgent(),this._userAgentHeaders=s?{"User-Agent":o}:{},this.#u=await this.#m(["beforeRequestSent"],this.#u,s);const i=u=>{Object.defineProperty(navigator,"userAgent",{value:u,configurable:!0})},c=[this.#s];for(const u of c)c.push(...u.childFrames());this.#l&&await this.removeScriptToEvaluateOnNewDocument(this.#l);const[l]=await Promise.all([s?this.evaluateOnNewDocument(i,o):void 0,...c.map(u=>u.evaluate(i,o))]);this.#l=l?.identifier}async setBypassCSP(o){await this._client().send("Page.setBypassCSP",{enabled:o})}async queryObjects(o){X(!o.disposed,"Prototype JSHandle is disposed!"),X(o.id,"Prototype JSHandle must not be referencing primitive value");const e=await this.#s.client.send("Runtime.queryObjects",{prototypeObjectId:o.id});return this.#s.mainRealm().createHandle({type:"array",handle:e.objects.objectId})}browser(){return this.browserContext().browser()}browserContext(){return this.#t}mainFrame(){return this.#s}resize(o){throw new Error("Method not implemented for WebDriver BiDi yet.")}async focusedFrame(){const o={stack:[],error:void 0,hasError:!1};try{const e=yi(o,await this.mainFrame().isolatedRealm().evaluateHandle(()=>{let i=window;for(;(i.document.activeElement instanceof i.HTMLIFrameElement||i.document.activeElement instanceof i.HTMLFrameElement)&&i.document.activeElement.contentWindow!==null;)i=i.document.activeElement.contentWindow;return i}),!1).remoteValue();X(e.type==="window");const s=this.frames().find(i=>i._id===e.value.context);return X(s),s}catch(e){o.error=e,o.hasError=!0}finally{bi(o)}}frames(){const o=[this.#s];for(const e of o)o.push(...e.childFrames());return o}isClosed(){return this.#s.detached}async close(o){const e={stack:[],error:void 0,hasError:!1};try{const s=yi(e,await this.#t.waitForScreenshotOperations(),!1);try{await this.#s.browsingContext.close(o?.runBeforeUnload)}catch{return}}catch(s){e.error=s,e.hasError=!0}finally{bi(e)}}async reload(o={}){const[e]=await Promise.all([this.#s.waitForNavigation(o),this.#s.browsingContext.reload()]).catch(fi(this.url(),o.timeout??this._timeoutSettings.navigationTimeout()));return e}setDefaultNavigationTimeout(o){this._timeoutSettings.setDefaultNavigationTimeout(o)}setDefaultTimeout(o){this._timeoutSettings.setDefaultTimeout(o)}getDefaultTimeout(){return this._timeoutSettings.timeout()}getDefaultNavigationTimeout(){return this._timeoutSettings.navigationTimeout()}isJavaScriptEnabled(){return this.#s.browsingContext.isJavaScriptEnabled()}async setGeolocation(o){const{longitude:e,latitude:s,accuracy:i=0}=o;if(e<-180||e>180)throw new Error(`Invalid longitude "${e}": precondition -180 <= LONGITUDE <= 180 failed.`);if(s<-90||s>90)throw new Error(`Invalid latitude "${s}": precondition -90 <= LATITUDE <= 90 failed.`);if(i<0)throw new Error(`Invalid accuracy "${i}": precondition 0 <= ACCURACY failed.`);return await this.#s.browsingContext.setGeolocationOverride({coordinates:{latitude:o.latitude,longitude:o.longitude,accuracy:o.accuracy}})}async setJavaScriptEnabled(o){return await this.#s.browsingContext.setJavaScriptEnabled(o)}async emulateMediaType(o){return await this.#i.emulateMediaType(o)}async emulateCPUThrottling(o){return await this.#i.emulateCPUThrottling(o)}async emulateMediaFeatures(o){return await this.#i.emulateMediaFeatures(o)}async emulateTimezone(o){return await this.#s.browsingContext.setTimezoneOverride(o)}async emulateIdleState(o){return await this.#i.emulateIdleState(o)}async emulateVisionDeficiency(o){return await this.#i.emulateVisionDeficiency(o)}async setViewport(o){if(!this.browser().cdpSupported){await this.#s.browsingContext.setViewport({viewport:o?.width&&o?.height?{width:o.width,height:o.height}:null,devicePixelRatio:o?.deviceScaleFactor?o.deviceScaleFactor:null}),this.#r=o;return}const e=await this.#i.emulateViewport(o);this.#r=o,e&&await this.reload()}viewport(){return this.#r}async pdf(o={}){const{timeout:e=this._timeoutSettings.timeout(),path:s=void 0}=o,{printBackground:i,margin:c,landscape:l,width:u,height:h,pageRanges:f,scale:y,preferCSSPageSize:g}=qa(o,"cm"),w=f?f.split(", "):[];await _t(Mi(this.mainFrame().isolatedRealm().evaluate(()=>document.fonts.ready)).pipe(ye(zt(e))));const m=await _t(Mi(this.#s.browsingContext.print({background:i,margin:c,orientation:l?"landscape":"portrait",page:{width:u,height:h},pageRanges:w,scale:y,shrinkToFit:!g})).pipe(ye(zt(e)))),p=Ii(m,!0);return await this._maybeWriteTypedArrayToFile(s,p),p}async createPDFStream(o){const e=await this.pdf(o);return new ReadableStream({start(s){s.enqueue(e),s.close()}})}async _screenshot(o){const{clip:e,type:s,captureBeyondViewport:i,quality:c}=o;if(o.omitBackground!==void 0&&o.omitBackground)throw new A("BiDi does not support 'omitBackground'.");if(o.optimizeForSpeed!==void 0&&o.optimizeForSpeed)throw new A("BiDi does not support 'optimizeForSpeed'.");if(o.fromSurface!==void 0&&!o.fromSurface)throw new A("BiDi does not support 'fromSurface'.");if(e!==void 0&&e.scale!==void 0&&e.scale!==1)throw new A("BiDi does not support 'scale' in 'clip'.");let l;if(e)if(i)l=e;else{const[u,h]=await this.evaluate(()=>{if(!window.visualViewport)throw new Error("window.visualViewport is not supported.");return[window.visualViewport.pageLeft,window.visualViewport.pageTop]});l={...e,x:e.x-u,y:e.y-h}}return await this.#s.browsingContext.captureScreenshot({origin:i?"document":"viewport",format:{type:`image/${s}`,...c!==void 0?{quality:c/100}:{}},...l?{clip:{type:"box",...l}}:{}})}async createCDPSession(){return await this.#s.createCDPSession()}async bringToFront(){await this.#s.browsingContext.activate()}async evaluateOnNewDocument(o,...e){const s=Fo(o,...e);return{identifier:await this.#s.browsingContext.addPreloadScript(s)}}async removeScriptToEvaluateOnNewDocument(o){await this.#s.browsingContext.removePreloadScript(o)}async exposeFunction(o,e){return await this.mainFrame().exposeFunction(o,"default"in e?e.default:e)}isDragInterceptionEnabled(){return!1}async setCacheEnabled(o){if(!this.#t.browser().cdpSupported){await this.#s.browsingContext.setCacheBehavior(o?"default":"bypass");return}await this._client().send("Network.setCacheDisabled",{cacheDisabled:!o})}async cookies(...o){const e=(o.length?o:[this.url()]).map(s=>new URL(s));return(await this.#s.browsingContext.getCookies()).map(s=>Jt(s)).filter(s=>e.some(i=>Bo(s,i)))}isServiceWorkerBypassed(){throw new A}target(){throw new A}async waitForFileChooser(o={}){const{timeout:e=this._timeoutSettings.timeout()}=o,s=Pi.create({message:`Waiting for \`FileChooser\` failed: ${e}ms exceeded`,timeout:e});this.#d.add(s),o.signal&&o.signal.addEventListener("abort",()=>{s.reject(o.signal?.reason)},{once:!0}),this.#s.browsingContext.once("filedialogopened",i=>{if(!i.element)return;const c=new $a(xe.from({sharedId:i.element.sharedId,handle:i.element.handle,type:"node"},this.#s.mainRealm()),i.multiple);for(const l of this.#d)l.resolve(c),this.#d.delete(l)});try{return await s.valueOrThrow()}catch(i){throw this.#d.delete(s),i}}workers(){return[...this.#n]}#h;async setRequestInterception(o){this.#h=await this.#m(["beforeRequestSent"],this.#h,o)}_extraHTTPHeaders={};#p;async setExtraHTTPHeaders(o){const e={};for(const[s,i]of Object.entries(o))X(Oi(i),`Expected value of header "${s}" to be String, but "${typeof i}" is found.`),e[s.toLowerCase()]=i;this._extraHTTPHeaders=e,this.#p=await this.#m(["beforeRequestSent"],this.#p,!!Object.keys(this._extraHTTPHeaders).length)}_credentials=null;#c;async authenticate(o){this.#c=await this.#m(["authRequired"],this.#c,!!o),this._credentials=o}async#m(o,e,s){if(s&&!e)return await this.#s.browsingContext.addIntercept({phases:o});if(!s&&e){await this.#s.browsingContext.userContext.browser.removeIntercept(e);return}return e}setDragInterception(){throw new A}setBypassServiceWorker(){throw new A}async setOfflineMode(o){if(!this.#t.browser().cdpSupported)throw new A;return this.#a||(this.#a={offline:!1,upload:-1,download:-1,latency:0}),this.#a.offline=o,await this.#f()}async emulateNetworkConditions(o){if(!this.#t.browser().cdpSupported)throw new A;return this.#a||(this.#a={offline:o?.offline??!1,upload:-1,download:-1,latency:0}),this.#a.upload=o?o.upload:-1,this.#a.download=o?o.download:-1,this.#a.latency=o?o.latency:0,this.#a.offline=o?.offline??!1,await this.#f()}async#f(){this.#a&&await this._client().send("Network.emulateNetworkConditions",{offline:this.#a.offline,latency:this.#a.latency,uploadThroughput:this.#a.upload,downloadThroughput:this.#a.download})}async setCookie(...o){const e=this.url(),s=e.startsWith("http");for(const i of o){let c=i.url||"";!c&&s&&(c=e),X(c!=="about:blank",`Blank page can not have cookie "${i.name}"`),X(!String.prototype.startsWith.call(c||"","data:"),`Data URL page can not have cookie "${i.name}"`),X(i.partitionKey===void 0||typeof i.partitionKey=="string","BiDi only allows domain partition keys");const l=URL.canParse(c)?new URL(c):void 0,u=i.domain??l?.hostname;X(u!==void 0,"At least one of the url and domain needs to be specified");const h={domain:u,name:i.name,value:{type:"string",value:i.value},...i.path!==void 0?{path:i.path}:{},...i.httpOnly!==void 0?{httpOnly:i.httpOnly}:{},...i.secure!==void 0?{secure:i.secure}:{},...i.sameSite!==void 0?{sameSite:Zt(i.sameSite)}:{},expiry:Qt(i.expires),...Yt(i,"sameParty","sourceScheme","priority","url")};i.partitionKey!==void 0?await this.browserContext().userContext.setCookie(h,i.partitionKey):await this.#s.browsingContext.setCookie(h)}}async deleteCookie(...o){await Promise.all(o.map(async e=>{const s=e.url??this.url(),i=URL.canParse(s)?new URL(s):void 0,c=e.domain??i?.hostname;X(c!==void 0,"At least one of the url and domain needs to be specified");const l={domain:c,name:e.name,...e.path!==void 0?{path:e.path}:{}};await this.#s.browsingContext.deleteCookie(l)}))}async removeExposedFunction(o){await this.#s.removeExposedFunction(o)}metrics(){throw new A}async goBack(o={}){return await this.#g(-1,o)}async goForward(o={}){return await this.#g(1,o)}async#g(o,e){const s=new AbortController;try{const[i]=await Promise.all([this.waitForNavigation({...e,signal:s.signal}),this.#s.browsingContext.traverseHistory(o)]);return i}catch(i){throw s.abort(),i}}waitForDevicePrompt(){throw new A}}})();function Fo(n,...t){return`() => {${za(n,...t)}}`}function Ao(n,t){const a=n.domain.toLowerCase(),r=t.hostname.toLowerCase();return a===r?!0:a.startsWith(".")&&r.endsWith(a)}function Mo(n,t){const a=t.pathname,r=n.path;return!!(a===r||a.startsWith(r)&&(r.endsWith("/")||a[r.length]==="/"))}function Bo(n,t){const a=new URL(t);return X(n!==void 0),Ao(n,a)?Mo(n,a):!1}Jt=function(n,t=!1){const a=n[Ut+"partitionKey"];function r(){return typeof a=="string"?{partitionKey:a}:typeof a=="object"&&a!==null?t?{partitionKey:{sourceOrigin:a.topLevelSite,hasCrossSiteAncestor:a.hasCrossSiteAncestor??!1}}:{partitionKey:a.topLevelSite}:{}}return{name:n.name,value:n.value.value,domain:n.domain,path:n.path,size:n.size,httpOnly:n.httpOnly,secure:n.secure,sameSite:Uo(n.sameSite),expires:n.expiry??-1,session:n.expiry===void 0||n.expiry<=0,...jo(n,"sameParty","sourceScheme","partitionKeyOpaque","priority"),...r()}};const Ut="goog:";function jo(n,...t){const a={};for(const r of t)n[Ut+r]!==void 0&&(a[r]=n[Ut+r]);return a}Yt=function(n,...t){const a={};for(const r of t)n[r]!==void 0&&(a[Ut+r]=n[r]);return a};function Uo(n){return n==="strict"?"Strict":n==="lax"?"Lax":"None"}Zt=function(n){return n==="Strict"?"strict":n==="Lax"?"lax":"none"},Qt=function(n){return[void 0,-1].includes(n)?void 0:n},ks=function(n){if(n===void 0||typeof n=="string")return n;if(n.hasCrossSiteAncestor)throw new A("WebDriver BiDi does not support `hasCrossSiteAncestor` yet.");return n.sourceOrigin};class Lo extends Kt{#e;constructor(t){super(),this.#e=t}asPage(){throw new A}url(){return""}createCDPSession(){throw new A}type(){return Wt.BROWSER}browser(){return this.#e}browserContext(){return this.#e.defaultBrowserContext()}opener(){throw new A}}class qo extends Kt{#e;constructor(t){super(),this.#e=t}async page(){return this.#e}async asPage(){return Te.from(this.browserContext(),this.#e.mainFrame().browsingContext)}url(){return this.#e.url()}createCDPSession(){return this.#e.createCDPSession()}type(){return Wt.PAGE}browser(){return this.browserContext().browser()}browserContext(){return this.#e.browserContext()}opener(){throw new A}}class $o extends Kt{#e;#t;constructor(t){super(),this.#e=t}async page(){return this.#t===void 0&&(this.#t=Te.from(this.browserContext(),this.#e.browsingContext)),this.#t}async asPage(){return Te.from(this.browserContext(),this.#e.browsingContext)}url(){return this.#e.url()}createCDPSession(){return this.#e.createCDPSession()}type(){return Wt.PAGE}browser(){return this.browserContext().browser()}browserContext(){return this.#e.page().browserContext()}opener(){throw new A}}class zo extends Kt{#e;constructor(t){super(),this.#e=t}async page(){throw new A}async asPage(){throw new A}url(){return this.#e.url()}createCDPSession(){throw new A}type(){return Wt.OTHER}browser(){return this.browserContext().browser()}browserContext(){return this.#e.frame.page().browserContext()}opener(){throw new A}}var _o=function(n,t,a,r,d,o){function e(m){if(m!==void 0&&typeof m!="function")throw new TypeError("Function expected");return m}for(var s=r.kind,i=s==="getter"?"get":s==="setter"?"set":"value",c=!t&&n?r.static?n:n.prototype:null,l=t||(c?Object.getOwnPropertyDescriptor(c,r.name):{}),u,h=!1,f=a.length-1;f>=0;f--){var y={};for(var g in r)y[g]=g==="access"?{}:r[g];for(var g in r.access)y.access[g]=r.access[g];y.addInitializer=function(m){if(h)throw new TypeError("Cannot add initializers after decoration has completed");o.push(e(m||null))};var w=(0,a[f])(s==="accessor"?{get:l.get,set:l.set}:l[i],y);if(s==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(u=e(w.get))&&(l.get=u),(u=e(w.set))&&(l.set=u),(u=e(w.init))&&d.unshift(u)}else(u=e(w))&&(s==="field"?d.unshift(u):l[i]=u)}c&&Object.defineProperty(c,r.name,l),h=!0},xi=function(n,t,a){for(var r=arguments.length>2,d=0;d<t.length;d++)a=r?t[d].call(n,a):t[d].call(n);return r?a:void 0},Ho=function(n,t,a){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var r,d;if(a){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=t[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=t[Symbol.dispose],a&&(d=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");d&&(r=function(){try{d.call(this)}catch(o){return Promise.reject(o)}}),n.stack.push({value:t,dispose:r,async:a})}else a&&n.stack.push({async:!0});return t},Ko=(function(n){return function(t){function a(e){t.error=t.hasError?new n(e,t.error,"An error was suppressed during disposal."):e,t.hasError=!0}var r,d=0;function o(){for(;r=t.stack.pop();)try{if(!r.async&&d===1)return d=0,t.stack.push(r),Promise.resolve().then(o);if(r.dispose){var e=r.dispose.call(r.value);if(r.async)return d|=2,Promise.resolve(e).then(o,function(s){return a(s),o()})}else d|=1}catch(s){a(s)}if(d===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return o()}})(typeof SuppressedError=="function"?SuppressedError:function(n,t,a){var r=new Error(a);return r.name="SuppressedError",r.error=n,r.suppressed=t,r});bs=(()=>{let n=_a,t,a=[],r=[];return class Vi extends n{static{const o=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;t=[Ht()],_o(this,null,t,{kind:"accessor",name:"trustedEmitter",static:!1,private:!1,access:{has:e=>"trustedEmitter"in e,get:e=>e.trustedEmitter,set:(e,s)=>{e.trustedEmitter=s}},metadata:o},a,r),o&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:o})}static from(o,e,s){const i=new Vi(o,e,s);return i.#a(),i}#e=xi(this,a,new M);get trustedEmitter(){return this.#e}set trustedEmitter(o){this.#e=o}#t=xi(this,r);#s;userContext;#r=new WeakMap;#n=new Map;#i=[];constructor(o,e,s){super(),this.#t=o,this.userContext=e,this.#s=s.defaultViewport}#a(){for(const o of this.userContext.browsingContexts)this.#d(o);this.userContext.on("browsingcontext",({browsingContext:o})=>{const e=this.#d(o);if(o.originalOpener)for(const s of this.userContext.browsingContexts)s.id===o.originalOpener&&this.#r.get(s).trustedEmitter.emit("popup",e)}),this.userContext.on("closed",()=>{this.trustedEmitter.removeAllListeners()})}#d(o){const e=Te.from(this,o);this.#r.set(o,e),e.trustedEmitter.on("close",()=>{this.#r.delete(o)});const s=new qo(e),i=new Map;return this.#n.set(e,[s,i]),e.trustedEmitter.on("frameattached",c=>{const l=c,u=new $o(l);i.set(l,u),this.trustedEmitter.emit("targetcreated",u)}),e.trustedEmitter.on("framenavigated",c=>{const l=c,u=i.get(l);u===void 0?this.trustedEmitter.emit("targetchanged",s):this.trustedEmitter.emit("targetchanged",u)}),e.trustedEmitter.on("framedetached",c=>{const l=c,u=i.get(l);u!==void 0&&(i.delete(l),this.trustedEmitter.emit("targetdestroyed",u))}),e.trustedEmitter.on("workercreated",c=>{const l=c,u=new zo(l);i.set(l,u),this.trustedEmitter.emit("targetcreated",u)}),e.trustedEmitter.on("workerdestroyed",c=>{const l=c,u=i.get(l);u!==void 0&&(i.delete(c),this.trustedEmitter.emit("targetdestroyed",u))}),e.trustedEmitter.on("close",()=>{this.#n.delete(e),this.trustedEmitter.emit("targetdestroyed",s)}),this.trustedEmitter.emit("targetcreated",s),e}targets(){return[...this.#n.values()].flatMap(([o,e])=>[o,...e.values()])}async newPage(){const o={stack:[],error:void 0,hasError:!1};try{const e=Ho(o,await this.waitForScreenshotOperations(),!1),s=await this.userContext.createBrowsingContext("tab"),i=this.#r.get(s);if(!i)throw new Error("Page is not found");if(this.#s)try{await i.setViewport(this.#s)}catch{}return i}catch(e){o.error=e,o.hasError=!0}finally{Ko(o)}}async close(){X(this.userContext.id!==Bt.DEFAULT,"Default BrowserContext cannot be closed!");try{await this.userContext.remove()}catch(o){K(o)}this.#n.clear()}browser(){return this.#t}async pages(){return[...this.userContext.browsingContexts].map(o=>this.#r.get(o))}async overridePermissions(o,e){const s=new Set(e.map(i=>{if(!Bi.get(i))throw new Error("Unknown permission: "+i);return i}));await Promise.all(Array.from(Bi.keys()).map(i=>{const c=this.userContext.setPermissions(o,{name:i},s.has(i)?"granted":"denied");return this.#i.push({origin:o,permission:i}),s.has(i)?c:c.catch(K)}))}async clearPermissionOverrides(){const o=this.#i.map(({permission:e,origin:s})=>this.userContext.setPermissions(s,{name:e},"prompt").catch(K));this.#i=[],await Promise.all(o)}get id(){if(this.userContext.id!==Bt.DEFAULT)return this.userContext.id}async cookies(){return(await this.userContext.getCookies()).map(o=>Jt(o,!0))}async setCookie(...o){await Promise.all(o.map(async e=>{const s={domain:e.domain,name:e.name,value:{type:"string",value:e.value},...e.path!==void 0?{path:e.path}:{},...e.httpOnly!==void 0?{httpOnly:e.httpOnly}:{},...e.secure!==void 0?{secure:e.secure}:{},...e.sameSite!==void 0?{sameSite:Zt(e.sameSite)}:{},expiry:Qt(e.expires),...Yt(e,"sameParty","sourceScheme","priority","url")};return await this.userContext.setCookie(s,ks(e.partitionKey))}))}}})();var Wo=function(n,t,a){for(var r=arguments.length>2,d=0;d<t.length;d++)a=r?t[d].call(n,a):t[d].call(n);return r?a:void 0},ce=function(n,t,a,r,d,o){function e(m){if(m!==void 0&&typeof m!="function")throw new TypeError("Function expected");return m}for(var s=r.kind,i=s==="getter"?"get":s==="setter"?"set":"value",c=!t&&n?r.static?n:n.prototype:null,l=t||(c?Object.getOwnPropertyDescriptor(c,r.name):{}),u,h=!1,f=a.length-1;f>=0;f--){var y={};for(var g in r)y[g]=g==="access"?{}:r[g];for(var g in r.access)y.access[g]=r.access[g];y.addInitializer=function(m){if(h)throw new TypeError("Cannot add initializers after decoration has completed");o.push(e(m||null))};var w=(0,a[f])(s==="accessor"?{get:l.get,set:l.set}:l[i],y);if(s==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(u=e(w.get))&&(l.get=u),(u=e(w.set))&&(l.set=u),(u=e(w.init))&&d.unshift(u)}else(u=e(w))&&(s==="field"?d.unshift(u):l[i]=u)}c&&Object.defineProperty(c,r.name,l),h=!0},Vo=function(n,t,a){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var r,d;if(a){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=t[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=t[Symbol.dispose],a&&(d=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");d&&(r=function(){try{d.call(this)}catch(o){return Promise.reject(o)}}),n.stack.push({value:t,dispose:r,async:a})}else a&&n.stack.push({async:!0});return t},Go=(function(n){return function(t){function a(e){t.error=t.hasError?new n(e,t.error,"An error was suppressed during disposal."):e,t.hasError=!0}var r,d=0;function o(){for(;r=t.stack.pop();)try{if(!r.async&&d===1)return d=0,t.stack.push(r),Promise.resolve().then(o);if(r.dispose){var e=r.dispose.call(r.value);if(r.async)return d|=2,Promise.resolve(e).then(o,function(s){return a(s),o()})}else d|=1}catch(s){a(s)}if(d===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return o()}})(typeof SuppressedError=="function"?SuppressedError:function(n,t,a){var r=new Error(a);return r.name="SuppressedError",r.error=n,r.suppressed=t,r});let Xo=(()=>{let n=M,t=[],a,r,d,o,e,s,i,c;return class Gi extends n{static{const u=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;ce(this,null,a,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:h=>"dispose"in h,get:h=>h.dispose},metadata:u},null,t),ce(this,null,r,{kind:"method",name:"close",static:!1,private:!1,access:{has:h=>"close"in h,get:h=>h.close},metadata:u},null,t),ce(this,null,d,{kind:"method",name:"addPreloadScript",static:!1,private:!1,access:{has:h=>"addPreloadScript"in h,get:h=>h.addPreloadScript},metadata:u},null,t),ce(this,null,o,{kind:"method",name:"removeIntercept",static:!1,private:!1,access:{has:h=>"removeIntercept"in h,get:h=>h.removeIntercept},metadata:u},null,t),ce(this,null,e,{kind:"method",name:"removePreloadScript",static:!1,private:!1,access:{has:h=>"removePreloadScript"in h,get:h=>h.removePreloadScript},metadata:u},null,t),ce(this,null,s,{kind:"method",name:"createUserContext",static:!1,private:!1,access:{has:h=>"createUserContext"in h,get:h=>h.createUserContext},metadata:u},null,t),ce(this,null,i,{kind:"method",name:"installExtension",static:!1,private:!1,access:{has:h=>"installExtension"in h,get:h=>h.installExtension},metadata:u},null,t),ce(this,null,c,{kind:"method",name:"uninstallExtension",static:!1,private:!1,access:{has:h=>"uninstallExtension"in h,get:h=>h.uninstallExtension},metadata:u},null,t),u&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:u})}static async from(u){const h=new Gi(u);return await h.#i(),h}#e=(Wo(this,t),!1);#t;#s=new ee;#r=new Map;session;#n=new Map;constructor(u){super(),this.session=u}async#i(){const u=this.#s.use(new M(this.session));u.once("ended",({reason:h})=>{this.dispose(h)}),u.on("script.realmCreated",h=>{h.type==="shared-worker"&&this.#n.set(h.realm,ds.from(this,h.realm,h.origin))}),await this.#a(),await this.#d()}async#a(){const{result:{userContexts:u}}=await this.session.send("browser.getUserContexts",{});for(const h of u)this.#o(h.userContext)}async#d(){const u=new Set;let h;{const f={stack:[],error:void 0,hasError:!1};try{Vo(f,new M(this.session),!1).on("browsingContext.contextCreated",g=>{u.add(g.context)});const{result:y}=await this.session.send("browsingContext.getTree",{});h=y.contexts}catch(y){f.error=y,f.hasError=!0}finally{Go(f)}}for(const f of h)u.has(f.context)||this.session.emit("browsingContext.contextCreated",f),f.children&&h.push(...f.children)}#o(u){const h=Bt.create(this,u);this.#r.set(h.id,h);const f=this.#s.use(new M(h));return f.once("closed",()=>{f.removeAllListeners(),this.#r.delete(h.id)}),h}get closed(){return this.#e}get defaultUserContext(){return this.#r.get(Bt.DEFAULT)}get disconnected(){return this.#t!==void 0}get disposed(){return this.disconnected}get userContexts(){return this.#r.values()}dispose(u,h=!1){this.#e=h,this.#t=u,this[$]()}async close(){try{await this.session.send("browser.close",{})}finally{this.dispose("Browser already closed.",!0)}}async addPreloadScript(u,h={}){const{result:{script:f}}=await this.session.send("script.addPreloadScript",{functionDeclaration:u,...h,contexts:h.contexts?.map(y=>y.id)});return f}async removeIntercept(u){await this.session.send("network.removeIntercept",{intercept:u})}async removePreloadScript(u){await this.session.send("script.removePreloadScript",{script:u})}async createUserContext(u){const h=u.proxyServer===void 0?void 0:{proxyType:"manual",httpProxy:u.proxyServer,sslProxy:u.proxyServer,noProxy:u.proxyBypassList},{result:{userContext:f}}=await this.session.send("browser.createUserContext",{proxy:h});return this.#o(f)}async installExtension(u){const{result:{extension:h}}=await this.session.send("webExtension.install",{extensionData:{type:"path",path:u}});return h}async uninstallExtension(u){await this.session.send("webExtension.uninstall",{extension:u})}[(a=[de],r=[R(u=>u.#t)],d=[R(u=>u.#t)],o=[R(u=>u.#t)],e=[R(u=>u.#t)],s=[R(u=>u.#t)],i=[R(u=>u.#t)],c=[R(u=>u.#t)],$)](){this.#t??="Browser was disconnected, probably because the session ended.",this.closed&&this.emit("closed",{reason:this.#t}),this.emit("disconnected",{reason:this.#t}),this.#s.dispose(),super[$]()}}})();var gs=function(n,t,a){for(var r=arguments.length>2,d=0;d<t.length;d++)a=r?t[d].call(n,a):t[d].call(n);return r?a:void 0},ke=function(n,t,a,r,d,o){function e(m){if(m!==void 0&&typeof m!="function")throw new TypeError("Function expected");return m}for(var s=r.kind,i=s==="getter"?"get":s==="setter"?"set":"value",c=!t&&n?r.static?n:n.prototype:null,l=t||(c?Object.getOwnPropertyDescriptor(c,r.name):{}),u,h=!1,f=a.length-1;f>=0;f--){var y={};for(var g in r)y[g]=g==="access"?{}:r[g];for(var g in r.access)y.access[g]=r.access[g];y.addInitializer=function(m){if(h)throw new TypeError("Cannot add initializers after decoration has completed");o.push(e(m||null))};var w=(0,a[f])(s==="accessor"?{get:l.get,set:l.set}:l[i],y);if(s==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(u=e(w.get))&&(l.get=u),(u=e(w.set))&&(l.set=u),(u=e(w.init))&&d.unshift(u)}else(u=e(w))&&(s==="field"?d.unshift(u):l[i]=u)}c&&Object.defineProperty(c,r.name,l),h=!0};let Jo=(()=>{let n=M,t=[],a,r=[],d=[],o,e,s,i,c;return class Xi extends n{static{const u=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;ke(this,null,a,{kind:"accessor",name:"connection",static:!1,private:!1,access:{has:h=>"connection"in h,get:h=>h.connection,set:(h,f)=>{h.connection=f}},metadata:u},r,d),ke(this,null,o,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:h=>"dispose"in h,get:h=>h.dispose},metadata:u},null,t),ke(this,null,e,{kind:"method",name:"send",static:!1,private:!1,access:{has:h=>"send"in h,get:h=>h.send},metadata:u},null,t),ke(this,null,s,{kind:"method",name:"subscribe",static:!1,private:!1,access:{has:h=>"subscribe"in h,get:h=>h.subscribe},metadata:u},null,t),ke(this,null,i,{kind:"method",name:"addIntercepts",static:!1,private:!1,access:{has:h=>"addIntercepts"in h,get:h=>h.addIntercepts},metadata:u},null,t),ke(this,null,c,{kind:"method",name:"end",static:!1,private:!1,access:{has:h=>"end"in h,get:h=>h.end},metadata:u},null,t),u&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:u})}static async from(u,h){const{result:f}=await u.send("session.new",{capabilities:h}),y=new Xi(u,f);return await y.#n(),y}#e=gs(this,t);#t=new ee;#s;browser;#r=gs(this,r,void 0);get connection(){return this.#r}set connection(u){this.#r=u}constructor(u,h){super(),gs(this,d),this.#s=h,this.connection=u}async#n(){this.browser=await Xo.from(this),this.#t.use(this.browser).once("closed",({reason:h})=>{this.dispose(h)});const u=new WeakSet;this.on("browsingContext.fragmentNavigated",h=>{u.has(h)||(u.add(h),this.emit("browsingContext.navigationStarted",h),this.emit("browsingContext.fragmentNavigated",h))})}get capabilities(){return this.#s.capabilities}get disposed(){return this.ended}get ended(){return this.#e!==void 0}get id(){return this.#s.sessionId}dispose(u){this.#e=u,this[$]()}async send(u,h){return await this.connection.send(u,h)}async subscribe(u,h){await this.send("session.subscribe",{events:u,contexts:h})}async addIntercepts(u,h){await this.send("session.subscribe",{events:u,contexts:h})}async end(){try{await this.send("session.end",{})}finally{this.dispose("Session already ended.")}}[(a=[Ht()],o=[de],e=[R(u=>u.#e)],s=[R(u=>u.#e)],i=[R(u=>u.#e)],c=[R(u=>u.#e)],$)](){this.#e??="Session already destroyed, probably because the connection broke.",this.emit("ended",{reason:this.#e}),this.#t.dispose(),super[$]()}}})();var Yo=function(n,t,a,r,d,o){function e(m){if(m!==void 0&&typeof m!="function")throw new TypeError("Function expected");return m}for(var s=r.kind,i=s==="getter"?"get":s==="setter"?"set":"value",c=!t&&n?r.static?n:n.prototype:null,l=t||(c?Object.getOwnPropertyDescriptor(c,r.name):{}),u,h=!1,f=a.length-1;f>=0;f--){var y={};for(var g in r)y[g]=g==="access"?{}:r[g];for(var g in r.access)y.access[g]=r.access[g];y.addInitializer=function(m){if(h)throw new TypeError("Cannot add initializers after decoration has completed");o.push(e(m||null))};var w=(0,a[f])(s==="accessor"?{get:l.get,set:l.set}:l[i],y);if(s==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(u=e(w.get))&&(l.get=u),(u=e(w.set))&&(l.set=u),(u=e(w.init))&&d.unshift(u)}else(u=e(w))&&(s==="field"?d.unshift(u):l[i]=u)}c&&Object.defineProperty(c,r.name,l),h=!0},Ci=function(n,t,a){for(var r=arguments.length>2,d=0;d<t.length;d++)a=r?t[d].call(n,a):t[d].call(n);return r?a:void 0},Ei=function(n,t,a){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:a?"".concat(a," ",t):t})};ji=(()=>{let n=Ha,t,a=[],r=[],d;return class Pt extends n{static{const e=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;t=[Ht()],Yo(this,d={get:Ei(function(){return this.#e},"#trustedEmitter","get"),set:Ei(function(s){this.#e=s},"#trustedEmitter","set")},t,{kind:"accessor",name:"#trustedEmitter",static:!1,private:!0,access:{has:s=>#t in s,get:s=>s.#t,set:(s,i)=>{s.#t=i}},metadata:e},a,r),e&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:e})}protocol="webDriverBiDi";static subscribeModules=["browsingContext","network","log","script","input"];static subscribeCdpEvents=["goog:cdp.Debugger.scriptParsed","goog:cdp.CSS.styleSheetAdded","goog:cdp.Runtime.executionContextsCleared","goog:cdp.Tracing.tracingComplete","goog:cdp.Network.requestWillBeSent","goog:cdp.Debugger.scriptParsed","goog:cdp.Page.screencastFrame"];static async create(e){const s=await Jo.from(e.connection,{firstMatch:e.capabilities?.firstMatch,alwaysMatch:{...e.capabilities?.alwaysMatch,acceptInsecureCerts:e.acceptInsecureCerts,unhandledPromptBehavior:{default:"ignore"},webSocketUrl:!0,"goog:prerenderingDisabled":!0}});await s.subscribe((s.capabilities.browserName.toLocaleLowerCase().includes("firefox")?Pt.subscribeModules:[...Pt.subscribeModules,...Pt.subscribeCdpEvents]).filter(c=>e.networkEnabled?!0:c!=="network"&&c!=="goog:cdp.Network.requestWillBeSent"));try{await s.send("network.addDataCollector",{dataTypes:["response"],maxEncodedDataSize:20*1e3*1e3})}catch(c){if(c instanceof Lt)K(c);else throw c}const i=new Pt(s.browser,e);return i.#l(),i}#e=Ci(this,a,new M);get#t(){return d.get.call(this)}set#t(e){return d.set.call(this,e)}#s=Ci(this,r);#r;#n;#i;#a=new WeakMap;#d=new Lo(this);#o;#u;constructor(e,s){super(),this.#s=s.process,this.#r=s.closeCallback,this.#n=e,this.#i=s.defaultViewport,this.#o=s.cdpConnection,this.#u=s.networkEnabled}#l(){for(const e of this.#n.userContexts)this.#c(e);this.#n.once("disconnected",()=>{this.#t.emit("disconnected",void 0),this.#t.removeAllListeners()}),this.#s?.once("close",()=>{this.#n.dispose("Browser process exited.",!0),this.connection.dispose()})}get#h(){return this.#n.session.capabilities.browserName}get#p(){return this.#n.session.capabilities.browserVersion}get cdpSupported(){return this.#o!==void 0}get cdpConnection(){return this.#o}async userAgent(){return this.#n.session.capabilities.userAgent}#c(e){const s=bs.from(this,e,{defaultViewport:this.#i});return this.#a.set(e,s),s.trustedEmitter.on("targetcreated",i=>{this.#t.emit("targetcreated",i)}),s.trustedEmitter.on("targetchanged",i=>{this.#t.emit("targetchanged",i)}),s.trustedEmitter.on("targetdestroyed",i=>{this.#t.emit("targetdestroyed",i)}),s}get connection(){return this.#n.session.connection}wsEndpoint(){return this.connection.url}async close(){if(!this.connection.closed)try{await this.#n.close(),await this.#r?.call(null)}catch(e){K(e)}finally{this.connection.dispose()}}get connected(){return!this.#n.disconnected}process(){return this.#s??null}async createBrowserContext(e={}){const s=await this.#n.createUserContext(e);return this.#c(s)}async version(){return`${this.#h}/${this.#p}`}browserContexts(){return[...this.#n.userContexts].map(e=>this.#a.get(e))}defaultBrowserContext(){return this.#a.get(this.#n.defaultUserContext)}newPage(){return this.defaultBrowserContext().newPage()}installExtension(e){return this.#n.installExtension(e)}async uninstallExtension(e){await this.#n.uninstallExtension(e)}targets(){return[this.#d,...this.browserContexts().flatMap(e=>e.targets())]}target(){return this.#d}async disconnect(){try{await this.#n.session.end()}catch(e){K(e)}finally{this.connection.dispose()}}get debugInfo(){return{pendingProtocolErrors:this.connection.getPendingProtocolErrors()}}isNetworkEnabled(){return this.#u}}})()});export{ji as BidiBrowser,bs as BidiBrowserContext,xs as BidiConnection,xe as BidiElementHandle,Cs as BidiFrame,he as BidiFrameRealm,Vt as BidiHTTPRequest,Es as BidiHTTPResponse,pe as BidiJSHandle,Ss as BidiKeyboard,Ps as BidiMouse,Te as BidiPage,Gt as BidiRealm,Is as BidiTouchscreen,Xt as BidiWorkerRealm,Wa as __tla,Jt as bidiToPuppeteerCookie,Yt as cdpSpecificCookiePropertiesFromPuppeteerToBidi,Ui as connectBidiOverCdp,Qt as convertCookiesExpiryCdpToBiDi,ks as convertCookiesPartitionKeyFromPuppeteerToBiDi,Zt as convertCookiesSameSiteCdpToBiDi,es as requests};
